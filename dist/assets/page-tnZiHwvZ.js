import{h as A,r,j as e,F as V}from"./index-DIt2374o.js";import{C as M}from"./ComponentContainerCard-81xiKPcP.js";import{P as F}from"./PageTitle-BCqVd2bM.js";import{C as D}from"./challengerService-BuJZLHMA.js";import{A as N}from"./api-ClkYFUjX.js";import"./Card-B1RuP3By.js";import"./IconifyIcon-CfV87KKh.js";const I=["Weight Loss Meal Plan","High Protein Meal Plan","North Indian Meal Plan","South Indian Meal Plan","Asian Meal Plan","Fusion Meal Plan","Maharashtra Meal Plan","Sattvikk Meal Plan"],G=()=>{var p;const{showNotification:g}=A(),[v,x]=r.useState(!1),[u,j]=r.useState([]),[m,P]=r.useState(""),[n,c]=r.useState({page:1,limit:10}),[s,b]=r.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[f,y]=r.useState([{_id:"Veg + Egg",count:0},{_id:"Vegetarian",count:0},{_id:"Veg + Meat",count:0},{_id:"Not downloaded",count:0}]);r.useEffect(()=>{const t=setTimeout(async()=>{try{x(!0);const h={...n,search:m},i=await D.getAllChallengers(h);if(j(i.data||[]),b({currentPage:i.currentPage||1,totalPages:i.totalPages||1,totalItems:i.totalItems||0,itemsPerPage:n.limit||10}),i.overview){const d=i.overview.map(l=>l._id==="None"?{...l,_id:"Not downloaded"}:l),w=d.find(l=>l._id==="Veg + Egg"),S=d.find(l=>l._id==="Vegetarian"),_=d.find(l=>l._id==="Veg + Meat"),k=d.find(l=>l._id==="Not downloaded"),E=[w,S,_,k].filter(l=>!!l);y(E)}}catch(h){console.error("âŒ Error fetching challengers:",h),g({message:"Error fetching challengers",variant:"danger"}),j([])}finally{x(!1)}},300);return()=>clearTimeout(t)},[n.page,n.limit,n.category,n.subcategory,n.type,n.duration,m,g]);const o=a=>{c(t=>({...t,page:a}))},C=a=>{try{if(a.startsWith("http://")||a.startsWith("https://")){window.open(a,"_blank","noopener,noreferrer");return}let t=a;a.startsWith("/")?t=`${N.BASE_URL}/${a}`:t=`${N.BASE_URL}/${a}`,window.open(t,"_blank","noopener,noreferrer")}catch(t){console.error("Error opening PDF:",t),alert(`Error opening PDF: ${t instanceof Error?t.message:"Unknown error"}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(F,{subName:"Daawat",title:"Challengers"}),e.jsx("div",{className:"row mb-4",children:f.map(a=>e.jsx("div",{className:"col-md-3 mb-2",children:e.jsx("div",{className:"card shadow-sm border-0 h-100",children:e.jsxs("div",{className:"card-body d-flex flex-column justify-content-center align-items-center",children:[e.jsx("h6",{className:"mb-1 text-muted",children:a._id}),e.jsx("h3",{className:"mb-0 fw-bold",children:a.count})]})})},a._id))}),e.jsxs(M,{id:"challengers-list",title:"All Challengers",description:"Manage and view all registered challengers",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"fas fa-search"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search challengers...",value:m,onChange:a=>P(a.target.value)})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:n.category||"",onChange:a=>c(t=>({...t,category:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Vegetarian",children:"Vegetarian"}),e.jsx("option",{value:"Veg + Egg",children:"Veg + Egg"}),e.jsx("option",{value:"Veg + Meat",children:"Veg + Meat"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:n.subcategory||"",onChange:a=>c(t=>({...t,subcategory:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Subcategories"}),I.map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:n.duration||"",onChange:a=>c(t=>({...t,duration:a.target.value||void 0})),children:[e.jsx("option",{value:"",disabled:!0,children:"All Durations"}),e.jsx("option",{value:"7 days",children:"7 days"}),e.jsx("option",{value:"14 days",children:"14 days"}),e.jsx("option",{value:"21 days",children:"21 days"}),e.jsx("option",{value:"30 days",children:"30 days"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:((p=n.limit)==null?void 0:p.toString())||"10",onChange:a=>c(t=>({...t,limit:parseInt(a.target.value),page:1})),children:[e.jsx("option",{value:"5",children:"5 per page"}),e.jsx("option",{value:"10",children:"10 per page"}),e.jsx("option",{value:"25",children:"25 per page"}),e.jsx("option",{value:"50",children:"50 per page"})]})})]}),v?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading challengers..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name & Contact"}),e.jsx("th",{children:"Category "}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"PDF"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-users fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No challengers found"}),e.jsx("p",{className:"text-muted",children:"Try adjusting your search or filter criteria."})]})}):u.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"avatar-md me-2",children:e.jsx("div",{className:"avatar-title bg-primary-subtle text-primary rounded-circle",children:a.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:a.name}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-phone me-1"}),e.jsx("a",{href:`tel:${a.mobile}`,className:"text-decoration-none",children:a.mobile})]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("span",{className:`badge ${a.category==="Vegetarian"?"bg-success":a.category==="Keto"?"bg-warning":"bg-info"} mb-1`,children:a.category}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:a.type})]})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:a.duration})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:a.subcategory||"N/A"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"N/A"})}),e.jsx("td",{children:a.pdf?e.jsxs("button",{className:"btn btn-sm btn-outline-success",onClick:()=>C(a.pdf),title:"View PDF",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"View"]}):e.jsx("span",{className:"text-muted",children:"No meal plan chosen"})})]},a._id))})]})}),s.totalPages>1&&e.jsx("nav",{"aria-label":"Challengers pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${s.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(s.currentPage-1),disabled:s.currentPage===1,children:"Previous"})}),s.currentPage>3&&e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"page-item",children:e.jsx("button",{className:"page-link",onClick:()=>o(1),children:"1"})}),s.currentPage>4&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})})]}),Array.from({length:s.totalPages},(a,t)=>t+1).filter(a=>a===s.currentPage||a===s.currentPage-2||a===s.currentPage-1||a===s.currentPage+1||a===s.currentPage+2).map(a=>e.jsx("li",{className:`page-item ${s.currentPage===a?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(a),children:a})},a)),s.currentPage<s.totalPages-2&&e.jsxs(e.Fragment,{children:[s.currentPage<s.totalPages-3&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})}),e.jsx("li",{className:"page-item",children:e.jsx("button",{className:"page-link",onClick:()=>o(s.totalPages),children:s.totalPages})})]}),e.jsx("li",{className:`page-item ${s.currentPage===s.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>o(s.currentPage+1),disabled:s.currentPage===s.totalPages,children:"Next"})})]})})]}),e.jsx(V,{})]})};export{G as default};
