import{l as T,r as m,h as $,j as e,R as F,d as w}from"./index-BGj1e2T3.js";import{C as U}from"./ComponentContainerCard-DVd1_3yH.js";import{P as _}from"./PageTitle-BIAfu_gh.js";import{A as B}from"./api-VjRoL-6d.js";import{M as C}from"./Modal-CBj8vQrU.js";import{F as i}from"./Form-B_s7EH72.js";import{B as L}from"./Button-BIo4pqz0.js";import"./Card-CWoJ-2wS.js";import"./IconifyIcon-Dr-9Hheo.js";import"./AbstractModalHeader-DcQDZi5Y.js";import"./useWindow-D45kxoYO.js";import"./usePrevious-_UHm-XHh.js";import"./useEventCallback-BxO92j7x.js";import"./hasClass-DSCWdurT.js";import"./useMergedRefs-dWb9kdlO.js";import"./NoopTransition-C36Dh1mA.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-BU_hgi6s.js";import"./FormControl-CFam3LJ9.js";import"./warning-ClRYm4sS.js";import"./FormLabel-DDCHjN5Y.js";import"./ElementChildren-DKHvlqkC.js";import"./FormGroup-BLP_G_il.js";import"./FormSelect-DElPbVGy.js";import"./FormText-D1CHzqsp.js";import"./Button-Bg4d2IsU.js";const P=B.API_URL,x=g=>{var s,t,r;try{const n=(s=T.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:s.toString();if(n){const d=JSON.parse(n);if(d!=null&&d.token)return d.token}const h=(t=T.getCookie("token"))==null?void 0:t.toString();return g||h||localStorage.getItem("authToken")||""}catch(n){return console.warn("Failed to get auth token from session:",n),((r=T.getCookie("token"))==null?void 0:r.toString())||localStorage.getItem("authToken")||""}},A=()=>({authorization:x(),"Content-Type":"application/json"}),I=()=>({authorization:x()});class k{static async getAllDietPlans(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=new URLSearchParams;s!=null&&s.category&&r.append("category",s.category),s!=null&&s.subcategory&&r.append("subcategory",s.subcategory),(s==null?void 0:s.isActive)!==void 0&&r.append("isActive",s.isActive.toString()),s!=null&&s.page&&r.append("page",s.page.toString()),s!=null&&s.limit&&r.append("limit",s.limit.toString());const n=await fetch(`${P}/dietplans?${r.toString()}`,{method:"GET",headers:A()});if(!n.ok)throw new Error(`Failed to fetch diet plans: ${n.statusText}`);return await n.json()}catch(t){throw console.error("Error fetching diet plans:",t),t}}static async getDietPlanById(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=await fetch(`${P}/dietplans/${s}`,{method:"GET",headers:A()});if(!r.ok)throw new Error(`Failed to fetch diet plan: ${r.statusText}`);return await r.json()}catch(t){throw console.error("Error fetching diet plan:",t),t}}static async createDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=new FormData;r.append("name",s.name),r.append("duration",s.duration),r.append("category",s.category),r.append("isActive",s.isActive.toString()),s.subcategory&&r.append("subcategory",s.subcategory),s.description&&r.append("description",s.description),s.pdfFile&&r.append("pdfFile",s.pdfFile);const n=await fetch(`${P}/dietplans`,{method:"POST",headers:I(),body:r});if(!n.ok)throw new Error(`Failed to create diet plan: ${n.statusText}`);return await n.json()}catch(t){throw console.error("Error creating diet plan:",t),t}}static async updateDietPlan(s,t){try{if(!x())throw new Error("Authentication token not found. Please login again.");const n=new FormData;n.append("name",t.name),n.append("duration",t.duration),n.append("category",t.category),n.append("isActive",t.isActive.toString()),t.subcategory&&n.append("subcategory",t.subcategory),t.description&&n.append("description",t.description),t.pdfFile&&n.append("pdfFile",t.pdfFile);const h=await fetch(`${P}/dietplans/${s}`,{method:"PUT",headers:I(),body:n});if(!h.ok)throw new Error(`Failed to update diet plan: ${h.statusText}`);return await h.json()}catch(r){throw console.error("Error updating diet plan:",r),r}}static async deleteDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=await fetch(`${P}/dietplans/${s}`,{method:"DELETE",headers:A()});if(!r.ok)throw new Error(`Failed to delete diet plan: ${r.statusText}`)}catch(t){throw console.error("Error deleting diet plan:",t),t}}static async deleteAllDietPlans(){try{if(!x())throw new Error("Authentication token not found. Please login again.");const t=await fetch(`${P}/dietplans`,{method:"DELETE",headers:A()});if(!t.ok)throw new Error(`Failed to delete all diet plans: ${t.statusText}`)}catch(s){throw console.error("Error deleting all diet plans:",s),s}}static async downloadPDF(s){try{const t=x();if(!t)throw new Error("Authentication token not found. Please login again.");const r=await fetch(`${P}/dietplans/${s}/download`,{method:"GET",headers:{authorization:t}});if(!r.ok)throw new Error(`Failed to download PDF: ${r.statusText}`);return await r.blob()}catch(t){throw console.error("Error downloading PDF:",t),t}}static triggerPDFDownload(s,t){const r=window.URL.createObjectURL(s),n=document.createElement("a");n.href=r,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),window.URL.revokeObjectURL(r)}}const M=["Vegetarian","Veg+ Egg","Veg+ Meat"],R=["7 days","14 days","21 days","30 days"],O=["Weight Loss Meal Plan","High Protein Meal Plan","North Indian Meal Plan","South Indian Meal Plan","Asian Meal Plan","Fusion Meal Plan","Maharashtra Meal Plan","Sattvikk Meal Plan"],G=({show:g,onHide:s,editingPlan:t,onSubmit:r})=>{const[n,h]=m.useState({name:"",duration:"",category:"",subcategory:"",description:"",isActive:!0}),[d,y]=m.useState(!1),[c,v]=m.useState({}),{showNotification:j}=$();m.useEffect(()=>{h(t?{name:t.name||"",duration:t.duration||"",category:t.category||"",subcategory:t.subcategory||"",description:t.description||"",isActive:t.isActive??!0}:{name:"",duration:"",category:"",subcategory:"",description:"",isActive:!0}),v({})},[t,g]);const N=()=>{const o={};return n.name.trim()||(o.name="Plan name is required"),n.duration||(o.duration="Duration is required"),n.category||(o.category="Category is required"),v(o),Object.keys(o).length===0},S=async o=>{if(o.preventDefault(),!!N()){y(!0);try{t&&t._id?(await k.updateDietPlan(t._id,n),j({message:"Diet plan updated successfully",variant:"success"})):(await k.createDietPlan(n),j({message:"Diet plan created successfully",variant:"success"})),r()}catch(p){console.error("Error saving diet plan:",p),j({message:`Error ${t?"updating":"creating"} diet plan`,variant:"danger"})}finally{y(!1)}}},u=(o,p)=>{h(f=>({...f,[o]:p})),c[o]&&v(f=>({...f,[o]:""}))},b=o=>{var f;const p=(f=o.target.files)==null?void 0:f[0];if(p){if(p.type!=="application/pdf"){j({message:"Only PDF files are allowed",variant:"warning"}),o.target.value="";return}const D=10*1024*1024;if(p.size>D){j({message:"File size must be less than 10MB",variant:"warning"}),o.target.value="";return}u("pdfFile",p)}},E=()=>{h({name:"",duration:"",category:"",subcategory:"",description:"",isActive:!0}),v({}),s()};return e.jsxs(C,{show:g,onHide:E,size:"lg",centered:!0,children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:t?"Edit Diet Plan":"Create New Diet Plan"})}),e.jsxs(i,{onSubmit:S,children:[e.jsxs(C.Body,{children:[e.jsxs(F,{children:[e.jsx(w,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Plan Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(i.Control,{type:"text",value:n.name,onChange:o=>u("name",o.target.value),isInvalid:!!c.name,placeholder:"Enter diet plan name"}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.name})]})}),e.jsx(w,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Duration ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:n.duration,onChange:o=>u("duration",o.target.value),isInvalid:!!c.duration,children:[e.jsx("option",{value:"",children:"Select duration"}),R.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.duration})]})})]}),e.jsxs(F,{children:[e.jsx(w,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:n.category,onChange:o=>u("category",o.target.value),isInvalid:!!c.category,children:[e.jsx("option",{value:"",children:"Select category"}),M.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.category})]})}),e.jsx(w,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Subcategory (Optional)"}),e.jsxs(i.Select,{value:n.subcategory,onChange:o=>u("subcategory",o.target.value),children:[e.jsx("option",{value:"",children:"Select subcategory (optional)"}),O.map(o=>e.jsx("option",{value:o,children:o},o))]}),e.jsx(i.Text,{className:"text-muted"})]})})]}),e.jsx(F,{children:e.jsx(w,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"PDF File"}),e.jsx(i.Control,{type:"file",accept:".pdf",onChange:b}),e.jsx(i.Text,{className:"text-muted",children:"Upload a PDF file (max 10MB). Only PDF files are allowed."}),(t==null?void 0:t.pdfFile)&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"Current file: ",t.pdfFile.filename]})})]})})}),e.jsx(F,{children:e.jsx(w,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{as:"textarea",rows:3,value:n.description,onChange:o=>u("description",o.target.value),placeholder:"Enter diet plan description (optional)"})]})})}),e.jsx(F,{children:e.jsx(w,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Check,{type:"checkbox",label:"Active",checked:n.isActive,onChange:o=>u("isActive",o.target.checked)}),e.jsx(i.Text,{className:"text-muted",children:"Only active diet plans will be visible to users."})]})})})]}),e.jsxs(C.Footer,{children:[e.jsx(L,{variant:"secondary",onClick:E,children:"Cancel"}),e.jsx(L,{variant:"primary",type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),t?"Updating...":"Creating..."]}):t?"Update Plan":"Create Plan"})]})]})]})},ge=()=>{const[g,s]=m.useState([]),[t,r]=m.useState(!0),[n,h]=m.useState(""),[d,y]=m.useState({page:1,limit:10}),[c,v]=m.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[j,N]=m.useState(!1),[S,u]=m.useState(null),{showNotification:b}=$(),E=async()=>{try{r(!0);const a=await k.getAllDietPlans(d);s(a.data||[]),v({currentPage:a.currentPage||1,totalPages:a.totalPages||1,totalItems:a.totalItems||0,itemsPerPage:10})}catch(a){console.error("Error fetching diet plans:",a),b({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{r(!1)}};m.useEffect(()=>{(async()=>{try{r(!0);const l=await k.getAllDietPlans(d);s(l.data||[]),v({currentPage:l.currentPage||1,totalPages:l.totalPages||1,totalItems:l.totalItems||0,itemsPerPage:10})}catch(l){console.error("❌ Error fetching diet plans:",l),b({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{r(!1)}})()},[d]);const o=(g||[]).filter(a=>a.name.toLowerCase().includes(n.toLowerCase())||a.category.toLowerCase().includes(n.toLowerCase())||a.subcategory&&a.subcategory.toLowerCase().includes(n.toLowerCase())),p=async a=>{if(!a._id||!a.pdfFile){b({message:"No PDF file available for this diet plan",variant:"warning"});return}try{const l=await k.downloadPDF(a._id);k.triggerPDFDownload(l,a.pdfFile.filename),b({message:"PDF downloaded successfully",variant:"success"})}catch(l){console.error("Error downloading PDF:",l),b({message:"Error downloading PDF",variant:"danger"})}},f=()=>{N(!1),u(null),E()},D=a=>{y(l=>({...l,page:a}))};return e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Diet Plan",subName:"Manage and track diet plans"}),e.jsx("div",{className:"container-fluid",children:e.jsxs(U,{id:"diet-plan-container",title:"Diet Plans Management",description:"Manage and track all diet plans for rice challenge awareness",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search diet plans...",value:n,onChange:a=>h(a.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.category||"",onChange:a=>y(l=>({...l,category:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),M.map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.subcategory||"",onChange:a=>y(l=>({...l,subcategory:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Subcategories"}),O.map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.isActive===void 0?"":d.isActive.toString(),onChange:a=>y(l=>({...l,isActive:a.target.value===""?void 0:a.target.value==="true"})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("div",{className:"col-md-2 text-end",children:e.jsxs("button",{className:"btn btn-primary me-2",onClick:()=>N(!0),children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add New Plan"]})})]}),t?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan Name"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"PDF"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:o.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:a.name}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:a.duration})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:a.category})}),e.jsx("td",{children:a.subcategory?e.jsx("span",{className:"badge bg-light text-dark",children:a.subcategory}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:a.pdfFile?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-success mb-1",onClick:()=>p(a),title:"Download PDF",children:[e.jsx("i",{className:"fas fa-download me-1"}),a.pdfFile.originalName]}),e.jsxs("small",{className:"text-muted",children:[(a.pdfFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsx("span",{className:"text-muted",children:"No PDF"})}),e.jsx("td",{children:a.createdBy&&typeof a.createdBy=="object"?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:a.createdBy.username}),e.jsx("small",{className:"text-muted",children:a.createdBy.email})]}):e.jsx("span",{className:"text-muted",children:"Unknown"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${a.isActive?"bg-success":"bg-secondary"}`,children:a.isActive?"Active":"Inactive"})}),e.jsx("td",{children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"btn-group",role:"group",children:e.jsx("button",{className:"btn btn-sm btn-outline-warning",onClick:()=>{u(a),N(!0)},title:"Edit",children:e.jsx("i",{className:"fas fa-edit"})})})})]},a._id))})]})}),o.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No diet plans found."})}),c.totalPages>1&&e.jsx("nav",{"aria-label":"Diet plans pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${c.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(c.currentPage-1),disabled:c.currentPage===1,children:"Previous"})}),Array.from({length:c.totalPages},(a,l)=>l+1).map(a=>e.jsx("li",{className:`page-item ${c.currentPage===a?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(a),children:a})},a)),e.jsx("li",{className:`page-item ${c.currentPage===c.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(c.currentPage+1),disabled:c.currentPage===c.totalPages,children:"Next"})})]})})]})]})}),j&&e.jsx(G,{show:j,onHide:()=>{N(!1),u(null)},editingPlan:S,onSubmit:f})]})};export{ge as default};
