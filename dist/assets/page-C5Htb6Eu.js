var R=Object.defineProperty;var F=(a,r,l)=>r in a?R(a,r,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[r]=l;var D=(a,r,l)=>F(a,typeof r!="symbol"?r+"":r,l);import{j as e,R as k,d as y,l as S,r as u,F as O}from"./index-0HLXN9jP.js";import{I as m}from"./IconifyIcon-DuJ0ayig.js";import{C as v,a as C,b as I}from"./Card-D9dUu9rv.js";import{B as w}from"./Badge-DdSjzkxd.js";import{S as J}from"./Spinner-CbDhCaAZ.js";import{B as b}from"./ListGroup-CBnjCOb5.js";import{f as M}from"./numberFormat-DtcdhD-a.js";import{R as P}from"./react-apexcharts.min-DJAresIO.js";import{S as z}from"./Spinner-BwPiWwVH.js";import{P as G}from"./PageTitle-tCWcpWvy.js";import{C as H}from"./campaignContentsService-DCiZN_AJ.js";import{C as U}from"./challengerService-CZfwhhV-.js";import{A as V}from"./api-BDs4y23Q.js";import"./warning-W3isSzbl.js";import"./hook-Dw59LDrf.js";import"./extends-CF3RwP-h.js";import"./Nav-BJL0ULXp.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-anQzrTkU.js";import"./useMergedRefs-DCyeCzfk.js";import"./useEventCallback-DEudblyE.js";import"./Button-D6NS4gpE.js";const Y=a=>{const r=new Date(a),d=Math.floor((new Date().getTime()-r.getTime())/1e3);if(d<60)return"just now";if(d<3600){const n=Math.floor(d/60);return`${n} ${n===1?"minute":"minutes"} ago`}else if(d<86400){const n=Math.floor(d/3600);return`${n} ${n===1?"hour":"hours"} ago`}else{const n=Math.floor(d/86400);return`${n} ${n===1?"day":"days"} ago`}},B=({challengers:a,title:r="Recent Challengers",showHeader:l=!0,maxHeight:d="400px",isLoading:n=!1,error:h=null,onTitleClick:o})=>{const f=s=>{switch(s.toLowerCase()){case"weight loss":return"#ef4444";case"muscle building":return"#10b981";case"endurance":return"#f59e0b";case"flexibility":return"#8b5cf6";default:return"#6b7280"}},i=s=>{switch(s.toLowerCase()){case"weight loss":return"danger";case"muscle building":return"success";case"endurance":return"warning";case"flexibility":return"info";default:return"secondary"}},j=s=>{switch(s.toLowerCase()){case"vegetarian":return"solar:leaf-broken";case"keto":return"solar:fire-broken";case"high protein":return"solar:dumbbell-broken";case"low carb":return"solar:scale-broken";case"mediterranean":return"solar:planet-broken";default:return"solar:nutrition-broken"}},t=s=>s?"solar:check-circle-broken":"solar:pause-circle-broken",c=s=>s?"success":"secondary";return e.jsxs(v,{className:"h-100",children:[l&&e.jsxs(C,{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h5",{className:`card-title mb-0 ${o?"text-primary cursor-pointer":""}`,onClick:o,style:o?{cursor:"pointer"}:{},children:r}),e.jsx(w,{bg:"primary",pill:!0,children:a.length})]}),e.jsx(I,{className:"p-0",children:e.jsx("div",{style:{maxHeight:d,overflowY:"auto"},children:n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(J,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading challengers..."})]}):h?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(m,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:h})]}):e.jsx(b,{variant:"flush",children:a.length===0?e.jsxs(b.Item,{className:"text-center py-4 text-muted",children:[e.jsx(m,{icon:"solar:users-group-two-rounded-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No challengers available"})]}):a.map(s=>e.jsx(b.Item,{className:"px-3 py-3",children:e.jsxs(k,{className:"align-items-start",children:[e.jsx(y,{xs:"auto",children:e.jsx("div",{className:"avatar-sm rounded-circle d-flex align-items-center justify-content-center",style:{backgroundColor:`${f(s.type)}20`},children:e.jsx(m,{icon:j(s.category),className:"fs-18",color:f(s.type)})})}),e.jsxs(y,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0 text-truncate flex-grow-1 me-2",children:s.name}),e.jsxs(w,{bg:c(s.isActive),className:"d-flex align-items-center",children:[e.jsx(m,{icon:t(s.isActive),className:"fs-12 me-1"}),s.isActive?"Active":"Inactive"]})]}),e.jsxs("p",{className:"text-muted mb-2 small",children:[e.jsx(m,{icon:"solar:phone-broken",className:"fs-12 me-1"}),s.mobile]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(w,{bg:i(s.type),className:"me-2",children:s.type}),e.jsx("span",{className:"text-muted small",children:s.category})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"text-primary fw-semibold small",children:[e.jsx(m,{icon:"solar:clock-circle-broken",className:"fs-12 me-1"}),s.duration]})})]}),s.subcategory&&e.jsx("div",{className:"mb-2",children:e.jsx(w,{bg:"light",text:"dark",className:"small",children:s.subcategory})}),s.createdAt&&e.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[e.jsx(m,{icon:"solar:calendar-broken",className:"fs-12 me-1"}),"Created ",Y(s.createdAt)]})]})]})},s._id))})})})]})},W=({posts:a,title:r="Recent Posts",showHeader:l=!0,maxHeight:d="400px",isLoading:n=!1,error:h=null,onTitleClick:o})=>{const f=t=>{const c=new Date(t*1e3),g=Math.floor((new Date().getTime()-c.getTime())/1e3);if(g<60)return"just now";if(g<3600){const p=Math.floor(g/60);return`${p} ${p===1?"minute":"minutes"} ago`}else if(g<86400){const p=Math.floor(g/3600);return`${p} ${p===1?"hour":"hours"} ago`}else{const p=Math.floor(g/86400);return`${p} ${p===1?"day":"days"} ago`}},i=(t,c=100)=>t.length>c?`${t.substring(0,c)}...`:t,j=t=>{const c=`https://www.instagram.com/${t}/#`;window.open(c,"_blank")};return e.jsxs(v,{className:"h-100",children:[l&&e.jsxs(C,{className:`d-flex align-items-center justify-content-between ${o?"user-select-none":""}`,style:{cursor:o?"pointer":"default",transition:o?"background-color 0.2s":"none"},onClick:o,title:o?"Click to open hashtag performance in new tab":"",onMouseEnter:t=>{o&&(t.currentTarget.style.backgroundColor="#f8f9fa")},onMouseLeave:t=>{o&&(t.currentTarget.style.backgroundColor="")},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h5",{className:"card-title mb-0 me-2",children:r}),o&&e.jsx(m,{icon:"solar:external-link-broken",className:"fs-12 text-muted"})]}),e.jsx(w,{bg:"primary",pill:!0,children:a.length})]}),e.jsx(I,{className:"p-0",children:e.jsx("div",{style:{maxHeight:d,overflowY:"auto"},children:e.jsx(b,{variant:"flush",children:n?e.jsxs(b.Item,{className:"text-center py-4 text-muted",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading campaign posts..."})]}):h?e.jsxs(b.Item,{className:"text-center py-4 text-muted",children:[e.jsx(m,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2 text-danger"}),e.jsx("p",{className:"text-danger",children:h})]}):a.length===0?e.jsxs(b.Item,{className:"text-center py-4 text-muted",children:[e.jsx(m,{icon:"solar:document-text-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No campaign posts available"})]}):a.map(t=>e.jsx(b.Item,{className:"px-3 py-3",children:e.jsxs(k,{className:"align-items-start",children:[e.jsx(y,{xs:"auto",children:e.jsxs("div",{className:"rounded-circle overflow-hidden position-relative",style:{width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"},children:[e.jsx("img",{src:t.influencer.profile_pic_url,alt:t.influencer.full_name,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:c=>{const s=c.target;s.style.display="none";const g=s.nextElementSibling;g&&(g.style.display="flex")}}),e.jsx("div",{style:{width:"100%",height:"100%",display:"none",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",position:"absolute",top:"0",left:"0"},children:e.jsx(m,{icon:"solar:user-broken",className:"fs-18 text-muted"})})]})}),e.jsxs(y,{children:[e.jsx("div",{className:"d-flex align-items-start justify-content-between mb-2",children:e.jsxs("div",{className:"flex-grow-1 me-2",children:[e.jsx("h6",{className:"mb-1 text-truncate",children:e.jsxs("span",{className:"text-primary",style:{cursor:"pointer",textDecoration:"none"},onClick:()=>j(t.influencer.username),onMouseEnter:c=>{c.currentTarget.style.textDecoration="underline"},onMouseLeave:c=>{c.currentTarget.style.textDecoration="none"},title:`Open @${t.influencer.username} on Instagram`,children:["@",t.influencer.username]})}),e.jsxs("div",{className:"d-flex align-items-center text-muted small mb-1",children:[e.jsxs("span",{className:"me-2",children:[" ",t.influencer.full_name]}),e.jsx(w,{bg:"outline-primary",text:"primary",className:"me-2",children:t.is_video?"Video":t.is_carousel?"Carousel":"Photo"})]})]})}),e.jsx("p",{className:"text-muted mb-2 small",children:i(t.caption)}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[t.hashtags.slice(0,2).map((c,s)=>e.jsx(w,{bg:"light",text:"dark",className:"me-1 small",children:c},s)),t.hashtags.length>2&&e.jsxs("span",{className:"text-muted small",children:["+",t.hashtags.length-2," more"]})]}),e.jsx("small",{className:"text-muted",children:f(t.created_timestamp)})]}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(m,{icon:"solar:heart-broken",className:"fs-12 me-1 text-danger"}),e.jsx("span",{className:"small text-muted",children:t.total_likes})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(m,{icon:"solar:chat-round-line-broken",className:"fs-12 me-1 text-primary"}),e.jsx("span",{className:"small text-muted",children:t.total_comments})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(m,{icon:"solar:share-broken",className:"fs-12 me-1 text-success"}),e.jsx("span",{className:"small text-muted",children:t.reshare_count||0})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(m,{icon:"solar:eye-broken",className:"fs-12 me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:M(t.reach)})]})]})})]})]})},t._id))})})})]})},Q=()=>{const a={chart:{type:"bar",height:350,toolbar:{show:!1}},series:[{name:"Completed",data:[8,12,15,18,22,25,28,32,35,38,42,45],color:"#10b981"},{name:"In Progress",data:[5,8,10,12,15,18,20,23,25,28,30,32],color:"#3b82f6"},{name:"Not Started",data:[12,18,22,25,28,30,32,35,38,40,42,45],color:"#6b7280"}],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark"}};return e.jsxs(v,{children:[e.jsx(C,{children:e.jsx("h5",{className:"card-title mb-0",children:"Challenges Progress"})}),e.jsx(I,{children:e.jsx(P,{options:a,series:a.series,type:"bar",height:350})})]})},Z=({dashboardData:a,isLoading:r=!1,error:l=null})=>{const n=(()=>{var o;if((o=a==null?void 0:a.postGraphData)!=null&&o.itchotels&&Array.isArray(a.postGraphData.itchotels)){const f=a.postGraphData.itchotels.filter(i=>i.y!==null).map(i=>({timestamp:i.x,date:new Date(i.x).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:i.y||0})).sort((i,j)=>i.timestamp-j.timestamp);return{categories:f.map(i=>i.date),publishedData:f.map(i=>i.value),timestamps:f.map(i=>i.timestamp)}}return{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],publishedData:[5,8,12,15,18,22,25,28,32,35,38,42],timestamps:[]}})(),h={chart:{type:"area",height:350,toolbar:{show:!1}},series:[{name:"Posts Count",data:n.publishedData,color:"#f59e0b"}],xaxis:{categories:n.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3,stops:[0,90,100]}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(v,{children:[e.jsx(C,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"card-title mb-0",children:"Post Analytics"}),a&&e.jsxs("div",{className:"d-flex gap-3 text-muted small",children:[e.jsxs("span",{children:["Stories: ",e.jsx("strong",{children:a.totalStories})]}),e.jsxs("span",{children:["Views: ",e.jsx("strong",{children:M(a.totalViews)})]}),e.jsxs("span",{children:["Likes: ",e.jsx("strong",{children:M(a.totalLikes)})]})]})]})}),e.jsx(I,{children:r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"350px"},children:e.jsx(z,{})}):l?e.jsx("div",{className:"d-flex justify-content-center align-items-center text-danger",style:{height:"350px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-alert-circle-outline fs-2 mb-2"}),e.jsx("p",{className:"mb-0",children:l})]})}):e.jsx(P,{options:h,series:h.series,type:"area",height:350})})]})},$=a=>{var r,l,d;try{const n=(r=S.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:r.toString();if(n){const o=JSON.parse(n);if(o!=null&&o.token)return o.token}const h=(l=S.getCookie("token"))==null?void 0:l.toString();return a||h||localStorage.getItem("authToken")||""}catch(n){console.warn("Failed to get auth token from session:",n);const h=(d=S.getCookie("token"))==null?void 0:d.toString();return a||h||localStorage.getItem("authToken")||""}},N=class N{constructor(){D(this,"fallbackToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZThkMjQxYzkyMWE5ZDEzMzhmNGMwMyIsImlhdCI6MTc2MDQyMzkyMiwiZXhwIjoxNzYwNTEwMzIyfQ.jpyOCiQ_lunYouOyLSOXTWOJ3pDfWGg0JKxd9Rgparo")}static getInstance(){return N.instance||(N.instance=new N),N.instance}async getDashboardData(){try{const r=$(this.fallbackToken);if(!r)return console.warn("Authentication token not found, using mock data."),this.getMockDashboardData();const l=await fetch(`${V.API_URL}/dashboard`,{method:"GET",headers:{authorization:r,"Content-Type":"application/json"}});if(!l.ok){const n=await l.json().catch(()=>({message:"Failed to fetch dashboard data"}));if(l.status===401||n.message==="Unauthorized!")return console.warn("Using mock data due to authentication failure. Please check your token."),this.getMockDashboardData();throw new Error(n.message||`HTTP ${l.status}: Failed to fetch dashboard data`)}return await l.json()}catch(r){if(console.error("Dashboard API Error:",r),r.name==="TypeError"&&r.message.includes("fetch"))return console.warn("Network error detected, using mock data."),this.getMockDashboardData();throw new Error(r.message||"Failed to fetch dashboard data")}}getMockDashboardData(){return{totalStories:25,totalViews:15e3,totalLikes:12500,postGraphData:{itchotels:[{x:170424e7,y:2},{x:17073504e5,y:3},{x:170856e7,y:4},{x:17099424e5,y:5},{x:17183232e5,y:3},{x:17241984e5,y:6},{x:17320608e5,y:4},{x:1737936e6,y:7},{x:17479584e5,y:5},{x:17555616e5,y:8},{x:17576352e5,y:6},{x:175824e7,y:9}],itchotels_count:25}}}setAuthToken(r){this.fallbackToken=r}getAuthToken(){return $(this.fallbackToken)}};D(N,"instance");let A=N;const K=A.getInstance(),Ne=()=>{const[a,r]=u.useState([]),[l,d]=u.useState(!0),[n,h]=u.useState(null),[o,f]=u.useState(null),[i,j]=u.useState(!0),[t,c]=u.useState(null),[s,g]=u.useState([]),[p,E]=u.useState(!0),[_,T]=u.useState(null);return u.useEffect(()=>{(async()=>{try{j(!0),c(null);const x=await K.getDashboardData();f(x)}catch(x){c("Failed to fetch dashboard data"),console.error("Error fetching dashboard data:",x)}finally{j(!1)}})()},[]),u.useEffect(()=>{(async()=>{try{d(!0);const x=await H.getCampaignContents("daawatbiryani",1,10);x.success&&x.data.posts&&r(x.data.posts)}catch(x){h("Failed to fetch campaign contents"),console.error("Error fetching campaign contents:",x)}finally{d(!1)}})()},[]),u.useEffect(()=>{(async()=>{try{E(!0),T(null);const x=await U.getAllChallengers({limit:10,page:1});x.data&&g(x.data)}catch(x){T("Failed to fetch challengers"),console.error("Error fetching challengers:",x)}finally{E(!1)}})()},[]),e.jsxs(e.Fragment,{children:[e.jsx(G,{subName:"Daawat",title:"Dashboard Analytics"}),e.jsx("div",{className:"mb-4"}),e.jsxs(k,{className:"mb-4 g-3",children:[e.jsx(y,{xl:6,lg:6,md:12,children:e.jsx(Q,{})}),e.jsx(y,{xl:6,lg:12,md:12,children:e.jsx(Z,{dashboardData:o,isLoading:i,error:t})})]}),e.jsxs(k,{className:"mb-4 g-3",children:[e.jsx(y,{xl:6,lg:6,md:12,children:e.jsx(B,{challengers:s,title:"Recent Challengers",showHeader:!0,maxHeight:"400px",isLoading:p,error:_,onTitleClick:()=>window.open("/challengers","_blank")})}),e.jsx(y,{xl:6,lg:12,md:12,children:e.jsx(W,{posts:a,title:"Recent Posts",showHeader:!0,maxHeight:"400px",isLoading:l,error:n,onTitleClick:()=>window.open("/social/hashtag-performance","_blank")})})]}),e.jsx(O,{})]})};export{Ne as default};
