import{l as T,r as u,i as $,j as e,R as C,d as f}from"./index-CQoIeUZd.js";import{C as O}from"./ComponentContainerCard-CHqrNMjP.js";import{P as U}from"./PageTitle-r1R6ZAE-.js";import{A as R}from"./api-Cgyc7qv4.js";import{M as D}from"./Modal-BraMhR8h.js";import{F as i}from"./Form-BHQXA91g.js";import{B as L}from"./Button-CTUO1UiG.js";import"./Card-BKwV0xe3.js";import"./IconifyIcon-CUdZ2bbF.js";import"./AbstractModalHeader-OBp02WDc.js";import"./useWindow-Czc89hX_.js";import"./usePrevious-CQ691Z4Z.js";import"./useEventCallback-DsigtgEy.js";import"./hasClass-DVir8ym0.js";import"./useMergedRefs-C_sYzPN2.js";import"./NoopTransition-BpYpk5hA.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-eV8FjGte.js";import"./FormControl-DWoOkngb.js";import"./warning-kD2yLmJa.js";import"./FormLabel-znV6bOwv.js";import"./ElementChildren-Bk8xUZer.js";import"./FormGroup-C0dHtb9l.js";import"./FormSelect-DvcgbTcK.js";import"./FormText-8GS1meLy.js";import"./Button-8NGCVDuw.js";const N=R.API_URL,x=g=>{var n,a,o;try{const r=(n=T.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:n.toString();if(r){const d=JSON.parse(r);if(d!=null&&d.token)return d.token}const h=(a=T.getCookie("token"))==null?void 0:a.toString();return g||h||localStorage.getItem("authToken")||""}catch(r){return console.warn("Failed to get auth token from session:",r),((o=T.getCookie("token"))==null?void 0:o.toString())||localStorage.getItem("authToken")||""}},A=()=>({authorization:x(),"Content-Type":"application/json"}),I=()=>({authorization:x()});class k{static async getAllDietPlans(n){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new URLSearchParams;n!=null&&n.category&&o.append("category",n.category),n!=null&&n.subcategory&&o.append("subcategory",n.subcategory),n!=null&&n.type&&o.append("type",n.type),(n==null?void 0:n.isActive)!==void 0&&o.append("isActive",n.isActive.toString()),n!=null&&n.page&&o.append("page",n.page.toString()),n!=null&&n.limit&&o.append("limit",n.limit.toString());const r=await fetch(`${N}/dietplans?${o.toString()}`,{method:"GET",headers:A()});if(!r.ok)throw new Error(`Failed to fetch diet plans: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error fetching diet plans:",a),a}}static async getDietPlanById(n){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${n}`,{method:"GET",headers:A()});if(!o.ok)throw new Error(`Failed to fetch diet plan: ${o.statusText}`);return await o.json()}catch(a){throw console.error("Error fetching diet plan:",a),a}}static async createDietPlan(n){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new FormData;o.append("name",n.name),o.append("duration",n.duration),o.append("type",n.type),o.append("category",n.category),o.append("isActive",n.isActive.toString()),n.subcategory&&o.append("subcategory",n.subcategory),n.description&&o.append("description",n.description),n.pdfFile&&o.append("pdfFile",n.pdfFile);const r=await fetch(`${N}/dietplans`,{method:"POST",headers:I(),body:o});if(!r.ok)throw new Error(`Failed to create diet plan: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error creating diet plan:",a),a}}static async updateDietPlan(n,a){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=new FormData;r.append("name",a.name),r.append("duration",a.duration),r.append("type",a.type),r.append("category",a.category),r.append("isActive",a.isActive.toString()),a.subcategory&&r.append("subcategory",a.subcategory),a.description&&r.append("description",a.description),a.pdfFile&&r.append("pdfFile",a.pdfFile);const h=await fetch(`${N}/dietplans/${n}`,{method:"PUT",headers:I(),body:r});if(!h.ok)throw new Error(`Failed to update diet plan: ${h.statusText}`);return await h.json()}catch(o){throw console.error("Error updating diet plan:",o),o}}static async deleteDietPlan(n){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${n}`,{method:"DELETE",headers:A()});if(!o.ok)throw new Error(`Failed to delete diet plan: ${o.statusText}`)}catch(a){throw console.error("Error deleting diet plan:",a),a}}static async deleteAllDietPlans(){try{if(!x())throw new Error("Authentication token not found. Please login again.");const a=await fetch(`${N}/dietplans`,{method:"DELETE",headers:A()});if(!a.ok)throw new Error(`Failed to delete all diet plans: ${a.statusText}`)}catch(n){throw console.error("Error deleting all diet plans:",n),n}}static async downloadPDF(n){try{const a=x();if(!a)throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${n}/download`,{method:"GET",headers:{authorization:a}});if(!o.ok)throw new Error(`Failed to download PDF: ${o.statusText}`);return await o.blob()}catch(a){throw console.error("Error downloading PDF:",a),a}}static triggerPDFDownload(n,a){const o=window.URL.createObjectURL(n),r=document.createElement("a");r.href=o,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}}const B=["Vegetarian","Vegan","Keto","High Protein","Low Carb","Mediterranean","Paleo","Intermittent Fasting"],G=["Weight Loss","Weight Gain","Muscle Building","Maintenance","Athletic Performance","General Health"],H=["7 days","14 days","1 month","2 months","3 months","6 months"],_=["Beginner","Intermediate","Advanced","Low Sodium","High Fiber","Gluten Free","Dairy Free","Low Sugar","Heart Healthy","Anti-Inflammatory","Quick Prep","Budget Friendly"],M=({show:g,onHide:n,editingPlan:a,onSubmit:o})=>{const[r,h]=u.useState({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),[d,j]=u.useState(!1),[l,b]=u.useState({}),{showNotification:y}=$();u.useEffect(()=>{h(a?{name:a.name||"",duration:a.duration||"",type:a.type||"",category:a.category||"",subcategory:a.subcategory||"",description:a.description||"",isActive:a.isActive??!0}:{name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({})},[a,g]);const P=()=>{const s={};return r.name.trim()||(s.name="Plan name is required"),r.duration||(s.duration="Duration is required"),r.type||(s.type="Type is required"),r.category||(s.category="Category is required"),b(s),Object.keys(s).length===0},S=async s=>{if(s.preventDefault(),!!P()){j(!0);try{a&&a._id?(await k.updateDietPlan(a._id,r),y({message:"Diet plan updated successfully",variant:"success"})):(await k.createDietPlan(r),y({message:"Diet plan created successfully",variant:"success"})),o()}catch(p){console.error("Error saving diet plan:",p),y({message:`Error ${a?"updating":"creating"} diet plan`,variant:"danger"})}finally{j(!1)}}},m=(s,p)=>{h(v=>({...v,[s]:p})),l[s]&&b(v=>({...v,[s]:""}))},w=s=>{var v;const p=(v=s.target.files)==null?void 0:v[0];if(p){if(p.type!=="application/pdf"){y({message:"Only PDF files are allowed",variant:"warning"}),s.target.value="";return}const F=10*1024*1024;if(p.size>F){y({message:"File size must be less than 10MB",variant:"warning"}),s.target.value="";return}m("pdfFile",p)}},E=()=>{h({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({}),n()};return e.jsxs(D,{show:g,onHide:E,size:"lg",centered:!0,children:[e.jsx(D.Header,{closeButton:!0,children:e.jsx(D.Title,{children:a?"Edit Diet Plan":"Create New Diet Plan"})}),e.jsxs(i,{onSubmit:S,children:[e.jsxs(D.Body,{children:[e.jsxs(C,{children:[e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Plan Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(i.Control,{type:"text",value:r.name,onChange:s=>m("name",s.target.value),isInvalid:!!l.name,placeholder:"Enter diet plan name"}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.name})]})}),e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Duration ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.duration,onChange:s=>m("duration",s.target.value),isInvalid:!!l.duration,children:[e.jsx("option",{value:"",children:"Select duration"}),H.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.duration})]})})]}),e.jsxs(C,{children:[e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.type,onChange:s=>m("type",s.target.value),isInvalid:!!l.type,children:[e.jsx("option",{value:"",children:"Select type"}),G.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.type})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.category,onChange:s=>m("category",s.target.value),isInvalid:!!l.category,children:[e.jsx("option",{value:"",children:"Select category"}),B.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.category})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Subcategory"}),e.jsxs(i.Select,{value:r.subcategory,onChange:s=>m("subcategory",s.target.value),children:[e.jsx("option",{value:"",children:"Select subcategory (optional)"}),_.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsx(i.Text,{className:"text-muted",children:"Optional additional classification for the diet plan."})]})})]}),e.jsx(C,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"PDF File"}),e.jsx(i.Control,{type:"file",accept:".pdf",onChange:w}),e.jsx(i.Text,{className:"text-muted",children:"Upload a PDF file (max 10MB). Only PDF files are allowed."}),(a==null?void 0:a.pdfFile)&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"Current file: ",a.pdfFile.filename]})})]})})}),e.jsx(C,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{as:"textarea",rows:3,value:r.description,onChange:s=>m("description",s.target.value),placeholder:"Enter diet plan description (optional)"})]})})}),e.jsx(C,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Check,{type:"checkbox",label:"Active",checked:r.isActive,onChange:s=>m("isActive",s.target.checked)}),e.jsx(i.Text,{className:"text-muted",children:"Only active diet plans will be visible to users."})]})})})]}),e.jsxs(D.Footer,{children:[e.jsx(L,{variant:"secondary",onClick:E,children:"Cancel"}),e.jsx(L,{variant:"primary",type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),a?"Updating...":"Creating..."]}):a?"Update Plan":"Create Plan"})]})]})]})},xe=()=>{const[g,n]=u.useState([]),[a,o]=u.useState(!0),[r,h]=u.useState(""),[d,j]=u.useState({page:1,limit:10}),[l,b]=u.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[y,P]=u.useState(!1),[S,m]=u.useState(null),{showNotification:w}=$(),E=async()=>{try{o(!0);const t=await k.getAllDietPlans(d);n(t.data||[]),b({currentPage:t.currentPage||1,totalPages:t.totalPages||1,totalItems:t.totalItems||0,itemsPerPage:10})}catch(t){console.error("Error fetching diet plans:",t),w({message:"Error fetching diet plans",variant:"danger"}),n([])}finally{o(!1)}};u.useEffect(()=>{(async()=>{try{o(!0);const c=await k.getAllDietPlans(d);n(c.data||[]),b({currentPage:c.currentPage||1,totalPages:c.totalPages||1,totalItems:c.totalItems||0,itemsPerPage:10})}catch(c){console.error("❌ Error fetching diet plans:",c),w({message:"Error fetching diet plans",variant:"danger"}),n([])}finally{o(!1)}})()},[d]);const s=(g||[]).filter(t=>t.name.toLowerCase().includes(r.toLowerCase())||t.category.toLowerCase().includes(r.toLowerCase())||t.type.toLowerCase().includes(r.toLowerCase())||t.subcategory&&t.subcategory.toLowerCase().includes(r.toLowerCase())),p=async t=>{if(!t._id||!t.pdfFile){w({message:"No PDF file available for this diet plan",variant:"warning"});return}try{const c=await k.downloadPDF(t._id);k.triggerPDFDownload(c,t.pdfFile.filename),w({message:"PDF downloaded successfully",variant:"success"})}catch(c){console.error("Error downloading PDF:",c),w({message:"Error downloading PDF",variant:"danger"})}},v=()=>{P(!1),m(null),E()},F=t=>{j(c=>({...c,page:t}))};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Diet Plan",subName:"Manage and track diet plans"}),e.jsx("div",{className:"container-fluid",children:e.jsxs(O,{id:"diet-plan-container",title:"Diet Plans Management",description:"Manage and track all diet plans for rice challenge awareness",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search diet plans...",value:r,onChange:t=>h(t.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.category||"",onChange:t=>j(c=>({...c,category:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),B.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.subcategory||"",onChange:t=>j(c=>({...c,subcategory:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Subcategories"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.type||"",onChange:t=>j(c=>({...c,type:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Types"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.isActive===void 0?"":d.isActive.toString(),onChange:t=>j(c=>({...c,isActive:t.target.value===""?void 0:t.target.value==="true"})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("div",{className:"col-md-2 text-end",children:e.jsxs("button",{className:"btn btn-primary me-2",onClick:()=>P(!0),children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add New Plan"]})})]}),a?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan Name"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"PDF"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:t.name}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:t.duration})}),e.jsx("td",{children:t.type}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:t.category})}),e.jsx("td",{children:t.subcategory?e.jsx("span",{className:"badge bg-light text-dark",children:t.subcategory}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:t.pdfFile?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-success mb-1",onClick:()=>p(t),title:"Download PDF",children:[e.jsx("i",{className:"fas fa-download me-1"}),t.pdfFile.originalName]}),e.jsxs("small",{className:"text-muted",children:[(t.pdfFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsx("span",{className:"text-muted",children:"No PDF"})}),e.jsx("td",{children:t.createdBy&&typeof t.createdBy=="object"?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:t.createdBy.username}),e.jsx("small",{className:"text-muted",children:t.createdBy.email})]}):e.jsx("span",{className:"text-muted",children:"Unknown"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.isActive?"bg-success":"bg-secondary"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"btn-group",role:"group",children:e.jsx("button",{className:"btn btn-sm btn-outline-warning",onClick:()=>{m(t),P(!0)},title:"Edit",children:e.jsx("i",{className:"fas fa-edit"})})})})]},t._id))})]})}),s.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No diet plans found."})}),l.totalPages>1&&e.jsx("nav",{"aria-label":"Diet plans pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${l.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>F(l.currentPage-1),disabled:l.currentPage===1,children:"Previous"})}),Array.from({length:l.totalPages},(t,c)=>c+1).map(t=>e.jsx("li",{className:`page-item ${l.currentPage===t?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>F(t),children:t})},t)),e.jsx("li",{className:`page-item ${l.currentPage===l.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>F(l.currentPage+1),disabled:l.currentPage===l.totalPages,children:"Next"})})]})})]})]})}),y&&e.jsx(M,{show:y,onHide:()=>{P(!1),m(null)},editingPlan:S,onSubmit:v})]})};export{xe as default};
