import{h as C,r as l,j as e,F as k}from"./index-D0Qb0t7Z.js";import{C as F}from"./ComponentContainerCard-Cl5dXni7.js";import{P as S}from"./PageTitle-DhKijRBZ.js";import{C as A}from"./challengerService-DdS6wp49.js";import{A as f}from"./api-ClkYFUjX.js";import"./Card-DKksp7wu.js";import"./IconifyIcon-qpw3OJPs.js";const I=()=>{const{showNotification:o}=C(),[h,x]=l.useState(!1),[g,u]=l.useState([]),[c,j]=l.useState(""),[r,N]=l.useState(""),[i,b]=l.useState(""),[d,p]=l.useState({page:1,limit:10}),[a,P]=l.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),v=[{label:"Meta2 - LPV Campaign",url:"https://www.daawat.com/rya/?utm_source=icubeswire&utm_medium=meta2&utm_campaign=lpv"},{label:"Meta2 - Custom Audience",url:"https://www.daawat.com/rya/?utm_source=icubeswire&utm_medium=meta2&utm_campaign=custom+audience"},{label:"RYA Base URL",url:"https://www.daawat.com/rya/"}];l.useEffect(()=>{(async()=>{try{x(!0);const t={...d,utm_url:c||void 0,from:r||void 0,to:i||void 0},m=await A.getUTMChallengers(t);u(m.data||[]),P({currentPage:m.currentPage||1,totalPages:m.totalPages||1,totalItems:m.totalItems||0,itemsPerPage:d.limit||10})}catch(t){console.error("âŒ Error fetching UTM challengers:",t),o({message:"Error fetching challengers",variant:"danger"}),u([])}finally{x(!1)}})()},[d.page,d.limit,c,r,i,o]);const n=s=>{p(t=>({...t,page:s}))},y=s=>{try{if(s.startsWith("http://")||s.startsWith("https://")){window.open(s,"_blank","noopener,noreferrer");return}let t=s;s.startsWith("/")?t=`${f.BASE_URL}${s}`:t=`${f.BASE_URL}/${s}`,window.open(t,"_blank","noopener,noreferrer")}catch(t){console.error("Error opening PDF:",t),o({message:`Error opening PDF: ${t instanceof Error?t.message:"Unknown error"}`,variant:"danger"})}},w=()=>{j(""),N(""),b(""),p({page:1,limit:10})};return e.jsxs(e.Fragment,{children:[e.jsx(S,{subName:"Daawat",title:"Challengers by UTM"}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-md-3 mb-2",children:e.jsx("div",{className:"card shadow-sm border-0 h-100 bg-primary-subtle",children:e.jsxs("div",{className:"card-body d-flex flex-column justify-content-center align-items-center",children:[e.jsx("h6",{className:"mb-1 text-primary",children:"Total Challengers"}),e.jsx("h3",{className:"mb-0 fw-bold text-primary",children:a.totalItems})]})})})}),e.jsxs(F,{id:"challengers-utm-list",title:"UTM Challengers",description:"View challengers filtered by UTM parameters and date range",children:[e.jsxs("div",{className:"card mb-4 border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-light",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"fas fa-filter me-2"}),"Filters"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-link me-2"}),"UTM URL"]}),e.jsxs("select",{className:"form-select",value:c,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"Select UTM URL..."}),v.map((s,t)=>e.jsx("option",{value:s.url,children:s.label},t))]}),e.jsx("small",{className:"text-muted",children:"Select a UTM URL to filter challengers"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-calendar-alt me-2"}),"From Date"]}),e.jsx("input",{type:"date",className:"form-control",value:r,onChange:s=>N(s.target.value),max:i||void 0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-calendar-alt me-2"}),"To Date"]}),e.jsx("input",{type:"date",className:"form-control",value:i,onChange:s=>b(s.target.value),min:r||void 0})]})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs("button",{className:"btn btn-outline-secondary",onClick:w,disabled:h,children:[e.jsx("i",{className:"fas fa-redo me-2"}),"Clear Filters"]})})]})]}),h?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading challengers..."})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-bordered",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"5%"},children:"#"}),e.jsx("th",{style:{width:"20%"},children:"Name & Contact"}),e.jsx("th",{style:{width:"15%"},children:"Category"}),e.jsx("th",{style:{width:"10%"},children:"Duration"}),e.jsx("th",{style:{width:"15%"},children:"Subcategory"}),e.jsx("th",{style:{width:"12%"},children:"Created At"}),e.jsx("th",{style:{width:"13%"},children:"Diet Plan"})]})}),e.jsx("tbody",{children:g.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-5",children:[e.jsx("i",{className:"fas fa-users fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No challengers found"}),e.jsx("p",{className:"text-muted",children:c||r||i?"Try adjusting your filter criteria.":"Apply filters to search for challengers."})]})}):g.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:(a.currentPage-1)*a.itemsPerPage+t+1}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"avatar-md me-2",children:e.jsx("div",{className:"avatar-title bg-primary-subtle text-primary rounded-circle fw-bold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:s.name}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-phone me-1"}),e.jsx("a",{href:`tel:${s.mobile}`,className:"text-decoration-none",children:s.mobile})]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("span",{className:`badge ${s.category==="Vegetarian"?"bg-success":s.category==="Veg + Egg"?"bg-info":"bg-warning"} mb-1`,children:s.category}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.type})]})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:s.duration})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:s.subcategory||"N/A"})}),e.jsxs("td",{children:[e.jsx("span",{className:"text-muted",children:s.createdAt?new Date(s.createdAt).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"}):"N/A"}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:s.createdAt?new Date(s.createdAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"}):""})]}),e.jsx("td",{children:s.pdf?e.jsxs("button",{className:"btn btn-sm btn-outline-success",onClick:()=>y(s.pdf),title:"View PDF",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"View Plan"]}):e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-ban me-1"}),"No plan"]})})]},s._id))})]})}),a.totalPages>1&&e.jsxs("div",{className:"mt-4",children:[e.jsx("nav",{"aria-label":"Challengers pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${a.currentPage===1?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>n(a.currentPage-1),disabled:a.currentPage===1,children:[e.jsx("i",{className:"fas fa-chevron-left me-1"}),"Previous"]})}),a.currentPage>3&&e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"page-item",children:e.jsx("button",{className:"page-link",onClick:()=>n(1),children:"1"})}),a.currentPage>4&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})})]}),Array.from({length:a.totalPages},(s,t)=>t+1).filter(s=>s===a.currentPage||s===a.currentPage-2||s===a.currentPage-1||s===a.currentPage+1||s===a.currentPage+2).map(s=>e.jsx("li",{className:`page-item ${a.currentPage===s?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>n(s),children:s})},s)),a.currentPage<a.totalPages-2&&e.jsxs(e.Fragment,{children:[a.currentPage<a.totalPages-3&&e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})}),e.jsx("li",{className:"page-item",children:e.jsx("button",{className:"page-link",onClick:()=>n(a.totalPages),children:a.totalPages})})]}),e.jsx("li",{className:`page-item ${a.currentPage===a.totalPages?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>n(a.currentPage+1),disabled:a.currentPage===a.totalPages,children:["Next",e.jsx("i",{className:"fas fa-chevron-right ms-1"})]})})]})}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("small",{className:"text-muted",children:["Showing ",(a.currentPage-1)*a.itemsPerPage+1," to"," ",Math.min(a.currentPage*a.itemsPerPage,a.totalItems)," of"," ",a.totalItems," challengers"]})})]})]})]}),e.jsx(k,{})]})};export{I as default};
