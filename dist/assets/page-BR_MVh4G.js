var O=Object.defineProperty;var z=(a,r,o)=>r in a?O(a,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[r]=o;var P=(a,r,o)=>z(a,typeof r!="symbol"?r+"":r,o);import{j as e,R as S,d as y,l as L,r as b,F as J}from"./index-Ooz62fiS.js";import{I as g}from"./IconifyIcon-DLaRtdgV.js";import{C as T,a as E,b as M}from"./Card-4Zn0WiP8.js";import{B as I}from"./Badge-BQF4iN5G.js";import{S as F}from"./Spinner-DPmn1Obm.js";import{B as k}from"./ListGroup-DA7RC3bd.js";import{f as D}from"./numberFormat-yIx-nKgv.js";import{R as _}from"./react-apexcharts.min-CV7ppjRK.js";import{S as U}from"./Spinner-CLwjv_Ny.js";import{P as H}from"./PageTitle-CgH_ORAJ.js";import{C as Y}from"./campaignContentsService-K9_tJFem.js";import{C as Z}from"./challengerService-CdyQ75bw.js";import{A as B}from"./api-6P2W6CpQ.js";import"./warning-BQiMBIrW.js";import"./hook-D0s653fK.js";import"./extends-CF3RwP-h.js";import"./Nav-BuKJFli2.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-DK9r2u4A.js";import"./useMergedRefs-DgqNUnnU.js";import"./useEventCallback-BraK-Qar.js";import"./Button-BsnQaD7D.js";const W=a=>{const r=new Date(a),m=Math.floor((new Date().getTime()-r.getTime())/1e3);if(m<60)return"just now";if(m<3600){const n=Math.floor(m/60);return`${n} ${n===1?"minute":"minutes"} ago`}else if(m<86400){const n=Math.floor(m/3600);return`${n} ${n===1?"hour":"hours"} ago`}else{const n=Math.floor(m/86400);return`${n} ${n===1?"day":"days"} ago`}},Q=({challengers:a,title:r="Recent Challengers",showHeader:o=!0,maxHeight:m="400px",isLoading:n=!1,error:h=null,onTitleClick:l,challengrsGraphData:u})=>{const i=s=>{switch(s.toLowerCase()){case"weight loss":return"#ef4444";case"muscle building":return"#10b981";case"endurance":return"#f59e0b";case"flexibility":return"#8b5cf6";default:return"#6b7280"}},t=s=>{switch(s.toLowerCase()){case"weight loss":return"danger";case"muscle building":return"success";case"endurance":return"warning";case"flexibility":return"info";default:return"secondary"}},p=s=>{switch(s.toLowerCase()){case"vegetarian":return"solar:leaf-broken";case"keto":return"solar:fire-broken";case"high protein":return"solar:dumbbell-broken";case"low carb":return"solar:scale-broken";case"mediterranean":return"solar:planet-broken";default:return"solar:nutrition-broken"}},N=s=>s?"solar:check-circle-broken":"solar:pause-circle-broken",w=s=>s?"success":"secondary",j=()=>{if(!u||u.length===0)return{totalCompleted:0,totalInProgress:0};const s=u[u.length-1];return{totalCompleted:s.Completed,totalInProgress:s.InProgress}},{totalCompleted:f,totalInProgress:C}=j();return e.jsxs(T,{className:"h-100",children:[o&&e.jsxs(E,{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h5",{className:`card-title mb-0 ${l?"text-primary cursor-pointer":""}`,onClick:l,style:l?{cursor:"pointer"}:{},children:r}),e.jsx(I,{bg:"primary",pill:!0,children:a.length})]}),u&&u.length>0&&e.jsx("div",{className:"px-3 py-2 bg-light border-bottom",children:e.jsxs(S,{className:"text-center",children:[e.jsxs(y,{children:[e.jsx("div",{className:"text-success fw-bold",children:f}),e.jsx("small",{className:"text-muted",children:"Completed"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-primary fw-bold",children:C}),e.jsx("small",{className:"text-muted",children:"In Progress"})]})]})}),e.jsx(M,{className:"p-0",children:e.jsx("div",{style:{maxHeight:m,overflowY:"auto"},children:n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading challengers..."})]}):h?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(g,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:h})]}):e.jsx(k,{variant:"flush",children:a.length===0?e.jsxs(k.Item,{className:"text-center py-4 text-muted",children:[e.jsx(g,{icon:"solar:users-group-two-rounded-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No challengers available"})]}):a.map(s=>e.jsx(k.Item,{className:"px-3 py-3",children:e.jsxs(S,{className:"align-items-start",children:[e.jsx(y,{xs:"auto",children:e.jsx("div",{className:"avatar-sm rounded-circle d-flex align-items-center justify-content-center",style:{backgroundColor:`${i(s.type)}20`},children:e.jsx(g,{icon:p(s.category),className:"fs-18",color:i(s.type)})})}),e.jsxs(y,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0 text-truncate flex-grow-1 me-2",children:s.name}),e.jsxs(I,{bg:w(s.isActive),className:"d-flex align-items-center",children:[e.jsx(g,{icon:N(s.isActive),className:"fs-12 me-1"}),s.isActive?"Active":"Inactive"]})]}),e.jsxs("p",{className:"text-muted mb-2 small",children:[e.jsx(g,{icon:"solar:phone-broken",className:"fs-12 me-1"}),s.mobile]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(I,{bg:t(s.type),className:"me-2",children:s.type}),e.jsx("span",{className:"text-muted small",children:s.category})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"text-primary fw-semibold small",children:[e.jsx(g,{icon:"solar:clock-circle-broken",className:"fs-12 me-1"}),s.duration]})})]}),s.subcategory&&e.jsx("div",{className:"mb-2",children:e.jsx(I,{bg:"light",text:"dark",className:"small",children:s.subcategory})}),s.createdAt&&e.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[e.jsx(g,{icon:"solar:calendar-broken",className:"fs-12 me-1"}),"Created ",W(s.createdAt)]})]})]})},s._id))})})})]})},V=({posts:a,title:r="Recent Posts",showHeader:o=!0,maxHeight:m="400px",isLoading:n=!1,error:h=null,onTitleClick:l})=>{const u=t=>{if(!t)return"";const p=typeof t=="string"?parseInt(t):Number(t);if(isNaN(p)||p<=0)return"";const N=new Date(p*1e3),j=Math.floor((new Date().getTime()-N.getTime())/1e3);if(j<60)return"just now";if(j<3600){const f=Math.floor(j/60);return`${f} ${f===1?"minute":"minutes"} ago`}else if(j<86400){const f=Math.floor(j/3600);return`${f} ${f===1?"hour":"hours"} ago`}else{const f=Math.floor(j/86400);return`${f} ${f===1?"day":"days"} ago`}},i=t=>{const p=`https://www.instagram.com/${t}/#`;window.open(p,"_blank")};return e.jsxs(T,{className:"h-100",children:[o&&e.jsxs(E,{className:`d-flex align-items-center justify-content-between ${l?"user-select-none":""}`,style:{cursor:l?"pointer":"default",transition:l?"background-color 0.2s":"none"},onClick:l,title:l?"Click to open hashtag performance in new tab":"",onMouseEnter:t=>{l&&(t.currentTarget.style.backgroundColor="#f8f9fa")},onMouseLeave:t=>{l&&(t.currentTarget.style.backgroundColor="")},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h5",{className:"card-title mb-0 me-2",children:r}),l&&e.jsx(g,{icon:"solar:external-link-broken",className:"fs-12 text-muted"})]}),e.jsx(I,{bg:"primary",pill:!0,children:a.length})]}),e.jsx(M,{className:"p-0",children:e.jsx("div",{style:{maxHeight:m,overflowY:"auto"},children:e.jsx(k,{variant:"flush",children:n?e.jsxs(k.Item,{className:"text-center py-4 text-muted",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading campaign posts..."})]}):h?e.jsxs(k.Item,{className:"text-center py-4 text-muted",children:[e.jsx(g,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2 text-danger"}),e.jsx("p",{className:"text-danger",children:h})]}):a.length===0?e.jsxs(k.Item,{className:"text-center py-4 text-muted",children:[e.jsx(g,{icon:"solar:document-text-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No campaign posts available"})]}):a.map(t=>{var p,N,w,j,f,C,s,A;return e.jsx(k.Item,{className:"px-3 py-3",children:e.jsxs(S,{className:"align-items-start",children:[e.jsx(y,{xs:"auto",children:e.jsxs("div",{className:"rounded-circle overflow-hidden position-relative",style:{width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"},children:[e.jsx("img",{src:((p=t.influencer.instagram)==null?void 0:p.profile_pic_url)||"/images/users/user-1.jpg",alt:t.influencer.fullname,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:c=>{const x=c.target;x.style.display="none";const d=x.nextElementSibling;d&&(d.style.display="flex")}}),e.jsx("div",{style:{width:"100%",height:"100%",display:"none",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",position:"absolute",top:"0",left:"0"},children:e.jsx(g,{icon:"solar:user-broken",className:"fs-18 text-muted"})})]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-2",children:[e.jsxs("div",{className:"flex-grow-1 me-2",children:[e.jsx("h6",{className:"mb-1 text-truncate",children:e.jsxs("span",{className:"text-primary",style:{cursor:"pointer",textDecoration:"none"},onClick:()=>{var c,x,d;return i(((x=(c=t.influencer)==null?void 0:c.instagram)==null?void 0:x.handle)||((d=t.influencer)==null?void 0:d.username)||"")},onMouseEnter:c=>{c.currentTarget.style.textDecoration="underline"},onMouseLeave:c=>{c.currentTarget.style.textDecoration="none"},title:`Open @${((w=(N=t.influencer)==null?void 0:N.instagram)==null?void 0:w.handle)||((j=t.influencer)==null?void 0:j.username)||""} on Instagram`,children:["@",String(((C=(f=t.influencer)==null?void 0:f.instagram)==null?void 0:C.handle)||((s=t.influencer)==null?void 0:s.username)||"Unknown")]})}),e.jsx("div",{className:"d-flex align-items-center text-muted small mb-1",children:e.jsx("span",{className:"me-2",children:String(((A=t.influencer)==null?void 0:A.fullname)||"")})})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"badge bg-success-subtle text-success small",children:[String(D(Number(t.total_followers)||0))," followers"]})})]}),e.jsx("p",{className:"text-muted mb-2 small",children:(()=>{let c="";if(t.caption){const x=t.caption;typeof x=="object"&&x[0]&&x[0].text?c=String(x[0].text):typeof x=="string"&&(c=x)}return c&&c.length>150&&(c=c.substring(0,150)+"..."),c||"No caption available"})()}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[Array.isArray(t.hashtags)&&t.hashtags.slice(0,2).map((c,x)=>e.jsx(I,{bg:"light",text:"dark",className:"me-1 small",children:String(c||"")},x)),Array.isArray(t.hashtags)&&t.hashtags.length>2&&e.jsxs("span",{className:"text-muted small",children:["+",t.hashtags.length-2," more"]})]}),e.jsx("small",{className:"text-muted",children:String(u(t.created_timestamp)||"")})]}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(g,{icon:"solar:heart-broken",className:"fs-12 me-1 text-danger"}),e.jsx("span",{className:"small text-muted",children:String(D(Number(t.total_likes)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(g,{icon:"solar:chat-round-line-broken",className:"fs-12 me-1 text-primary"}),e.jsx("span",{className:"small text-muted",children:String(D(Number(t.total_comments)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(g,{icon:"solar:share-broken",className:"fs-12 me-1 text-success"}),e.jsx("span",{className:"small text-muted",children:String(D(Number(t.reshare_count)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(g,{icon:"solar:eye-broken",className:"fs-12 me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:String(D(Number(t.reach)||0))})]})]})})]})]})},t._id)})})})})]})},G=({challengrsGraphData:a,isLoading:r=!1,error:o=null})=>{const n=(()=>{if(!a||a.length===0)return{categories:["No Data"],completedData:[0],inProgressData:[0]};const l=a.map(t=>new Date(t.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),u=a.map(t=>t.Completed),i=a.map(t=>t.InProgress);return{categories:l,completedData:u,inProgressData:i}})(),h={chart:{type:"bar",height:350,toolbar:{show:!1}},series:[{name:"Completed",data:n.completedData,color:"#10b981"},{name:"In Progress",data:n.inProgressData,color:"#3b82f6"}],xaxis:{categories:n.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(T,{children:[e.jsx(E,{children:e.jsx("h5",{className:"card-title mb-0",children:"Challenges Progress"})}),e.jsx(M,{children:r?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(F,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading chart data..."})]}):o?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(g,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:o})]}):e.jsx(_,{options:h,series:h.series,type:"bar",height:350})})]})},K=({dashboardData:a,isLoading:r=!1,error:o=null})=>{const n=(()=>{var l;if((l=a==null?void 0:a.postGraphData)!=null&&l.itchotels&&Array.isArray(a.postGraphData.itchotels)){const u=a.postGraphData.itchotels.filter(i=>i.y!==null).map(i=>({timestamp:i.x,date:new Date(i.x).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:i.y||0})).sort((i,t)=>i.timestamp-t.timestamp);return{categories:u.map(i=>i.date),publishedData:u.map(i=>i.value),timestamps:u.map(i=>i.timestamp)}}return{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],publishedData:[5,8,12,15,18,22,25,28,32,35,38,42],timestamps:[]}})(),h={chart:{type:"area",height:350,toolbar:{show:!1}},series:[{name:"Posts Count",data:n.publishedData,color:"#f59e0b"}],xaxis:{categories:n.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3,stops:[0,90,100]}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(T,{children:[e.jsx(E,{children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsx("h5",{className:"card-title mb-0",children:"Post Analytics"})})}),e.jsx(M,{children:r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"350px"},children:e.jsx(U,{})}):o?e.jsx("div",{className:"d-flex justify-content-center align-items-center text-danger",style:{height:"350px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-alert-circle-outline fs-2 mb-2"}),e.jsx("p",{className:"mb-0",children:o})]})}):e.jsx(_,{options:h,series:h.series,type:"area",height:350})})]})},R=a=>{var r,o,m;try{const n=(r=L.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:r.toString();if(n){const l=JSON.parse(n);if(l!=null&&l.token)return l.token}const h=(o=L.getCookie("token"))==null?void 0:o.toString();return a||h||localStorage.getItem("authToken")||""}catch(n){console.warn("Failed to get auth token from session:",n);const h=(m=L.getCookie("token"))==null?void 0:m.toString();return a||h||localStorage.getItem("authToken")||""}},v=class v{constructor(){P(this,"fallbackToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZThkMjQxYzkyMWE5ZDEzMzhmNGMwMyIsImlhdCI6MTc2MDQyMzkyMiwiZXhwIjoxNzYwNTEwMzIyfQ.jpyOCiQ_lunYouOyLSOXTWOJ3pDfWGg0JKxd9Rgparo")}static getInstance(){return v.instance||(v.instance=new v),v.instance}async getDashboardData(){try{const r=R(this.fallbackToken);if(!r)return console.warn("Authentication token not found, using mock data."),this.getMockDashboardData();const o=await fetch(`${B.API_URL}/dashboard`,{method:"GET",headers:{authorization:r,"Content-Type":"application/json"}});if(!o.ok){const n=await o.json().catch(()=>({message:"Failed to fetch dashboard data"}));if(o.status===401||n.message==="Unauthorized!")return console.warn("Using mock data due to authentication failure. Please check your token."),this.getMockDashboardData();throw new Error(n.message||`HTTP ${o.status}: Failed to fetch dashboard data`)}return await o.json()}catch(r){if(console.error("Dashboard API Error:",r),r.name==="TypeError"&&r.message.includes("fetch"))return console.warn("Network error detected, using mock data."),this.getMockDashboardData();throw new Error(r.message||"Failed to fetch dashboard data")}}getMockDashboardData(){return{totalStories:25,totalViews:15e3,totalLikes:12500,postGraphData:{itchotels:[{x:170424e7,y:2},{x:17073504e5,y:3},{x:170856e7,y:4},{x:17099424e5,y:5},{x:17183232e5,y:3},{x:17241984e5,y:6},{x:17320608e5,y:4},{x:1737936e6,y:7},{x:17479584e5,y:5},{x:17555616e5,y:8},{x:17576352e5,y:6},{x:175824e7,y:9}],itchotels_count:25}}}setAuthToken(r){this.fallbackToken=r}getAuthToken(){return R(this.fallbackToken)}};P(v,"instance");let $=v;const X=$.getInstance(),we=()=>{const[a,r]=b.useState([]),[o,m]=b.useState(!0),[n,h]=b.useState(null),l=[{date:"2025-10-13T00:00:00.000Z",Completed:0,InProgress:1},{date:"2025-10-16T00:00:00.000Z",Completed:0,InProgress:2}],[u,i]=b.useState(null),[t,p]=b.useState(!0),[N,w]=b.useState(null),[j,f]=b.useState([]),[C,s]=b.useState(!0),[A,c]=b.useState(null);return b.useEffect(()=>{(async()=>{try{p(!0),w(null);const d=await X.getDashboardData();i(d)}catch(d){w("Failed to fetch dashboard data"),console.error("Error fetching dashboard data:",d)}finally{p(!1)}})()},[]),b.useEffect(()=>{(async()=>{try{m(!0);const d=await Y.getCampaignContents("daawatbiryani",1,10);d.success&&d.data.posts&&r(d.data.posts)}catch(d){h("Failed to fetch campaign contents"),console.error("Error fetching campaign contents:",d)}finally{m(!1)}})()},[]),b.useEffect(()=>{(async()=>{try{s(!0),c(null);const d=await Z.getAllChallengers({limit:10,page:1});d.data&&f(d.data)}catch(d){c("Failed to fetch challengers"),console.error("Error fetching challengers:",d)}finally{s(!1)}})()},[]),e.jsxs(e.Fragment,{children:[e.jsx(H,{subName:"Daawat",title:"Dashboard Analytics"}),e.jsx("div",{className:"mb-4"}),e.jsxs(S,{className:"mb-4 g-3",children:[e.jsx(y,{xl:6,lg:6,md:12,children:e.jsx(G,{challengrsGraphData:l,isLoading:!1,error:null})}),e.jsx(y,{xl:6,lg:12,md:12,children:e.jsx(K,{dashboardData:u,isLoading:t,error:N})})]}),e.jsxs(S,{className:"mb-4 g-3",children:[e.jsx(y,{xl:6,lg:6,md:12,children:e.jsx(Q,{challengers:j,title:"Recent Challengers",showHeader:!0,maxHeight:"400px",isLoading:C,error:A,onTitleClick:()=>window.open("/challengers","_blank"),challengrsGraphData:l})}),e.jsx(y,{xl:6,lg:12,md:12,children:e.jsx(V,{posts:a,title:"Recent Posts",showHeader:!0,maxHeight:"400px",isLoading:o,error:n,onTitleClick:()=>window.open("/social/hashtag-performance","_blank")})})]}),e.jsx(J,{})]})};export{we as default};
