import{l as T,r as u,h as $,j as e,R as D,d as f}from"./index-Ooz62fiS.js";import{C as O}from"./ComponentContainerCard-DBMuULdO.js";import{P as U}from"./PageTitle-CgH_ORAJ.js";import{A as B}from"./api-6P2W6CpQ.js";import{M as F}from"./Modal-Kq4ou6cI.js";import{F as i}from"./Form-BoXaT0PC.js";import{B as L}from"./Button-De1x7Bwo.js";import"./Card-4Zn0WiP8.js";import"./IconifyIcon-DLaRtdgV.js";import"./AbstractModalHeader-BpzH4dPk.js";import"./useWindow-DFuL0toc.js";import"./usePrevious-DvvUNumE.js";import"./useEventCallback-BraK-Qar.js";import"./hasClass-QHHI0DYE.js";import"./useMergedRefs-DgqNUnnU.js";import"./NoopTransition-bevLL_V3.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-C43MA7aE.js";import"./FormControl-BbPI-Pmh.js";import"./warning-BQiMBIrW.js";import"./FormLabel-CE1ZnVhC.js";import"./ElementChildren-jyBJmUEC.js";import"./FormGroup-BhFV_4HA.js";import"./FormSelect-B1_22SD8.js";import"./FormText-DDPgliKU.js";import"./Button-BsnQaD7D.js";const N=B.API_URL,x=g=>{var s,a,o;try{const r=(s=T.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:s.toString();if(r){const d=JSON.parse(r);if(d!=null&&d.token)return d.token}const h=(a=T.getCookie("token"))==null?void 0:a.toString();return g||h||localStorage.getItem("authToken")||""}catch(r){return console.warn("Failed to get auth token from session:",r),((o=T.getCookie("token"))==null?void 0:o.toString())||localStorage.getItem("authToken")||""}},A=()=>({authorization:x(),"Content-Type":"application/json"}),I=()=>({authorization:x()});class k{static async getAllDietPlans(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new URLSearchParams;s!=null&&s.category&&o.append("category",s.category),s!=null&&s.subcategory&&o.append("subcategory",s.subcategory),s!=null&&s.type&&o.append("type",s.type),(s==null?void 0:s.isActive)!==void 0&&o.append("isActive",s.isActive.toString()),s!=null&&s.page&&o.append("page",s.page.toString()),s!=null&&s.limit&&o.append("limit",s.limit.toString());const r=await fetch(`${N}/dietplans?${o.toString()}`,{method:"GET",headers:A()});if(!r.ok)throw new Error(`Failed to fetch diet plans: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error fetching diet plans:",a),a}}static async getDietPlanById(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${s}`,{method:"GET",headers:A()});if(!o.ok)throw new Error(`Failed to fetch diet plan: ${o.statusText}`);return await o.json()}catch(a){throw console.error("Error fetching diet plan:",a),a}}static async createDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new FormData;o.append("name",s.name),o.append("duration",s.duration),o.append("type",s.type),o.append("category",s.category),o.append("isActive",s.isActive.toString()),s.subcategory&&o.append("subcategory",s.subcategory),s.description&&o.append("description",s.description),s.pdfFile&&o.append("pdfFile",s.pdfFile);const r=await fetch(`${N}/dietplans`,{method:"POST",headers:I(),body:o});if(!r.ok)throw new Error(`Failed to create diet plan: ${r.statusText}`);return await r.json()}catch(a){throw console.error("Error creating diet plan:",a),a}}static async updateDietPlan(s,a){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=new FormData;r.append("name",a.name),r.append("duration",a.duration),r.append("type",a.type),r.append("category",a.category),r.append("isActive",a.isActive.toString()),a.subcategory&&r.append("subcategory",a.subcategory),a.description&&r.append("description",a.description),a.pdfFile&&r.append("pdfFile",a.pdfFile);const h=await fetch(`${N}/dietplans/${s}`,{method:"PUT",headers:I(),body:r});if(!h.ok)throw new Error(`Failed to update diet plan: ${h.statusText}`);return await h.json()}catch(o){throw console.error("Error updating diet plan:",o),o}}static async deleteDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${s}`,{method:"DELETE",headers:A()});if(!o.ok)throw new Error(`Failed to delete diet plan: ${o.statusText}`)}catch(a){throw console.error("Error deleting diet plan:",a),a}}static async deleteAllDietPlans(){try{if(!x())throw new Error("Authentication token not found. Please login again.");const a=await fetch(`${N}/dietplans`,{method:"DELETE",headers:A()});if(!a.ok)throw new Error(`Failed to delete all diet plans: ${a.statusText}`)}catch(s){throw console.error("Error deleting all diet plans:",s),s}}static async downloadPDF(s){try{const a=x();if(!a)throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${N}/dietplans/${s}/download`,{method:"GET",headers:{authorization:a}});if(!o.ok)throw new Error(`Failed to download PDF: ${o.statusText}`);return await o.blob()}catch(a){throw console.error("Error downloading PDF:",a),a}}static triggerPDFDownload(s,a){const o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=a,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}}const M=["Vegetarian","Veg+ Egg","Veg+ Meat"],_=["Weight Loss","Weight Gain","Muscle Building","Maintenance","Athletic Performance","General Health"],R=["7 days","14 days","21 days","30 days"],G=["Weight Loss Meal Plan","High Protein Meal Plan","North Indian Meal Plan","South Indian Meal Plan","Asian Meal Plan","Fusion Meal Plan","Maharashtra Meal Plan","Sattvikk Meal Plan"],z=({show:g,onHide:s,editingPlan:a,onSubmit:o})=>{const[r,h]=u.useState({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),[d,j]=u.useState(!1),[c,b]=u.useState({}),{showNotification:y}=$();u.useEffect(()=>{h(a?{name:a.name||"",duration:a.duration||"",type:a.type||"",category:a.category||"",subcategory:a.subcategory||"",description:a.description||"",isActive:a.isActive??!0}:{name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({})},[a,g]);const P=()=>{const n={};return r.name.trim()||(n.name="Plan name is required"),r.duration||(n.duration="Duration is required"),r.type||(n.type="Type is required"),r.category||(n.category="Category is required"),b(n),Object.keys(n).length===0},S=async n=>{if(n.preventDefault(),!!P()){j(!0);try{a&&a._id?(await k.updateDietPlan(a._id,r),y({message:"Diet plan updated successfully",variant:"success"})):(await k.createDietPlan(r),y({message:"Diet plan created successfully",variant:"success"})),o()}catch(p){console.error("Error saving diet plan:",p),y({message:`Error ${a?"updating":"creating"} diet plan`,variant:"danger"})}finally{j(!1)}}},m=(n,p)=>{h(v=>({...v,[n]:p})),c[n]&&b(v=>({...v,[n]:""}))},w=n=>{var v;const p=(v=n.target.files)==null?void 0:v[0];if(p){if(p.type!=="application/pdf"){y({message:"Only PDF files are allowed",variant:"warning"}),n.target.value="";return}const C=10*1024*1024;if(p.size>C){y({message:"File size must be less than 10MB",variant:"warning"}),n.target.value="";return}m("pdfFile",p)}},E=()=>{h({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({}),s()};return e.jsxs(F,{show:g,onHide:E,size:"lg",centered:!0,children:[e.jsx(F.Header,{closeButton:!0,children:e.jsx(F.Title,{children:a?"Edit Diet Plan":"Create New Diet Plan"})}),e.jsxs(i,{onSubmit:S,children:[e.jsxs(F.Body,{children:[e.jsxs(D,{children:[e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Plan Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(i.Control,{type:"text",value:r.name,onChange:n=>m("name",n.target.value),isInvalid:!!c.name,placeholder:"Enter diet plan name"}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.name})]})}),e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Duration ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.duration,onChange:n=>m("duration",n.target.value),isInvalid:!!c.duration,children:[e.jsx("option",{value:"",children:"Select duration"}),R.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.duration})]})})]}),e.jsxs(D,{children:[e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.type,onChange:n=>m("type",n.target.value),isInvalid:!!c.type,children:[e.jsx("option",{value:"",children:"Select type"}),_.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.type})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.category,onChange:n=>m("category",n.target.value),isInvalid:!!c.category,children:[e.jsx("option",{value:"",children:"Select category"}),M.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:c.category})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Subcategory (Optional)"}),e.jsxs(i.Select,{value:r.subcategory,onChange:n=>m("subcategory",n.target.value),children:[e.jsx("option",{value:"",children:"Select subcategory (optional)"}),G.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Text,{className:"text-muted"})]})})]}),e.jsx(D,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"PDF File"}),e.jsx(i.Control,{type:"file",accept:".pdf",onChange:w}),e.jsx(i.Text,{className:"text-muted",children:"Upload a PDF file (max 10MB). Only PDF files are allowed."}),(a==null?void 0:a.pdfFile)&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"Current file: ",a.pdfFile.filename]})})]})})}),e.jsx(D,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{as:"textarea",rows:3,value:r.description,onChange:n=>m("description",n.target.value),placeholder:"Enter diet plan description (optional)"})]})})}),e.jsx(D,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Check,{type:"checkbox",label:"Active",checked:r.isActive,onChange:n=>m("isActive",n.target.checked)}),e.jsx(i.Text,{className:"text-muted",children:"Only active diet plans will be visible to users."})]})})})]}),e.jsxs(F.Footer,{children:[e.jsx(L,{variant:"secondary",onClick:E,children:"Cancel"}),e.jsx(L,{variant:"primary",type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),a?"Updating...":"Creating..."]}):a?"Update Plan":"Create Plan"})]})]})]})},xe=()=>{const[g,s]=u.useState([]),[a,o]=u.useState(!0),[r,h]=u.useState(""),[d,j]=u.useState({page:1,limit:10}),[c,b]=u.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[y,P]=u.useState(!1),[S,m]=u.useState(null),{showNotification:w}=$(),E=async()=>{try{o(!0);const t=await k.getAllDietPlans(d);s(t.data||[]),b({currentPage:t.currentPage||1,totalPages:t.totalPages||1,totalItems:t.totalItems||0,itemsPerPage:10})}catch(t){console.error("Error fetching diet plans:",t),w({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{o(!1)}};u.useEffect(()=>{(async()=>{try{o(!0);const l=await k.getAllDietPlans(d);s(l.data||[]),b({currentPage:l.currentPage||1,totalPages:l.totalPages||1,totalItems:l.totalItems||0,itemsPerPage:10})}catch(l){console.error("❌ Error fetching diet plans:",l),w({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{o(!1)}})()},[d]);const n=(g||[]).filter(t=>t.name.toLowerCase().includes(r.toLowerCase())||t.category.toLowerCase().includes(r.toLowerCase())||t.type.toLowerCase().includes(r.toLowerCase())||t.subcategory&&t.subcategory.toLowerCase().includes(r.toLowerCase())),p=async t=>{if(!t._id||!t.pdfFile){w({message:"No PDF file available for this diet plan",variant:"warning"});return}try{const l=await k.downloadPDF(t._id);k.triggerPDFDownload(l,t.pdfFile.filename),w({message:"PDF downloaded successfully",variant:"success"})}catch(l){console.error("Error downloading PDF:",l),w({message:"Error downloading PDF",variant:"danger"})}},v=()=>{P(!1),m(null),E()},C=t=>{j(l=>({...l,page:t}))};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Diet Plan",subName:"Manage and track diet plans"}),e.jsx("div",{className:"container-fluid",children:e.jsxs(O,{id:"diet-plan-container",title:"Diet Plans Management",description:"Manage and track all diet plans for rice challenge awareness",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search diet plans...",value:r,onChange:t=>h(t.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.category||"",onChange:t=>j(l=>({...l,category:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),M.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.subcategory||"",onChange:t=>j(l=>({...l,subcategory:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Subcategories"}),G.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.type||"",onChange:t=>j(l=>({...l,type:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Types"}),_.map(t=>e.jsx("option",{value:t,children:t},t))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.isActive===void 0?"":d.isActive.toString(),onChange:t=>j(l=>({...l,isActive:t.target.value===""?void 0:t.target.value==="true"})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("div",{className:"col-md-2 text-end",children:e.jsxs("button",{className:"btn btn-primary me-2",onClick:()=>P(!0),children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add New Plan"]})})]}),a?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan Name"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"PDF"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(t=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:t.name}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:t.duration})}),e.jsx("td",{children:t.type}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:t.category})}),e.jsx("td",{children:t.subcategory?e.jsx("span",{className:"badge bg-light text-dark",children:t.subcategory}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:t.pdfFile?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-success mb-1",onClick:()=>p(t),title:"Download PDF",children:[e.jsx("i",{className:"fas fa-download me-1"}),t.pdfFile.originalName]}),e.jsxs("small",{className:"text-muted",children:[(t.pdfFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsx("span",{className:"text-muted",children:"No PDF"})}),e.jsx("td",{children:t.createdBy&&typeof t.createdBy=="object"?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:t.createdBy.username}),e.jsx("small",{className:"text-muted",children:t.createdBy.email})]}):e.jsx("span",{className:"text-muted",children:"Unknown"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.isActive?"bg-success":"bg-secondary"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"btn-group",role:"group",children:e.jsx("button",{className:"btn btn-sm btn-outline-warning",onClick:()=>{m(t),P(!0)},title:"Edit",children:e.jsx("i",{className:"fas fa-edit"})})})})]},t._id))})]})}),n.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No diet plans found."})}),c.totalPages>1&&e.jsx("nav",{"aria-label":"Diet plans pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${c.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>C(c.currentPage-1),disabled:c.currentPage===1,children:"Previous"})}),Array.from({length:c.totalPages},(t,l)=>l+1).map(t=>e.jsx("li",{className:`page-item ${c.currentPage===t?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>C(t),children:t})},t)),e.jsx("li",{className:`page-item ${c.currentPage===c.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>C(c.currentPage+1),disabled:c.currentPage===c.totalPages,children:"Next"})})]})})]})]})}),y&&e.jsx(z,{show:y,onHide:()=>{P(!1),m(null)},editingPlan:S,onSubmit:v})]})};export{xe as default};
