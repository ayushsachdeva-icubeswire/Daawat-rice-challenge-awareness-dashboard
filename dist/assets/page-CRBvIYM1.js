var R=Object.defineProperty;var F=(s,r,i)=>r in s?R(s,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[r]=i;var T=(s,r,i)=>F(s,typeof r!="symbol"?r+"":r,i);import{j as e,R as D,d as w,l as L,r as p,F as O}from"./index-CcUYqQj2.js";import{I as h}from"./IconifyIcon-eel3OVYR.js";import{C as A,a as M,b as E}from"./Card-CEvs3-P8.js";import{B as C}from"./Badge-wLjuSOoG.js";import{S as J}from"./Spinner-C19ZuWqa.js";import{B as N}from"./ListGroup-DKVg4KGA.js";import{f as k}from"./numberFormat-DtcdhD-a.js";import{R as P}from"./react-apexcharts.min-B88WENxh.js";import{S as z}from"./Spinner-BTUQrmoB.js";import{P as G}from"./PageTitle-IbtUm1q9.js";import{C as H}from"./campaignContentsService-DCiZN_AJ.js";import{C as U}from"./challengerService-BFHKWa57.js";import{A as V}from"./api-BDs4y23Q.js";import"./warning-Djqtn8Uc.js";import"./hook-BqmEz5I4.js";import"./extends-CF3RwP-h.js";import"./Nav-CwMGebPy.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-Czq-O-Ka.js";import"./useMergedRefs-Bpgzoa-d.js";import"./useEventCallback-D5TZ85Qm.js";import"./Button-DIfFpmge.js";const Y=s=>{const r=new Date(s),d=Math.floor((new Date().getTime()-r.getTime())/1e3);if(d<60)return"just now";if(d<3600){const n=Math.floor(d/60);return`${n} ${n===1?"minute":"minutes"} ago`}else if(d<86400){const n=Math.floor(d/3600);return`${n} ${n===1?"hour":"hours"} ago`}else{const n=Math.floor(d/86400);return`${n} ${n===1?"day":"days"} ago`}},B=({challengers:s,title:r="Recent Challengers",showHeader:i=!0,maxHeight:d="400px",isLoading:n=!1,error:x=null,onTitleClick:l})=>{const b=a=>{switch(a.toLowerCase()){case"weight loss":return"#ef4444";case"muscle building":return"#10b981";case"endurance":return"#f59e0b";case"flexibility":return"#8b5cf6";default:return"#6b7280"}},c=a=>{switch(a.toLowerCase()){case"weight loss":return"danger";case"muscle building":return"success";case"endurance":return"warning";case"flexibility":return"info";default:return"secondary"}},t=a=>{switch(a.toLowerCase()){case"vegetarian":return"solar:leaf-broken";case"keto":return"solar:fire-broken";case"high protein":return"solar:dumbbell-broken";case"low carb":return"solar:scale-broken";case"mediterranean":return"solar:planet-broken";default:return"solar:nutrition-broken"}},f=a=>a?"solar:check-circle-broken":"solar:pause-circle-broken",y=a=>a?"success":"secondary";return e.jsxs(A,{className:"h-100",children:[i&&e.jsxs(M,{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h5",{className:`card-title mb-0 ${l?"text-primary cursor-pointer":""}`,onClick:l,style:l?{cursor:"pointer"}:{},children:r}),e.jsx(C,{bg:"primary",pill:!0,children:s.length})]}),e.jsx(E,{className:"p-0",children:e.jsx("div",{style:{maxHeight:d,overflowY:"auto"},children:n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(J,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading challengers..."})]}):x?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(h,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:x})]}):e.jsx(N,{variant:"flush",children:s.length===0?e.jsxs(N.Item,{className:"text-center py-4 text-muted",children:[e.jsx(h,{icon:"solar:users-group-two-rounded-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No challengers available"})]}):s.map(a=>e.jsx(N.Item,{className:"px-3 py-3",children:e.jsxs(D,{className:"align-items-start",children:[e.jsx(w,{xs:"auto",children:e.jsx("div",{className:"avatar-sm rounded-circle d-flex align-items-center justify-content-center",style:{backgroundColor:`${b(a.type)}20`},children:e.jsx(h,{icon:t(a.category),className:"fs-18",color:b(a.type)})})}),e.jsxs(w,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0 text-truncate flex-grow-1 me-2",children:a.name}),e.jsxs(C,{bg:y(a.isActive),className:"d-flex align-items-center",children:[e.jsx(h,{icon:f(a.isActive),className:"fs-12 me-1"}),a.isActive?"Active":"Inactive"]})]}),e.jsxs("p",{className:"text-muted mb-2 small",children:[e.jsx(h,{icon:"solar:phone-broken",className:"fs-12 me-1"}),a.mobile]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(C,{bg:c(a.type),className:"me-2",children:a.type}),e.jsx("span",{className:"text-muted small",children:a.category})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"text-primary fw-semibold small",children:[e.jsx(h,{icon:"solar:clock-circle-broken",className:"fs-12 me-1"}),a.duration]})})]}),a.subcategory&&e.jsx("div",{className:"mb-2",children:e.jsx(C,{bg:"light",text:"dark",className:"small",children:a.subcategory})}),a.createdAt&&e.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[e.jsx(h,{icon:"solar:calendar-broken",className:"fs-12 me-1"}),"Created ",Y(a.createdAt)]})]})]})},a._id))})})})]})},W=({posts:s,title:r="Recent Posts",showHeader:i=!0,maxHeight:d="400px",isLoading:n=!1,error:x=null,onTitleClick:l})=>{const b=t=>{if(!t)return"";const f=typeof t=="string"?parseInt(t):Number(t);if(isNaN(f)||f<=0)return"";const y=new Date(f*1e3),j=Math.floor((new Date().getTime()-y.getTime())/1e3);if(j<60)return"just now";if(j<3600){const g=Math.floor(j/60);return`${g} ${g===1?"minute":"minutes"} ago`}else if(j<86400){const g=Math.floor(j/3600);return`${g} ${g===1?"hour":"hours"} ago`}else{const g=Math.floor(j/86400);return`${g} ${g===1?"day":"days"} ago`}},c=t=>{const f=`https://www.instagram.com/${t}/#`;window.open(f,"_blank")};return e.jsxs(A,{className:"h-100",children:[i&&e.jsxs(M,{className:`d-flex align-items-center justify-content-between ${l?"user-select-none":""}`,style:{cursor:l?"pointer":"default",transition:l?"background-color 0.2s":"none"},onClick:l,title:l?"Click to open hashtag performance in new tab":"",onMouseEnter:t=>{l&&(t.currentTarget.style.backgroundColor="#f8f9fa")},onMouseLeave:t=>{l&&(t.currentTarget.style.backgroundColor="")},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h5",{className:"card-title mb-0 me-2",children:r}),l&&e.jsx(h,{icon:"solar:external-link-broken",className:"fs-12 text-muted"})]}),e.jsx(C,{bg:"primary",pill:!0,children:s.length})]}),e.jsx(E,{className:"p-0",children:e.jsx("div",{style:{maxHeight:d,overflowY:"auto"},children:e.jsx(N,{variant:"flush",children:n?e.jsxs(N.Item,{className:"text-center py-4 text-muted",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading campaign posts..."})]}):x?e.jsxs(N.Item,{className:"text-center py-4 text-muted",children:[e.jsx(h,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2 text-danger"}),e.jsx("p",{className:"text-danger",children:x})]}):s.length===0?e.jsxs(N.Item,{className:"text-center py-4 text-muted",children:[e.jsx(h,{icon:"solar:document-text-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No campaign posts available"})]}):s.map(t=>{var f,y,a,j,g,S;return e.jsx(N.Item,{className:"px-3 py-3",children:e.jsxs(D,{className:"align-items-start",children:[e.jsx(w,{xs:"auto",children:e.jsxs("div",{className:"rounded-circle overflow-hidden position-relative",style:{width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"},children:[e.jsx("img",{src:t.influencer.profile_pic_url,alt:t.influencer.full_name,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:o=>{const m=o.target;m.style.display="none";const I=m.nextElementSibling;I&&(I.style.display="flex")}}),e.jsx("div",{style:{width:"100%",height:"100%",display:"none",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",position:"absolute",top:"0",left:"0"},children:e.jsx(h,{icon:"solar:user-broken",className:"fs-18 text-muted"})})]})}),e.jsxs(w,{children:[e.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-2",children:[e.jsxs("div",{className:"flex-grow-1 me-2",children:[e.jsx("h6",{className:"mb-1 text-truncate",children:e.jsxs("span",{className:"text-primary",style:{cursor:"pointer",textDecoration:"none"},onClick:()=>{var o,m;return c(((o=t.influencer)==null?void 0:o.handle)||((m=t.influencer)==null?void 0:m.username)||"")},onMouseEnter:o=>{o.currentTarget.style.textDecoration="underline"},onMouseLeave:o=>{o.currentTarget.style.textDecoration="none"},title:`Open @${((f=t.influencer)==null?void 0:f.handle)||((y=t.influencer)==null?void 0:y.username)||""} on Instagram`,children:["@",String(((a=t.influencer)==null?void 0:a.handle)||((j=t.influencer)==null?void 0:j.username)||"Unknown")]})}),e.jsxs("div",{className:"d-flex align-items-center text-muted small mb-1",children:[e.jsx("span",{className:"me-2",children:String(((g=t.influencer)==null?void 0:g.fullname)||((S=t.influencer)==null?void 0:S.full_name)||"")}),e.jsx(C,{bg:"outline-primary",text:"primary",className:"me-2",children:t.is_video?"Video":t.is_carousel?"Carousel":"Photo"})]})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"badge bg-success-subtle text-success small",children:[String(k(Number(t.total_followers)||0))," followers"]})})]}),e.jsx("p",{className:"text-muted mb-2 small",children:(()=>{let o="";if(t.caption){const m=t.caption;typeof m=="object"&&m[0]&&m[0].text?o=String(m[0].text):typeof m=="string"&&(o=m)}return o&&o.length>150&&(o=o.substring(0,150)+"..."),o||"No caption available"})()}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[Array.isArray(t.hashtags)&&t.hashtags.slice(0,2).map((o,m)=>e.jsx(C,{bg:"light",text:"dark",className:"me-1 small",children:String(o||"")},m)),Array.isArray(t.hashtags)&&t.hashtags.length>2&&e.jsxs("span",{className:"text-muted small",children:["+",t.hashtags.length-2," more"]})]}),e.jsx("small",{className:"text-muted",children:String(b(t.created_timestamp)||"")})]}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(h,{icon:"solar:heart-broken",className:"fs-12 me-1 text-danger"}),e.jsx("span",{className:"small text-muted",children:String(k(Number(t.total_likes)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(h,{icon:"solar:chat-round-line-broken",className:"fs-12 me-1 text-primary"}),e.jsx("span",{className:"small text-muted",children:String(k(Number(t.total_comments)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(h,{icon:"solar:share-broken",className:"fs-12 me-1 text-success"}),e.jsx("span",{className:"small text-muted",children:String(k(Number(t.reshare_count)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(h,{icon:"solar:eye-broken",className:"fs-12 me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:String(k(Number(t.reach)||0))})]})]})})]})]})},t._id)})})})})]})},Q=()=>{const s={chart:{type:"bar",height:350,toolbar:{show:!1}},series:[{name:"Completed",data:[8,12,15,18,22,25,28,32,35,38,42,45],color:"#10b981"},{name:"In Progress",data:[5,8,10,12,15,18,20,23,25,28,30,32],color:"#3b82f6"},{name:"Not Started",data:[12,18,22,25,28,30,32,35,38,40,42,45],color:"#6b7280"}],xaxis:{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"dark"}};return e.jsxs(A,{children:[e.jsx(M,{children:e.jsx("h5",{className:"card-title mb-0",children:"Challenges Progress"})}),e.jsx(E,{children:e.jsx(P,{options:s,series:s.series,type:"bar",height:350})})]})},Z=({dashboardData:s,isLoading:r=!1,error:i=null})=>{const n=(()=>{var l;if((l=s==null?void 0:s.postGraphData)!=null&&l.itchotels&&Array.isArray(s.postGraphData.itchotels)){const b=s.postGraphData.itchotels.filter(c=>c.y!==null).map(c=>({timestamp:c.x,date:new Date(c.x).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:c.y||0})).sort((c,t)=>c.timestamp-t.timestamp);return{categories:b.map(c=>c.date),publishedData:b.map(c=>c.value),timestamps:b.map(c=>c.timestamp)}}return{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],publishedData:[5,8,12,15,18,22,25,28,32,35,38,42],timestamps:[]}})(),x={chart:{type:"area",height:350,toolbar:{show:!1}},series:[{name:"Posts Count",data:n.publishedData,color:"#f59e0b"}],xaxis:{categories:n.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3,stops:[0,90,100]}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(A,{children:[e.jsx(M,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h5",{className:"card-title mb-0",children:"Post Analytics"}),s&&e.jsxs("div",{className:"d-flex gap-3 text-muted small",children:[e.jsxs("span",{children:["Stories: ",e.jsx("strong",{children:s.totalStories})]}),e.jsxs("span",{children:["Views: ",e.jsx("strong",{children:k(s.totalViews)})]}),e.jsxs("span",{children:["Likes: ",e.jsx("strong",{children:k(s.totalLikes)})]})]})]})}),e.jsx(E,{children:r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"350px"},children:e.jsx(z,{})}):i?e.jsx("div",{className:"d-flex justify-content-center align-items-center text-danger",style:{height:"350px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-alert-circle-outline fs-2 mb-2"}),e.jsx("p",{className:"mb-0",children:i})]})}):e.jsx(P,{options:x,series:x.series,type:"area",height:350})})]})},_=s=>{var r,i,d;try{const n=(r=L.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:r.toString();if(n){const l=JSON.parse(n);if(l!=null&&l.token)return l.token}const x=(i=L.getCookie("token"))==null?void 0:i.toString();return s||x||localStorage.getItem("authToken")||""}catch(n){console.warn("Failed to get auth token from session:",n);const x=(d=L.getCookie("token"))==null?void 0:d.toString();return s||x||localStorage.getItem("authToken")||""}},v=class v{constructor(){T(this,"fallbackToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZThkMjQxYzkyMWE5ZDEzMzhmNGMwMyIsImlhdCI6MTc2MDQyMzkyMiwiZXhwIjoxNzYwNTEwMzIyfQ.jpyOCiQ_lunYouOyLSOXTWOJ3pDfWGg0JKxd9Rgparo")}static getInstance(){return v.instance||(v.instance=new v),v.instance}async getDashboardData(){try{const r=_(this.fallbackToken);if(!r)return console.warn("Authentication token not found, using mock data."),this.getMockDashboardData();const i=await fetch(`${V.API_URL}/dashboard`,{method:"GET",headers:{authorization:r,"Content-Type":"application/json"}});if(!i.ok){const n=await i.json().catch(()=>({message:"Failed to fetch dashboard data"}));if(i.status===401||n.message==="Unauthorized!")return console.warn("Using mock data due to authentication failure. Please check your token."),this.getMockDashboardData();throw new Error(n.message||`HTTP ${i.status}: Failed to fetch dashboard data`)}return await i.json()}catch(r){if(console.error("Dashboard API Error:",r),r.name==="TypeError"&&r.message.includes("fetch"))return console.warn("Network error detected, using mock data."),this.getMockDashboardData();throw new Error(r.message||"Failed to fetch dashboard data")}}getMockDashboardData(){return{totalStories:25,totalViews:15e3,totalLikes:12500,postGraphData:{itchotels:[{x:170424e7,y:2},{x:17073504e5,y:3},{x:170856e7,y:4},{x:17099424e5,y:5},{x:17183232e5,y:3},{x:17241984e5,y:6},{x:17320608e5,y:4},{x:1737936e6,y:7},{x:17479584e5,y:5},{x:17555616e5,y:8},{x:17576352e5,y:6},{x:175824e7,y:9}],itchotels_count:25}}}setAuthToken(r){this.fallbackToken=r}getAuthToken(){return _(this.fallbackToken)}};T(v,"instance");let $=v;const K=$.getInstance(),Ne=()=>{const[s,r]=p.useState([]),[i,d]=p.useState(!0),[n,x]=p.useState(null),[l,b]=p.useState(null),[c,t]=p.useState(!0),[f,y]=p.useState(null),[a,j]=p.useState([]),[g,S]=p.useState(!0),[o,m]=p.useState(null);return p.useEffect(()=>{(async()=>{try{t(!0),y(null);const u=await K.getDashboardData();b(u)}catch(u){y("Failed to fetch dashboard data"),console.error("Error fetching dashboard data:",u)}finally{t(!1)}})()},[]),p.useEffect(()=>{(async()=>{try{d(!0);const u=await H.getCampaignContents("daawatbiryani",1,10);u.success&&u.data.posts&&r(u.data.posts)}catch(u){x("Failed to fetch campaign contents"),console.error("Error fetching campaign contents:",u)}finally{d(!1)}})()},[]),p.useEffect(()=>{(async()=>{try{S(!0),m(null);const u=await U.getAllChallengers({limit:10,page:1});u.data&&j(u.data)}catch(u){m("Failed to fetch challengers"),console.error("Error fetching challengers:",u)}finally{S(!1)}})()},[]),e.jsxs(e.Fragment,{children:[e.jsx(G,{subName:"Daawat",title:"Dashboard Analytics"}),e.jsx("div",{className:"mb-4"}),e.jsxs(D,{className:"mb-4 g-3",children:[e.jsx(w,{xl:6,lg:6,md:12,children:e.jsx(Q,{})}),e.jsx(w,{xl:6,lg:12,md:12,children:e.jsx(Z,{dashboardData:l,isLoading:c,error:f})})]}),e.jsxs(D,{className:"mb-4 g-3",children:[e.jsx(w,{xl:6,lg:6,md:12,children:e.jsx(B,{challengers:a,title:"Recent Challengers",showHeader:!0,maxHeight:"400px",isLoading:g,error:o,onTitleClick:()=>window.open("/challengers","_blank")})}),e.jsx(w,{xl:6,lg:12,md:12,children:e.jsx(W,{posts:s,title:"Recent Posts",showHeader:!0,maxHeight:"400px",isLoading:i,error:n,onTitleClick:()=>window.open("/social/hashtag-performance","_blank")})})]}),e.jsx(O,{})]})};export{Ne as default};
