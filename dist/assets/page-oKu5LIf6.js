var se=Object.defineProperty;var ae=(s,t,a)=>t in s?se(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a;var y=(s,t,a)=>ae(s,typeof t!="symbol"?t+"":t,a);import{j as e,R as T,d as v,l as _,r as x,F as ne}from"./index-CA5aiAIn.js";import{I as N}from"./IconifyIcon-BO4mlIP0.js";import{C as z,a as O,b as J}from"./Card-BLZ9NfpY.js";import{B as P}from"./Badge-f4AzC69Q.js";import{S as q}from"./Spinner-CxSzmd5t.js";import{B as A}from"./ListGroup-DAOHjw2F.js";import{f as L}from"./numberFormat-yIx-nKgv.js";import{R as ee}from"./react-apexcharts.min-DLM9XZzQ.js";import{S as re}from"./Spinner-CLSVxY5L.js";import{P as ie}from"./PageTitle-CCtGFVw7.js";import{A as te}from"./api-6P2W6CpQ.js";import{C as oe}from"./campaignContentsService-K9_tJFem.js";import{C as le}from"./challengerService-4Nrts1vp.js";import"./warning-BAv1Q47v.js";import"./hook-DhwCz9dx.js";import"./extends-CF3RwP-h.js";import"./Nav-Dp4mkhOx.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-DtuHaNHq.js";import"./useMergedRefs-DZTfqpzw.js";import"./useEventCallback-Bym5xiKy.js";import"./Button-DGh0M6al.js";const ce=s=>{const t=new Date(s),r=Math.floor((new Date().getTime()-t.getTime())/1e3);if(r<60)return"just now";if(r<3600){const i=Math.floor(r/60);return`${i} ${i===1?"minute":"minutes"} ago`}else if(r<86400){const i=Math.floor(r/3600);return`${i} ${i===1?"hour":"hours"} ago`}else{const i=Math.floor(r/86400);return`${i} ${i===1?"day":"days"} ago`}},de=({challengers:s,title:t="Recent Challengers",showHeader:a=!0,maxHeight:r="400px",isLoading:i=!1,error:u=null,onTitleClick:o,challengrsGraphData:g})=>{const d=l=>{switch(l.toLowerCase()){case"weight loss":return"#ef4444";case"muscle building":return"#10b981";case"endurance":return"#f59e0b";case"flexibility":return"#8b5cf6";default:return"#6b7280"}},n=l=>{switch(l.toLowerCase()){case"weight loss":return"danger";case"muscle building":return"success";case"endurance":return"warning";case"flexibility":return"info";default:return"secondary"}},p=l=>{switch(l.toLowerCase()){case"vegetarian":return"solar:leaf-broken";case"keto":return"solar:fire-broken";case"high protein":return"solar:dumbbell-broken";case"low carb":return"solar:scale-broken";case"mediterranean":return"solar:planet-broken";default:return"solar:nutrition-broken"}},k=l=>l?"solar:check-circle-broken":"solar:pause-circle-broken",C=l=>l?"success":"secondary",j=()=>{if(!g||g.length===0)return{totalCompleted:0,totalInProgress:0};const l=g[g.length-1];return{totalCompleted:l.Completed,totalInProgress:l.InProgress}},{totalCompleted:b,totalInProgress:D}=j();return e.jsxs(z,{className:"h-100",children:[a&&e.jsxs(O,{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h5",{className:`card-title mb-0 ${o?"text-primary cursor-pointer":""}`,onClick:o,style:o?{cursor:"pointer"}:{},children:t}),e.jsx(P,{bg:"primary",pill:!0,children:s.length})]}),g&&g.length>0&&e.jsx("div",{className:"px-3 py-2 bg-light border-bottom",children:e.jsxs(T,{className:"text-center",children:[e.jsxs(v,{children:[e.jsx("div",{className:"text-success fw-bold",children:b}),e.jsx("small",{className:"text-muted",children:"Completed"})]}),e.jsxs(v,{children:[e.jsx("div",{className:"text-primary fw-bold",children:D}),e.jsx("small",{className:"text-muted",children:"In Progress"})]})]})}),e.jsx(J,{className:"p-0",children:e.jsx("div",{style:{maxHeight:r,overflowY:"auto"},children:i?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(q,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading challengers..."})]}):u?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(N,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:u})]}):e.jsx(A,{variant:"flush",children:s.length===0?e.jsxs(A.Item,{className:"text-center py-4 text-muted",children:[e.jsx(N,{icon:"solar:users-group-two-rounded-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No challengers available"})]}):s.map(l=>e.jsx(A.Item,{className:"px-3 py-3",children:e.jsxs(T,{className:"align-items-start",children:[e.jsx(v,{xs:"auto",children:e.jsx("div",{className:"avatar-sm rounded-circle d-flex align-items-center justify-content-center",style:{backgroundColor:`${d(l.type)}20`},children:e.jsx(N,{icon:p(l.category),className:"fs-18",color:d(l.type)})})}),e.jsxs(v,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"mb-0 text-truncate flex-grow-1 me-2",children:l.name}),e.jsxs(P,{bg:C(l.isActive),className:"d-flex align-items-center",children:[e.jsx(N,{icon:k(l.isActive),className:"fs-12 me-1"}),l.isActive?"Active":"Inactive"]})]}),e.jsxs("p",{className:"text-muted mb-2 small",children:[e.jsx(N,{icon:"solar:phone-broken",className:"fs-12 me-1"}),l.mobile]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(P,{bg:n(l.type),className:"me-2",children:l.type}),e.jsx("span",{className:"text-muted small",children:l.category})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"text-primary fw-semibold small",children:[e.jsx(N,{icon:"solar:clock-circle-broken",className:"fs-12 me-1"}),l.duration]})})]}),l.subcategory&&e.jsx("div",{className:"mb-2",children:e.jsx(P,{bg:"light",text:"dark",className:"small",children:l.subcategory})}),l.createdAt&&e.jsxs("div",{className:"d-flex align-items-center text-muted small",children:[e.jsx(N,{icon:"solar:calendar-broken",className:"fs-12 me-1"}),"Created ",ce(l.createdAt)]})]})]})},l._id))})})})]})},ue=({posts:s,title:t="Recent Posts",showHeader:a=!0,maxHeight:r="400px",isLoading:i=!1,error:u=null,onTitleClick:o})=>{const g=n=>{if(!n)return"";const p=typeof n=="string"?parseInt(n):Number(n);if(isNaN(p)||p<=0)return"";const k=new Date(p*1e3),j=Math.floor((new Date().getTime()-k.getTime())/1e3);if(j<60)return"just now";if(j<3600){const b=Math.floor(j/60);return`${b} ${b===1?"minute":"minutes"} ago`}else if(j<86400){const b=Math.floor(j/3600);return`${b} ${b===1?"hour":"hours"} ago`}else{const b=Math.floor(j/86400);return`${b} ${b===1?"day":"days"} ago`}},d=n=>{const p=`https://www.instagram.com/${n}/#`;window.open(p,"_blank")};return e.jsxs(z,{className:"h-100",children:[a&&e.jsxs(O,{className:`d-flex align-items-center justify-content-between ${o?"user-select-none":""}`,style:{cursor:o?"pointer":"default",transition:o?"background-color 0.2s":"none"},onClick:o,title:o?"Click to open hashtag performance in new tab":"",onMouseEnter:n=>{o&&(n.currentTarget.style.backgroundColor="#f8f9fa")},onMouseLeave:n=>{o&&(n.currentTarget.style.backgroundColor="")},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("h5",{className:"card-title mb-0 me-2",children:t}),o&&e.jsx(N,{icon:"solar:external-link-broken",className:"fs-12 text-muted"})]}),e.jsx(P,{bg:"primary",pill:!0,children:s.length})]}),e.jsx(J,{className:"p-0",children:e.jsx("div",{style:{maxHeight:r,overflowY:"auto"},children:e.jsx(A,{variant:"flush",children:i?e.jsxs(A.Item,{className:"text-center py-4 text-muted",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading campaign posts..."})]}):u?e.jsxs(A.Item,{className:"text-center py-4 text-muted",children:[e.jsx(N,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2 text-danger"}),e.jsx("p",{className:"text-danger",children:u})]}):s.length===0?e.jsxs(A.Item,{className:"text-center py-4 text-muted",children:[e.jsx(N,{icon:"solar:document-text-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:"No campaign posts available"})]}):s.map(n=>{var p,k,C,j,b,D,l,$;return e.jsx(A.Item,{className:"px-3 py-3",children:e.jsxs(T,{className:"align-items-start",children:[e.jsx(v,{xs:"auto",children:e.jsxs("div",{className:"rounded-circle overflow-hidden position-relative",style:{width:"40px",height:"40px",minWidth:"40px",minHeight:"40px"},children:[e.jsx("img",{src:((p=n.influencer.instagram)==null?void 0:p.profile_pic_url)||"/images/users/user-1.jpg",alt:n.influencer.fullname,style:{width:"100%",height:"100%",objectFit:"cover",display:"block"},onError:c=>{const h=c.target;h.style.display="none";const I=h.nextElementSibling;I&&(I.style.display="flex")}}),e.jsx("div",{style:{width:"100%",height:"100%",display:"none",alignItems:"center",justifyContent:"center",backgroundColor:"#f8f9fa",position:"absolute",top:"0",left:"0"},children:e.jsx(N,{icon:"solar:user-broken",className:"fs-18 text-muted"})})]})}),e.jsxs(v,{children:[e.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-2",children:[e.jsxs("div",{className:"flex-grow-1 me-2",children:[e.jsx("h6",{className:"mb-1 text-truncate",children:e.jsxs("span",{className:"text-primary",style:{cursor:"pointer",textDecoration:"none"},onClick:()=>{var c,h,I;return d(((h=(c=n.influencer)==null?void 0:c.instagram)==null?void 0:h.handle)||((I=n.influencer)==null?void 0:I.username)||"")},onMouseEnter:c=>{c.currentTarget.style.textDecoration="underline"},onMouseLeave:c=>{c.currentTarget.style.textDecoration="none"},title:`Open @${((C=(k=n.influencer)==null?void 0:k.instagram)==null?void 0:C.handle)||((j=n.influencer)==null?void 0:j.username)||""} on Instagram`,children:["@",String(((D=(b=n.influencer)==null?void 0:b.instagram)==null?void 0:D.handle)||((l=n.influencer)==null?void 0:l.username)||"Unknown")]})}),e.jsx("div",{className:"d-flex align-items-center text-muted small mb-1",children:e.jsx("span",{className:"me-2",children:String((($=n.influencer)==null?void 0:$.fullname)||"")})})]}),e.jsx("div",{className:"text-end",children:e.jsxs("div",{className:"badge bg-success-subtle text-success small",children:[String(L(Number(n.total_followers)||0))," followers"]})})]}),e.jsx("p",{className:"text-muted mb-2 small",children:(()=>{let c="";if(n.caption){const h=n.caption;typeof h=="object"&&h[0]&&h[0].text?c=String(h[0].text):typeof h=="string"&&(c=h)}return c&&c.length>150&&(c=c.substring(0,150)+"..."),c||"No caption available"})()}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[Array.isArray(n.hashtags)&&n.hashtags.slice(0,2).map((c,h)=>e.jsx(P,{bg:"light",text:"dark",className:"me-1 small",children:String(c||"")},h)),Array.isArray(n.hashtags)&&n.hashtags.length>2&&e.jsxs("span",{className:"text-muted small",children:["+",n.hashtags.length-2," more"]})]}),e.jsx("small",{className:"text-muted",children:String(g(n.created_timestamp)||"")})]}),e.jsx("div",{className:"d-flex align-items-center justify-content-between",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(N,{icon:"solar:heart-broken",className:"fs-12 me-1 text-danger"}),e.jsx("span",{className:"small text-muted",children:String(L(Number(n.total_likes)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(N,{icon:"solar:chat-round-line-broken",className:"fs-12 me-1 text-primary"}),e.jsx("span",{className:"small text-muted",children:String(L(Number(n.total_comments)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center me-3",children:[e.jsx(N,{icon:"solar:share-broken",className:"fs-12 me-1 text-success"}),e.jsx("span",{className:"small text-muted",children:String(L(Number(n.reshare_count)||0))})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx(N,{icon:"solar:eye-broken",className:"fs-12 me-1 text-muted"}),e.jsx("span",{className:"small text-muted",children:String(L(Number(n.reach)||0))})]})]})})]})]})},n._id)})})})})]})},me=({challengrsGraphData:s,isLoading:t=!1,error:a=null})=>{const i=(()=>{if(!s||s.length===0)return{categories:["No Data"],completedData:[0],inProgressData:[0]};const o=s.map(n=>new Date(n.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})),g=s.map(n=>n.Completed),d=s.map(n=>n.InProgress);return{categories:o,completedData:g,inProgressData:d}})(),u={chart:{type:"bar",height:350,toolbar:{show:!1}},series:[{name:"Completed",data:i.completedData,color:"#10b981"},{name:"In Progress",data:i.inProgressData,color:"#3b82f6"}],xaxis:{categories:i.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},plotOptions:{bar:{horizontal:!1,columnWidth:"60%",borderRadius:4}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(z,{children:[e.jsx(O,{children:e.jsx("h5",{className:"card-title mb-0",children:"Challenges Progress"})}),e.jsx(J,{children:t?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(q,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading chart data..."})]}):a?e.jsxs("div",{className:"text-center py-4 text-danger",children:[e.jsx(N,{icon:"solar:danger-circle-broken",className:"fs-48 mb-2"}),e.jsx("p",{children:a})]}):e.jsx(ee,{options:u,series:u.series,type:"bar",height:350})})]})},he=({dashboardData:s,isLoading:t=!1,error:a=null})=>{const i=(()=>{var o;if((o=s==null?void 0:s.postGraphData)!=null&&o.itchotels&&Array.isArray(s.postGraphData.itchotels)){const g=s.postGraphData.itchotels.filter(d=>d.y!==null).map(d=>({timestamp:d.x,date:new Date(d.x).toLocaleDateString("en-US",{month:"short",day:"numeric"}),value:d.y||0})).sort((d,n)=>d.timestamp-n.timestamp);return{categories:g.map(d=>d.date),publishedData:g.map(d=>d.value),timestamps:g.map(d=>d.timestamp)}}return{categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],publishedData:[5,8,12,15,18,22,25,28,32,35,38,42],timestamps:[]}})(),u={chart:{type:"area",height:350,toolbar:{show:!1}},series:[{name:"Posts Count",data:i.publishedData,color:"#f59e0b"}],xaxis:{categories:i.categories,labels:{style:{colors:"#8e8da4"}}},yaxis:{labels:{style:{colors:"#8e8da4"}}},grid:{borderColor:"#f1f3fa"},stroke:{curve:"smooth",width:2},fill:{type:"gradient",gradient:{shadeIntensity:1,opacityFrom:.7,opacityTo:.3,stops:[0,90,100]}},dataLabels:{enabled:!1},legend:{position:"top",horizontalAlign:"right"},tooltip:{theme:"light"}};return e.jsxs(z,{children:[e.jsx(O,{children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsx("h5",{className:"card-title mb-0",children:"Post Analytics"})})}),e.jsx(J,{children:t?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"350px"},children:e.jsx(re,{})}):a?e.jsx("div",{className:"d-flex justify-content-center align-items-center text-danger",style:{height:"350px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"mdi mdi-alert-circle-outline fs-2 mb-2"}),e.jsx("p",{className:"mb-0",children:a})]})}):e.jsx(ee,{options:u,series:u.series,type:"area",height:350})})]})},Q=s=>{var t,a,r;try{const i=(t=_.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:t.toString();if(i){const o=JSON.parse(i);if(o!=null&&o.token)return o.token}const u=(a=_.getCookie("token"))==null?void 0:a.toString();return s||u||localStorage.getItem("authToken")||""}catch(i){console.warn("Failed to get auth token from session:",i);const u=(r=_.getCookie("token"))==null?void 0:r.toString();return s||u||localStorage.getItem("authToken")||""}},M=class M{constructor(){y(this,"fallbackToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZThkMjQxYzkyMWE5ZDEzMzhmNGMwMyIsImlhdCI6MTc2MDU5NDU5MiwiZXhwIjoxNzYwNjgwOTkyfQ.9ttWBQlQj6pDY-9mJp4gwGdvHbFJlGzWciWAnHPxzls")}static getInstance(){return M.instance||(M.instance=new M),M.instance}async getChallengerProgress(){try{const t=Q(this.fallbackToken);if(!t)return console.warn("Authentication token not found, using mock data."),this.getMockProgressData();const a=await fetch(`${te.BASE_URL}/challenger/progress`,{method:"GET",headers:{authorization:t,"Content-Type":"application/json"}});if(!a.ok){const i=await a.json().catch(()=>({message:"Failed to fetch progress data"}));if(a.status===401||i.message==="Unauthorized!")return console.warn("Using mock data due to authentication failure. Please check your token."),this.getMockProgressData();throw new Error(i.message||`HTTP ${a.status}: Failed to fetch progress data`)}return await a.json()}catch(t){if(console.error("Progress API Error:",t),t.name==="TypeError"&&t.message.includes("fetch"))return console.warn("Network error detected, using mock data."),this.getMockProgressData();throw new Error(t.message||"Failed to fetch progress data")}}getMockProgressData(){return{data:{erProgress:{_id:"68f09870df697dec080d18fa",name:"engagement",currentValue:483408,previousValue:483398,manualEntries:10,difference:10,createdAt:"2025-10-16T07:02:08.496Z",updatedAt:"2025-10-16T07:02:08.496Z",__v:0},challengerProgress:{_id:"68f0c1e2f4275b75860cbf9e",name:"challenge",currentValue:3,previousValue:2,manualEntries:0,difference:1,createdAt:"2025-10-16T09:58:58.000Z",updatedAt:"2025-10-16T09:58:58.000Z",__v:0}}}}setAuthToken(t){this.fallbackToken=t}getAuthToken(){return Q(this.fallbackToken)}};y(M,"instance");let U=M;const ge=U.getInstance();class fe{constructor(t){y(this,"el");y(this,"piece");y(this,"top");y(this,"bottom");y(this,"back");y(this,"backBottom");y(this,"currentValue");const a=document.createElement("span");a.className="flip-clock__wrapper1";const r=document.createElement("span");r.className="flip-clock__piece m-0",r.innerHTML='<b class="flip-clock__card card1"><b class="card__top"></b><b class="card__bottom"></b><b class="card__back"><b class="card__bottom"></b></b></b>',a.appendChild(r),this.el=a,this.piece=r,this.top=r.querySelector(".card__top"),this.bottom=r.querySelector(".card__bottom"),this.back=r.querySelector(".card__back"),this.backBottom=r.querySelector(".card__back .card__bottom"),this.currentValue="",this.update(t)}update(t,a=!1){const r=t.toString(),i=r!==this.currentValue;(i||a)&&(this.back.setAttribute("data-value",this.currentValue),this.bottom.setAttribute("data-value",this.currentValue),this.currentValue=r,this.top.textContent=r,this.backBottom.setAttribute("data-value",r),(i||a)&&(this.el.classList.remove("flip"),this.el.offsetWidth,this.el.classList.add("flip")))}updateInstant(t){const a=t.toString();this.currentValue=a,this.top.textContent=a,this.back.setAttribute("data-value",a),this.bottom.setAttribute("data-value",a),this.backBottom.setAttribute("data-value",a)}}class xe{constructor(t,a=0){y(this,"container");y(this,"value");y(this,"digits");this.container=t,this.value=a,this.digits=[],this.render()}render(){this.container.innerHTML="";const t=this.value.toString();this.digits=[];for(let a=0;a<t.length;a++){const r=new fe(t[a]);this.container.appendChild(r.el),this.digits.push(r)}}update(){const t=this.value.toString();if(t.length>this.digits.length)this.render();else for(let a=0;a<this.digits.length;a++){const r=t.length-this.digits.length+a,i=r>=0?t[r]:"0";this.digits[a].update(i)}}setValue(t){this.value=t,this.update()}setValueWithAnimation(t,a){const r=t.toString(),i=a.toString(),u=Math.max(r.length,i.length),o=r.padStart(u,"0"),g=i.padStart(u,"0");if(r.length>this.digits.length){this.value=t,this.render();return}this.value=t;for(let d=0;d<this.digits.length;d++){const n=o.length-this.digits.length+d,p=n>=0?o[n]:"0",k=n>=0&&n<g.length?g[n]:"0";p!==k?this.digits[d].update(p,!0):this.digits[d].updateInstant(p)}}setValueInstant(t){const a=t.toString();if(a.length>this.digits.length){this.value=t,this.render();return}this.value=t;for(let r=0;r<this.digits.length;r++){const i=a.length-this.digits.length+r,u=i>=0?a[i]:"0";this.digits[r].updateInstant(u)}}}const K=({progressType:s,label:t,className:a="",animationDuration:r=5e3,pollInterval:i=1e4})=>{const u=x.useRef(null),o=x.useRef(null),g=x.useRef(null),d=x.useRef(null),[n,p]=x.useState(null),[k,C]=x.useState(!1),[j,b]=x.useState(0),[D,l]=x.useState(!1),$=x.useCallback(async()=>{try{console.log(`${s}: Calling API...`);const m=(await ge.getChallengerProgress()).data[s];if(m)return console.log(`${s}: API response received:`,m),p(m),m;console.warn(`${s}: No data found in API response`)}catch(f){console.error(`${s}: Error fetching data:`,f)}return null},[s]),c=x.useRef(),h=x.useCallback(()=>{console.log(`${s}: Scheduling next API poll in ${i}ms`),d.current&&clearTimeout(d.current),d.current=setTimeout(async()=>{try{console.log(`${s}: Timer triggered - Fetching new progress data...`);const f=await $();if(f){if(console.log(`${s}: API returned data:`,{currentValue:f.currentValue,previousValue:f.previousValue,difference:f.difference,lastDisplayed:j}),k){console.log(`${s}: Still animating, rescheduling poll`),setTimeout(()=>{var w;return(w=c.current)==null?void 0:w.call(c)},2e3);return}const m=!n||f.currentValue!==n.currentValue||f.updatedAt!==n.updatedAt;if(console.log(`${s}: hasNewData: ${m}`),m){console.log(`${s}: NEW data detected, animating from ${j} to ${f.currentValue}`);const w=f.currentValue-j;p(f),I.current&&I.current(j,f.currentValue,w)}else console.log(`${s}: SAME data, repeating animation from ${f.previousValue} to ${f.currentValue}`),l(!0),o.current&&o.current.setValueInstant(f.previousValue),b(f.previousValue),setTimeout(()=>{I.current&&I.current(f.previousValue,f.currentValue,f.difference)},500)}else console.warn(`${s}: Failed to fetch data, retrying in ${i}ms`),setTimeout(()=>{var m;return(m=c.current)==null?void 0:m.call(c)},i)}catch(f){console.error(`${s}: Error during API polling:`,f),setTimeout(()=>{var m;return(m=c.current)==null?void 0:m.call(c)},i)}},i)},[s,i,$]);c.current=h;const I=x.useRef(),W=x.useCallback((f,m,w)=>{if(console.log(`${s}: animateCounter called with fromValue: ${f}, toValue: ${m}, difference: ${w}`),f===m){console.log(`${s}: No animation needed (fromValue === toValue), setting value to: ${m}`),o.current&&o.current.setValueInstant(m),b(m),console.log(`${s}: Scheduling next poll after no-animation case`),setTimeout(()=>{console.log(`${s}: Executing scheduled poll from no-animation case`),c.current&&c.current()},100);return}C(!0);const R=Math.abs(w),V=Math.max(5,Math.min(R,50)),Z=r/V,G=w/V;console.log(`${s}: Animation setup - absoluteDifference: ${R}, steps: ${V}, stepDuration: ${Z}, stepValue: ${G}`);let F=0,S=f;g.current&&clearInterval(g.current),g.current=setInterval(()=>{F++;const Y=S;S=Math.round(f+G*F);const B=w>0&&S>=m||w<0&&S<=m||F>=V;if(console.log(`${s}: Step ${F}/${V} - currentValue: ${S}, toValue: ${m}, reachedTarget: ${B}`),B){S=m,o.current&&o.current.setValueWithAnimation(S,Y),b(S),g.current&&(clearInterval(g.current),g.current=null),console.log(`${s}: Animation completed, reached value: ${S}`),setTimeout(()=>{C(!1),l(!1),console.log(`${s}: States reset, scheduling next API poll after animation completion`),c.current&&c.current()},100);return}o.current&&o.current.setValueWithAnimation(S,Y)},Z)},[r,s]);return I.current=W,x.useEffect(()=>u.current?((async()=>{const m=await $();if(m){console.log(`${s}: Initializing with data:`,m);const w=m.previousValue;b(w);const R=new xe(u.current,w);o.current=R,console.log(`${s}: Starting initial animation from ${m.previousValue} to ${m.currentValue}`),W(m.previousValue,m.currentValue,m.difference)}else console.warn(`${s}: No initial data received`),setTimeout(()=>{console.log(`${s}: No initial data, starting polling cycle`),c.current&&c.current()},1e3)})(),()=>{g.current&&clearInterval(g.current),d.current&&clearTimeout(d.current),u.current&&(u.current.innerHTML="")}):void 0,[]),e.jsx("div",{className:`card shadow-sm h-100 ${a}`,children:e.jsx("div",{className:"card-body d-flex flex-column justify-content-center align-items-center text-center p-4",children:e.jsxs("div",{className:"flip-counter-container w-100",children:[e.jsx("div",{className:"d-flex gap-2 justify-content-center mb-3",children:e.jsx("div",{ref:u,className:"flip-clock"})}),e.jsxs("h6",{className:"card-title mb-2 fw-semibold",children:[t,k&&!D&&e.jsx("span",{className:"ms-2 text-primary",children:"ðŸ”„"}),D&&e.jsx("span",{className:"ms-2 text-info",children:"ðŸ”"})]}),n&&e.jsx("div",{className:"text-center mt-2",children:e.jsx("small",{className:"text-muted"})})]})})})},X=s=>{var t,a,r;try{const i=(t=_.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:t.toString();if(i){const o=JSON.parse(i);if(o!=null&&o.token)return o.token}const u=(a=_.getCookie("token"))==null?void 0:a.toString();return s||u||localStorage.getItem("authToken")||""}catch(i){console.warn("Failed to get auth token from session:",i);const u=(r=_.getCookie("token"))==null?void 0:r.toString();return s||u||localStorage.getItem("authToken")||""}},E=class E{constructor(){y(this,"fallbackToken","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZThkMjQxYzkyMWE5ZDEzMzhmNGMwMyIsImlhdCI6MTc2MDQyMzkyMiwiZXhwIjoxNzYwNTEwMzIyfQ.jpyOCiQ_lunYouOyLSOXTWOJ3pDfWGg0JKxd9Rgparo")}static getInstance(){return E.instance||(E.instance=new E),E.instance}async getDashboardData(){try{const t=X(this.fallbackToken);if(!t)return console.warn("Authentication token not found, using mock data."),this.getMockDashboardData();const a=await fetch(`${te.API_URL}/dashboard`,{method:"GET",headers:{authorization:t,"Content-Type":"application/json"}});if(!a.ok){const i=await a.json().catch(()=>({message:"Failed to fetch dashboard data"}));if(a.status===401||i.message==="Unauthorized!")return console.warn("Using mock data due to authentication failure. Please check your token."),this.getMockDashboardData();throw new Error(i.message||`HTTP ${a.status}: Failed to fetch dashboard data`)}return await a.json()}catch(t){if(console.error("Dashboard API Error:",t),t.name==="TypeError"&&t.message.includes("fetch"))return console.warn("Network error detected, using mock data."),this.getMockDashboardData();throw new Error(t.message||"Failed to fetch dashboard data")}}getMockDashboardData(){return{totalStories:25,totalViews:15e3,totalLikes:12500,challengrsGraphData:[{date:"2025-10-13T00:00:00.000Z",Completed:0,InProgress:1},{date:"2025-10-16T00:00:00.000Z",Completed:0,InProgress:2}],postGraphData:{itchotels:[{x:170424e7,y:2},{x:17073504e5,y:3},{x:170856e7,y:4},{x:17099424e5,y:5},{x:17183232e5,y:3},{x:17241984e5,y:6},{x:17320608e5,y:4},{x:1737936e6,y:7},{x:17479584e5,y:5},{x:17555616e5,y:8},{x:17576352e5,y:6},{x:175824e7,y:9}],itchotels_count:25}}}setAuthToken(t){this.fallbackToken=t}getAuthToken(){return X(this.fallbackToken)}};y(E,"instance");let H=E;const pe=H.getInstance(),Oe=()=>{const[s,t]=x.useState([]),[a,r]=x.useState(!0),[i,u]=x.useState(null),[o,g]=x.useState(null),[d,n]=x.useState(!0),[p,k]=x.useState(null),[C,j]=x.useState([]),[b,D]=x.useState(!0),[l,$]=x.useState(null);return x.useEffect(()=>{(async()=>{try{n(!0),k(null);const h=await pe.getDashboardData();g(h)}catch(h){k("Failed to fetch dashboard data"),console.error("Error fetching dashboard data:",h)}finally{n(!1)}})()},[]),x.useEffect(()=>{(async()=>{try{r(!0);const h=await oe.getCampaignContents("daawatbiryani",1,10);h.success&&h.data.posts&&t(h.data.posts)}catch(h){u("Failed to fetch campaign contents"),console.error("Error fetching campaign contents:",h)}finally{r(!1)}})()},[]),x.useEffect(()=>{(async()=>{try{D(!0),$(null);const h=await le.getAllChallengers({limit:10,page:1});h.data&&j(h.data)}catch(h){$("Failed to fetch challengers"),console.error("Error fetching challengers:",h)}finally{D(!1)}})()},[]),e.jsxs(e.Fragment,{children:[e.jsx(ie,{subName:"Daawat",title:"Dashboard Analytics"}),e.jsxs(T,{className:"mb-4",children:[e.jsx(v,{xl:6,lg:6,md:12,children:e.jsx(K,{progressType:"challengerProgress",label:"Challenges Taken",className:"h-100",animationDuration:5e3,pollInterval:15e3})}),e.jsx(v,{xl:6,lg:6,md:12,children:e.jsx(K,{progressType:"erProgress",label:"Interactions",className:"h-100",animationDuration:5e3,pollInterval:15e3})})]}),e.jsx("div",{className:"mb-4"}),e.jsxs(T,{className:"mb-4 g-3",children:[e.jsx(v,{xl:6,lg:6,md:12,children:e.jsx(me,{challengrsGraphData:(o==null?void 0:o.challengrsGraphData)||[],isLoading:d,error:p})}),e.jsx(v,{xl:6,lg:12,md:12,children:e.jsx(he,{dashboardData:o,isLoading:d,error:p})})]}),e.jsxs(T,{className:"mb-4 g-3",children:[e.jsx(v,{xl:6,lg:6,md:12,children:e.jsx(de,{challengers:C,title:"Recent Challengers",showHeader:!0,maxHeight:"400px",isLoading:b,error:l,onTitleClick:()=>window.open("/challengers","_blank"),challengrsGraphData:(o==null?void 0:o.challengrsGraphData)||[]})}),e.jsx(v,{xl:6,lg:12,md:12,children:e.jsx(ue,{posts:s,title:"Recent Posts",showHeader:!0,maxHeight:"400px",isLoading:a,error:i,onTitleClick:()=>window.open("/social/hashtag-performance","_blank")})})]}),e.jsx(ne,{})]})};export{Oe as default};
