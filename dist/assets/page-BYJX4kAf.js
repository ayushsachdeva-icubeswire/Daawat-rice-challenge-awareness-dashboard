import{l as w,i as B,r as c,j as e,R as f,f as m,F as R}from"./index-CGTelMHW.js";import{P as z}from"./PageTitle-BtmCnuGU.js";import{I as u}from"./IconifyIcon-SqSiRsxm.js";import{C as L,b as $,a as H}from"./Card-BJOT5JOt.js";import{I as K}from"./InputGroup-IsxKnIA6.js";import{F as v}from"./Form-PDhn1Gsb.js";import{B as p}from"./Button-DPYzANI6.js";import{S as G}from"./Spinner-DFtOsvEN.js";import{T as M}from"./Table-ViXpXctB.js";import{B as T}from"./Badge-Bugulnus.js";import"./FormCheck-YGWEidz1.js";import"./FormControl-rMbkRvmT.js";import"./warning-Bhb7w56c.js";import"./FormLabel-DjFrH49g.js";import"./ElementChildren-MKa-k2mM.js";import"./InputGroupContext-DpDE5dEh.js";import"./FormGroup-B6sBFY5e.js";import"./FormSelect-BNR1FSn5.js";import"./FormText-C-g8WRQq.js";import"./Button-CedpSIw1.js";const P=d=>{var a,s,r;try{const l=(a=w.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:a.toString();if(l){const h=JSON.parse(l);if(h!=null&&h.token)return h.token}const j=(s=w.getCookie("token"))==null?void 0:s.toString();return d||j||localStorage.getItem("authToken")||""}catch(l){return console.warn("Failed to get auth token from session:",l),((r=w.getCookie("token"))==null?void 0:r.toString())||localStorage.getItem("authToken")||""}},k=()=>({authorization:P(),"Content-Type":"application/json"});class N{static async getAllChallengers(a){try{if(!P())throw new Error("Authentication token not found. Please login again.");const r=new URLSearchParams;a!=null&&a.category&&r.append("category",a.category),a!=null&&a.subcategory&&r.append("subcategory",a.subcategory),a!=null&&a.type&&r.append("type",a.type),a!=null&&a.duration&&r.append("duration",a.duration),a!=null&&a.search&&r.append("search",a.search),a!=null&&a.page&&r.append("page",a.page.toString()),a!=null&&a.limit&&r.append("limit",a.limit.toString());const l=await fetch(`http://localhost:8080/api/challenger?${r.toString()}`,{method:"GET",headers:k()});if(!l.ok)throw new Error(`Failed to fetch challengers: ${l.statusText}`);return await l.json()}catch(s){throw console.error("Error fetching challengers:",s),s}}static async getChallengerById(a){try{if(!P())throw new Error("Authentication token not found. Please login again.");const r=await fetch(`http://localhost:8080/api/challenger/${a}`,{method:"GET",headers:k()});if(!r.ok)throw new Error(`Failed to fetch challenger: ${r.statusText}`);return await r.json()}catch(s){throw console.error("Error fetching challenger:",s),s}}static async deleteChallenger(a){try{if(!P())throw new Error("Authentication token not found. Please login again.");const r=await fetch(`http://localhost:8080/api/challenger/${a}`,{method:"DELETE",headers:k()});if(!r.ok)throw new Error(`Failed to delete challenger: ${r.statusText}`)}catch(s){throw console.error("Error deleting challenger:",s),s}}}const de=()=>{var E;const{showNotification:d}=B(),[a,s]=c.useState(!1),[r,l]=c.useState([]),[j,h]=c.useState(""),[i,y]=c.useState({page:1,limit:10,search:"",duration:""}),[o,b]=c.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),x=c.useRef(null);c.useEffect(()=>{(async()=>{try{s(!0);const n=await N.getAllChallengers(i);l(n.data||[]),b({currentPage:n.currentPage||1,totalPages:n.totalPages||1,totalItems:n.totalItems||0,itemsPerPage:i.limit||10})}catch(n){console.error("❌ Error fetching challengers:",n),d({message:"Error fetching challengers",variant:"danger"}),l([])}finally{s(!1)}})()},[i.page,i.limit,i.search,i.duration,i.category,i.subcategory,i.type,d]),c.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]);const A=c.useCallback(t=>{h(t),x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{y(n=>({...n,search:t,page:1}))},500)},[]),S=(t,n)=>{y(g=>({...g,[t]:n,page:1}))},C=t=>{y(n=>({...n,page:t}))},I=t=>{y(n=>({...n,limit:t,page:1}))},F=async t=>{if(window.confirm("Are you sure you want to delete this challenger?"))try{s(!0),await N.deleteChallenger(t),d({message:"Challenger deleted successfully",variant:"success"});const n=await N.getAllChallengers(i);l(n.data||[]),b({currentPage:n.currentPage||1,totalPages:n.totalPages||1,totalItems:n.totalItems||0,itemsPerPage:i.limit||10})}catch(n){console.error("❌ Error deleting challenger:",n),d({message:"Error deleting challenger",variant:"danger"})}finally{s(!1)}},D=t=>t?"success":"secondary",_=t=>t?new Date(t).toLocaleDateString():"N/A";return e.jsxs(e.Fragment,{children:[e.jsx(z,{subName:"Daawat",title:"Challengers"}),e.jsx(f,{children:e.jsx(m,{xs:12,children:e.jsxs(L,{children:[e.jsx($,{className:"d-flex justify-content-between align-items-center",children:e.jsxs("div",{children:[e.jsx("h5",{className:"card-title mb-0",children:"All Challengers"}),e.jsxs("p",{className:"text-muted mb-0",children:["Showing ",(o.currentPage-1)*o.itemsPerPage+1," to"," ",Math.min(o.currentPage*o.itemsPerPage,o.totalItems)," of"," ",o.totalItems," challengers"]})]})}),e.jsxs(H,{children:[e.jsxs(f,{className:"mb-4",children:[e.jsx(m,{lg:6,children:e.jsxs(K,{children:[e.jsx(v.Control,{type:"text",placeholder:"Search challengers...",value:j,onChange:t=>A(t.target.value)}),e.jsx(p,{variant:"outline-secondary",children:e.jsx(u,{icon:"solar:magnifer-linear"})})]})}),e.jsx(m,{lg:2,children:e.jsxs(v.Select,{value:i.category||"",onChange:t=>S("category",t.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Vegetarian",children:"Vegetarian"}),e.jsx("option",{value:"Keto",children:"Keto"}),e.jsx("option",{value:"High Protein",children:"High Protein"})]})}),e.jsx(m,{lg:2,children:e.jsxs(v.Select,{value:i.duration||"",onChange:t=>S("duration",t.target.value),children:[e.jsx("option",{value:"",children:"All Durations"}),e.jsx("option",{value:"7 days",children:"7 days"}),e.jsx("option",{value:"1 month",children:"1 month"}),e.jsx("option",{value:"3 months",children:"3 months"})]})}),e.jsx(m,{lg:2,children:e.jsxs(v.Select,{value:((E=i.limit)==null?void 0:E.toString())||"10",onChange:t=>I(parseInt(t.target.value)),children:[e.jsx("option",{value:"5",children:"5 per page"}),e.jsx("option",{value:"10",children:"10 per page"}),e.jsx("option",{value:"25",children:"25 per page"}),e.jsx("option",{value:"50",children:"50 per page"})]})})]}),a&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(G,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading challengers..."})]}),!a&&r.length===0&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx(u,{icon:"solar:user-cross-rounded-bold",className:"fs-1 text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No challengers found"}),e.jsx("p",{className:"text-muted",children:"Try adjusting your search criteria or filters."})]}),!a&&r.length>0&&e.jsx("div",{className:"table-responsive",children:e.jsxs(M,{className:"table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Mobile"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"avatar-md me-2",children:e.jsx("div",{className:"avatar-title bg-light-primary text-primary rounded-circle",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:t.name}),t.subcategory&&e.jsx("small",{className:"text-muted",children:t.subcategory})]})]})}),e.jsx("td",{children:t.mobile}),e.jsx("td",{children:e.jsx(T,{bg:"light",text:"dark",children:t.category})}),e.jsx("td",{children:t.type}),e.jsx("td",{children:t.duration}),e.jsx("td",{children:e.jsx(T,{bg:D(t.isActive),children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{children:_(t.createdAt)}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[t.pdf&&e.jsx(p,{size:"sm",variant:"outline-primary",onClick:()=>window.open(t.pdf,"_blank"),title:"View PDF",children:e.jsx(u,{icon:"solar:document-text-linear"})}),e.jsx(p,{size:"sm",variant:"outline-danger",onClick:()=>t._id&&F(t._id),title:"Delete Challenger",children:e.jsx(u,{icon:"solar:trash-bin-minimalistic-linear"})})]})})]},t._id))})]})}),!a&&r.length>0&&o.totalPages>1&&e.jsx(f,{className:"mt-4",children:e.jsxs(m,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("div",{children:e.jsxs("small",{className:"text-muted",children:["Page ",o.currentPage," of ",o.totalPages]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(p,{size:"sm",variant:"outline-primary",disabled:o.currentPage<=1,onClick:()=>C(o.currentPage-1),children:[e.jsx(u,{icon:"solar:alt-arrow-left-linear"}),"Previous"]}),Array.from({length:Math.min(5,o.totalPages)},(t,n)=>{const g=n+1;return e.jsx(p,{size:"sm",variant:g===o.currentPage?"primary":"outline-primary",onClick:()=>C(g),children:g},g)}),e.jsxs(p,{size:"sm",variant:"outline-primary",disabled:o.currentPage>=o.totalPages,onClick:()=>C(o.currentPage+1),children:["Next",e.jsx(u,{icon:"solar:alt-arrow-right-linear"})]})]})]})})]})]})})}),e.jsx(R,{})]})};export{de as default};
