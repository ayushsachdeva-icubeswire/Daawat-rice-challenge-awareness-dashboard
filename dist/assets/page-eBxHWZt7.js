import{l as T,r as u,h as $,j as e,R as F,d as f}from"./index-BOi36ikE.js";import{C as G}from"./ComponentContainerCard-t2W6pgOe.js";import{P as O}from"./PageTitle-C0q_ke_x.js";import{A as U}from"./api-VjRoL-6d.js";import{M as C}from"./Modal-3heh3-zL.js";import{F as i}from"./Form-CyqREbkq.js";import{B as L}from"./Button-BvGQU5Tn.js";import"./Card-CKK8cF51.js";import"./IconifyIcon-D-fAS7Lf.js";import"./AbstractModalHeader-C-zhnWoR.js";import"./useWindow-RoAZvLi8.js";import"./usePrevious-CkV1fWci.js";import"./useEventCallback-BRVSY-Qx.js";import"./hasClass-_WT9P77M.js";import"./useMergedRefs-DtpZ3xbQ.js";import"./NoopTransition-DyVysFzl.js";import"./DataKey-COGXBUcQ.js";import"./FormCheck-CoOps_-H.js";import"./FormControl-DQso-BxT.js";import"./warning-CtTLPEeT.js";import"./FormLabel-VLBhoLkC.js";import"./ElementChildren-gdhvZ1Pb.js";import"./FormGroup-CSLKaIB9.js";import"./FormSelect-2uIZOPzd.js";import"./FormText-B16Ucq3A.js";import"./Button-64tJsohZ.js";const P=U.API_URL,x=g=>{var s,t,o;try{const r=(s=T.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:s.toString();if(r){const d=JSON.parse(r);if(d!=null&&d.token)return d.token}const h=(t=T.getCookie("token"))==null?void 0:t.toString();return g||h||localStorage.getItem("authToken")||""}catch(r){return console.warn("Failed to get auth token from session:",r),((o=T.getCookie("token"))==null?void 0:o.toString())||localStorage.getItem("authToken")||""}},S=()=>({authorization:x(),"Content-Type":"application/json"}),I=()=>({authorization:x()});class k{static async getAllDietPlans(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new URLSearchParams;s!=null&&s.category&&o.append("category",s.category),s!=null&&s.subcategory&&o.append("subcategory",s.subcategory),s!=null&&s.type&&o.append("type",s.type),(s==null?void 0:s.isActive)!==void 0&&o.append("isActive",s.isActive.toString()),s!=null&&s.page&&o.append("page",s.page.toString()),s!=null&&s.limit&&o.append("limit",s.limit.toString());const r=await fetch(`${P}/dietplans?${o.toString()}`,{method:"GET",headers:S()});if(!r.ok)throw new Error(`Failed to fetch diet plans: ${r.statusText}`);return await r.json()}catch(t){throw console.error("Error fetching diet plans:",t),t}}static async getDietPlanById(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${P}/dietplans/${s}`,{method:"GET",headers:S()});if(!o.ok)throw new Error(`Failed to fetch diet plan: ${o.statusText}`);return await o.json()}catch(t){throw console.error("Error fetching diet plan:",t),t}}static async createDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=new FormData;o.append("name",s.name),o.append("duration",s.duration),o.append("type",s.type),o.append("category",s.category),o.append("isActive",s.isActive.toString()),s.subcategory&&o.append("subcategory",s.subcategory),s.description&&o.append("description",s.description),s.pdfFile&&o.append("pdfFile",s.pdfFile);const r=await fetch(`${P}/dietplans`,{method:"POST",headers:I(),body:o});if(!r.ok)throw new Error(`Failed to create diet plan: ${r.statusText}`);return await r.json()}catch(t){throw console.error("Error creating diet plan:",t),t}}static async updateDietPlan(s,t){try{if(!x())throw new Error("Authentication token not found. Please login again.");const r=new FormData;r.append("name",t.name),r.append("duration",t.duration),r.append("type",t.type),r.append("category",t.category),r.append("isActive",t.isActive.toString()),t.subcategory&&r.append("subcategory",t.subcategory),t.description&&r.append("description",t.description),t.pdfFile&&r.append("pdfFile",t.pdfFile);const h=await fetch(`${P}/dietplans/${s}`,{method:"PUT",headers:I(),body:r});if(!h.ok)throw new Error(`Failed to update diet plan: ${h.statusText}`);return await h.json()}catch(o){throw console.error("Error updating diet plan:",o),o}}static async deleteDietPlan(s){try{if(!x())throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${P}/dietplans/${s}`,{method:"DELETE",headers:S()});if(!o.ok)throw new Error(`Failed to delete diet plan: ${o.statusText}`)}catch(t){throw console.error("Error deleting diet plan:",t),t}}static async deleteAllDietPlans(){try{if(!x())throw new Error("Authentication token not found. Please login again.");const t=await fetch(`${P}/dietplans`,{method:"DELETE",headers:S()});if(!t.ok)throw new Error(`Failed to delete all diet plans: ${t.statusText}`)}catch(s){throw console.error("Error deleting all diet plans:",s),s}}static async downloadPDF(s){try{const t=x();if(!t)throw new Error("Authentication token not found. Please login again.");const o=await fetch(`${P}/dietplans/${s}/download`,{method:"GET",headers:{authorization:t}});if(!o.ok)throw new Error(`Failed to download PDF: ${o.statusText}`);return await o.blob()}catch(t){throw console.error("Error downloading PDF:",t),t}}static triggerPDFDownload(s,t){const o=window.URL.createObjectURL(s),r=document.createElement("a");r.href=o,r.download=t,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(o)}}const M=["Vegetarian","Veg+ Egg","Veg+ Meat"],B=["Weight Loss","Weight Gain","Muscle Building","Maintenance","Athletic Performance","General Health"],R=["7 days","14 days","21 days","30 days"],_=["Weight Loss Meal Plan","High Protein Meal Plan","North Indian Meal Plan","South Indian Meal Plan","Asian Meal Plan","Fusion Meal Plan","Maharashtra Meal Plan","Sattvikk Meal Plan"],z=({show:g,onHide:s,editingPlan:t,onSubmit:o})=>{const[r,h]=u.useState({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),[d,v]=u.useState(!1),[l,b]=u.useState({}),{showNotification:j}=$();u.useEffect(()=>{h(t?{name:t.name||"",duration:t.duration||"",type:t.type||"",category:t.category||"",subcategory:t.subcategory||"",description:t.description||"",isActive:t.isActive??!0}:{name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({})},[t,g]);const N=()=>{const n={};return r.name.trim()||(n.name="Plan name is required"),r.duration||(n.duration="Duration is required"),r.type||(n.type="Type is required"),r.category||(n.category="Category is required"),b(n),Object.keys(n).length===0},A=async n=>{if(n.preventDefault(),!!N()){v(!0);try{t&&t._id?(await k.updateDietPlan(t._id,r),j({message:"Diet plan updated successfully",variant:"success"})):(await k.createDietPlan(r),j({message:"Diet plan created successfully",variant:"success"})),o()}catch(p){console.error("Error saving diet plan:",p),j({message:`Error ${t?"updating":"creating"} diet plan`,variant:"danger"})}finally{v(!1)}}},m=(n,p)=>{h(y=>({...y,[n]:p})),l[n]&&b(y=>({...y,[n]:""}))},w=n=>{var y;const p=(y=n.target.files)==null?void 0:y[0];if(p){if(p.type!=="application/pdf"){j({message:"Only PDF files are allowed",variant:"warning"}),n.target.value="";return}const D=10*1024*1024;if(p.size>D){j({message:"File size must be less than 10MB",variant:"warning"}),n.target.value="";return}m("pdfFile",p)}},E=()=>{h({name:"",duration:"",type:"",category:"",subcategory:"",description:"",isActive:!0}),b({}),s()};return e.jsxs(C,{show:g,onHide:E,size:"lg",centered:!0,children:[e.jsx(C.Header,{closeButton:!0,children:e.jsx(C.Title,{children:t?"Edit Diet Plan":"Create New Diet Plan"})}),e.jsxs(i,{onSubmit:A,children:[e.jsxs(C.Body,{children:[e.jsxs(F,{children:[e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Plan Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx(i.Control,{type:"text",value:r.name,onChange:n=>m("name",n.target.value),isInvalid:!!l.name,placeholder:"Enter diet plan name"}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.name})]})}),e.jsx(f,{md:6,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Duration ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.duration,onChange:n=>m("duration",n.target.value),isInvalid:!!l.duration,children:[e.jsx("option",{value:"",children:"Select duration"}),R.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.duration})]})})]}),e.jsxs(F,{children:[e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Type ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.type,onChange:n=>m("type",n.target.value),isInvalid:!!l.type,children:[e.jsx("option",{value:"",children:"Select type"}),B.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.type})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsxs(i.Label,{children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs(i.Select,{value:r.category,onChange:n=>m("category",n.target.value),isInvalid:!!l.category,children:[e.jsx("option",{value:"",children:"Select category"}),M.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Control.Feedback,{type:"invalid",children:l.category})]})}),e.jsx(f,{md:4,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Subcategory (Optional)"}),e.jsxs(i.Select,{value:r.subcategory,onChange:n=>m("subcategory",n.target.value),children:[e.jsx("option",{value:"",children:"Select subcategory (optional)"}),_.map(n=>e.jsx("option",{value:n,children:n},n))]}),e.jsx(i.Text,{className:"text-muted"})]})})]}),e.jsx(F,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"PDF File"}),e.jsx(i.Control,{type:"file",accept:".pdf",onChange:w}),e.jsx(i.Text,{className:"text-muted",children:"Upload a PDF file (max 10MB). Only PDF files are allowed."}),(t==null?void 0:t.pdfFile)&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"Current file: ",t.pdfFile.filename]})})]})})}),e.jsx(F,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Label,{children:"Description"}),e.jsx(i.Control,{as:"textarea",rows:3,value:r.description,onChange:n=>m("description",n.target.value),placeholder:"Enter diet plan description (optional)"})]})})}),e.jsx(F,{children:e.jsx(f,{md:12,children:e.jsxs(i.Group,{className:"mb-3",children:[e.jsx(i.Check,{type:"checkbox",label:"Active",checked:r.isActive,onChange:n=>m("isActive",n.target.checked)}),e.jsx(i.Text,{className:"text-muted",children:"Only active diet plans will be visible to users."})]})})})]}),e.jsxs(C.Footer,{children:[e.jsx(L,{variant:"secondary",onClick:E,children:"Cancel"}),e.jsx(L,{variant:"primary",type:"submit",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),t?"Updating...":"Creating..."]}):t?"Update Plan":"Create Plan"})]})]})]})},xe=()=>{const[g,s]=u.useState([]),[t,o]=u.useState(!0),[r,h]=u.useState(""),[d,v]=u.useState({page:1,limit:10}),[l,b]=u.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10}),[j,N]=u.useState(!1),[A,m]=u.useState(null),{showNotification:w}=$(),E=async()=>{try{o(!0);const a=await k.getAllDietPlans(d);s(a.data||[]),b({currentPage:a.currentPage||1,totalPages:a.totalPages||1,totalItems:a.totalItems||0,itemsPerPage:10})}catch(a){console.error("Error fetching diet plans:",a),w({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{o(!1)}};u.useEffect(()=>{(async()=>{try{o(!0);const c=await k.getAllDietPlans(d);s(c.data||[]),b({currentPage:c.currentPage||1,totalPages:c.totalPages||1,totalItems:c.totalItems||0,itemsPerPage:10})}catch(c){console.error("❌ Error fetching diet plans:",c),w({message:"Error fetching diet plans",variant:"danger"}),s([])}finally{o(!1)}})()},[d]);const n=(g||[]).filter(a=>a.name.toLowerCase().includes(r.toLowerCase())||a.category.toLowerCase().includes(r.toLowerCase())||a.type.toLowerCase().includes(r.toLowerCase())||a.subcategory&&a.subcategory.toLowerCase().includes(r.toLowerCase())),p=async a=>{if(!a._id||!a.pdfFile){w({message:"No PDF file available for this diet plan",variant:"warning"});return}try{const c=await k.downloadPDF(a._id);k.triggerPDFDownload(c,a.pdfFile.filename),w({message:"PDF downloaded successfully",variant:"success"})}catch(c){console.error("Error downloading PDF:",c),w({message:"Error downloading PDF",variant:"danger"})}},y=()=>{N(!1),m(null),E()},D=a=>{v(c=>({...c,page:a}))};return e.jsxs(e.Fragment,{children:[e.jsx(O,{title:"Diet Plan",subName:"Manage and track diet plans"}),e.jsx("div",{className:"container-fluid",children:e.jsxs(G,{id:"diet-plan-container",title:"Diet Plans Management",description:"Manage and track all diet plans for rice challenge awareness",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search diet plans...",value:r,onChange:a=>h(a.target.value)})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.category||"",onChange:a=>v(c=>({...c,category:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),M.map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.subcategory||"",onChange:a=>v(c=>({...c,subcategory:a.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Subcategories"}),_.map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:d.isActive===void 0?"":d.isActive.toString(),onChange:a=>v(c=>({...c,isActive:a.target.value===""?void 0:a.target.value==="true"})),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"true",children:"Active"}),e.jsx("option",{value:"false",children:"Inactive"})]})}),e.jsx("div",{className:"col-md-2 text-end",children:e.jsxs("button",{className:"btn btn-primary me-2",onClick:()=>N(!0),children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add New Plan"]})})]}),t?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Plan Name"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Category"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"PDF"}),e.jsx("th",{children:"Creator"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:n.map(a=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold",children:a.name}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-info",children:a.duration})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:a.category})}),e.jsx("td",{children:a.subcategory?e.jsx("span",{className:"badge bg-light text-dark",children:a.subcategory}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:a.pdfFile?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-success mb-1",onClick:()=>p(a),title:"Download PDF",children:[e.jsx("i",{className:"fas fa-download me-1"}),a.pdfFile.originalName]}),e.jsxs("small",{className:"text-muted",children:[(a.pdfFile.size/1024/1024).toFixed(2)," MB"]})]}):e.jsx("span",{className:"text-muted",children:"No PDF"})}),e.jsx("td",{children:a.createdBy&&typeof a.createdBy=="object"?e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold",children:a.createdBy.username}),e.jsx("small",{className:"text-muted",children:a.createdBy.email})]}):e.jsx("span",{className:"text-muted",children:"Unknown"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${a.isActive?"bg-success":"bg-secondary"}`,children:a.isActive?"Active":"Inactive"})}),e.jsx("td",{children:a.createdAt?new Date(a.createdAt).toLocaleDateString():"-"}),e.jsx("td",{children:e.jsx("div",{className:"btn-group",role:"group",children:e.jsx("button",{className:"btn btn-sm btn-outline-warning",onClick:()=>{m(a),N(!0)},title:"Edit",children:e.jsx("i",{className:"fas fa-edit"})})})})]},a._id))})]})}),n.length===0&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No diet plans found."})}),l.totalPages>1&&e.jsx("nav",{"aria-label":"Diet plans pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${l.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(l.currentPage-1),disabled:l.currentPage===1,children:"Previous"})}),Array.from({length:l.totalPages},(a,c)=>c+1).map(a=>e.jsx("li",{className:`page-item ${l.currentPage===a?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(a),children:a})},a)),e.jsx("li",{className:`page-item ${l.currentPage===l.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>D(l.currentPage+1),disabled:l.currentPage===l.totalPages,children:"Next"})})]})})]})]})}),j&&e.jsx(z,{show:j,onHide:()=>{N(!1),m(null)},editingPlan:A,onSubmit:y})]})};export{xe as default};
