import{r as m,f as _,j as e,h as z,l as H,R as I,d as y}from"./index-CQoIeUZd.js";import{C as U}from"./ComponentContainerCard-CHqrNMjP.js";import{P as V}from"./PageTitle-r1R6ZAE-.js";import{u as q,T as k}from"./TextFormInput-IL8lFAJj.js";import{c as O,a as S,o as R}from"./index.esm-hkUYAMhP.js";import{D as B}from"./DropzoneFormInput-CmY2at0v.js";import{M as T}from"./Modal-BraMhR8h.js";import{A as F}from"./Alert-ePv4Wc27.js";import{F as G}from"./Form-BHQXA91g.js";import{B as E}from"./Button-CTUO1UiG.js";import"./Card-BKwV0xe3.js";import"./IconifyIcon-CUdZ2bbF.js";import"./FormControl-DWoOkngb.js";import"./warning-kD2yLmJa.js";import"./FormLabel-znV6bOwv.js";import"./FormGroup-C0dHtb9l.js";import"./FormText-8GS1meLy.js";import"./AbstractModalHeader-OBp02WDc.js";import"./useWindow-Czc89hX_.js";import"./usePrevious-CQ691Z4Z.js";import"./useEventCallback-DsigtgEy.js";import"./hasClass-DVir8ym0.js";import"./useMergedRefs-C_sYzPN2.js";import"./NoopTransition-BpYpk5hA.js";import"./DataKey-COGXBUcQ.js";import"./hook-ILHwkxll.js";import"./extends-CF3RwP-h.js";import"./Anchor-BNJu-7oI.js";import"./Button-8NGCVDuw.js";import"./FormCheck-eV8FjGte.js";import"./ElementChildren-Bk8xUZer.js";import"./FormSelect-DvcgbTcK.js";const M=m.forwardRef(({bsPrefix:t,variant:c,animation:a="border",size:o,as:l="div",className:u,...i},f)=>{t=_(t,"spinner");const n=`${t}-${a}`;return e.jsx(l,{ref:f,...i,className:z(u,n,o&&`${n}-${o}`,c&&`text-${c}`)})});M.displayName="Spinner";const $=t=>{var c;try{const a=(c=H.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:c.toString();if(a){const o=JSON.parse(a);if(o!=null&&o.token)return o.token}return t||localStorage.getItem("authToken")||""}catch(a){return console.warn("Failed to get auth token from session:",a),localStorage.getItem("authToken")||""}},J=async(t,c)=>{try{const a=new FormData;a.append("handle",t.handle),a.append("image",t.image),a.append("storyLink",t.storyLink),a.append("views",t.views),a.append("likes",t.likes);const o=$(c);if(!o)throw new Error("Authentication token not found. Please login again.");const l=await fetch("http://localhost:8080/api/stories",{method:"POST",headers:{authorization:o},body:a});if(!l.ok){const i=await l.json().catch(()=>({message:"Failed to create story"}));throw new Error(i.message||`HTTP ${l.status}: ${l.statusText}`)}return{success:!0,data:await l.json(),message:"Story created successfully"}}catch(a){return console.error("Error creating story:",a),{success:!1,message:a instanceof Error?a.message:"Failed to create story"}}},K=async(t={},c)=>{try{const a=$(c);if(!a)throw new Error("Authentication token not found. Please login again.");const{page:o=1,limit:l=10}=t,u=new URLSearchParams({page:o.toString(),limit:l.toString()}),i=await fetch(`http://localhost:8080/api/stories?${u}`,{method:"GET",headers:{authorization:a}});if(!i.ok){const n=await i.json().catch(()=>({message:"Failed to fetch stories"}));throw new Error(n.message||`HTTP ${i.status}: ${i.statusText}`)}return{success:!0,data:await i.json(),message:"Stories fetched successfully"}}catch(a){return console.error("Error fetching stories:",a),{success:!1,data:{stories:[],pagination:{total:0,currentPage:1,totalPages:0,perPage:10},stats:{totalViews:0,totalLikes:0}},message:a instanceof Error?a.message:"Failed to fetch stories"}}},W=O({handle:S().required("Handle is required").min(3,"Handle must be at least 3 characters").max(50,"Handle cannot exceed 50 characters").matches(/^[a-zA-Z0-9_]+$/,"Handle can only contain letters, numbers, and underscores"),storyLink:S().required("Story link is required").url("Must be a valid URL").matches(/^https?:\/\/(www\.)?(instagram|facebook|twitter|tiktok)\.com\/.+/,"Must be a valid social media URL (Instagram, Facebook, Twitter, or TikTok)"),views:S().required("Views is required").matches(/^\d+$/,"Views must be a positive number").test("min-value","Views must be at least 0",t=>t?parseInt(t)>=0:!1).test("max-value","Views cannot exceed 10 million",t=>t?parseInt(t)<=1e7:!1),likes:S().required("Likes is required").matches(/^\d+$/,"Likes must be a positive number").test("min-value","Likes must be at least 0",t=>t?parseInt(t)>=0:!1).test("max-value","Likes cannot exceed 1 million",t=>t?parseInt(t)<=1e6:!1).test("logical-validation","Likes cannot be more than views",function(t){const{views:c}=this.parent;return c&&t?parseInt(t)<=parseInt(c):!0})}),Y=({show:t,onHide:c,onStoryCreated:a})=>{const[o,l]=m.useState(!1),[u,i]=m.useState(null),[f,n]=m.useState(!1),[g,x]=m.useState(null),{control:j,handleSubmit:w,reset:v}=q({resolver:R(W),defaultValues:{handle:"",storyLink:"",views:"",likes:""}}),p=()=>{v(),x(null),i(null),n(!1),c()},C=h=>{if(h.length>0){const d=h[0];if(!["image/jpeg","image/png","image/gif","image/webp"].includes(d.type)){i("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}const P=5*1024*1024;if(d.size>P){i("Image file size must be less than 5MB");return}i(null),x(d)}},L=async h=>{if(!g){i("Please select an image");return}l(!0),i(null),n(!1);try{const d=await J({handle:h.handle,image:g,storyLink:h.storyLink,views:h.views,likes:h.likes});if(!d.success)throw new Error(d.message||"Failed to create story");console.log("Story created successfully:",d.data),n(!0),setTimeout(()=>{v(),x(null),n(!1),a==null||a(),c()},2e3)}catch(d){console.error("Error creating story:",d);const b=d instanceof Error?d.message:"Failed to create story";b.includes("Authentication token not found")||b.includes("login")?i("Authentication required. Please log in again and try."):i(b)}finally{l(!1)}};return e.jsxs(T,{show:t,onHide:p,size:"lg",centered:!0,children:[e.jsx(T.Header,{closeButton:!0,children:e.jsxs(T.Title,{children:[e.jsx("i",{className:"fas fa-plus-circle me-2 text-primary"}),"Create New Story"]})}),e.jsxs(T.Body,{children:[u&&e.jsxs(F,{variant:"danger",className:"mb-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),u]}),f&&e.jsxs(F,{variant:"success",className:"mb-3",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Story created successfully! The modal will close automatically."]}),e.jsxs(G,{onSubmit:w(L),children:[e.jsxs(I,{children:[e.jsx(y,{md:6,children:e.jsx(k,{name:"handle",control:j,label:"Handle",placeholder:"e.g., smriti_mandhana_cute_girl",containerClassName:"mb-3"})}),e.jsx(y,{md:6,children:e.jsx(k,{name:"storyLink",control:j,label:"Story Link",placeholder:"https://www.instagram.com/p/...",containerClassName:"mb-3"})})]}),e.jsxs(I,{children:[e.jsx(y,{md:6,children:e.jsx(k,{name:"views",control:j,label:"Views",type:"number",placeholder:"e.g., 1000",containerClassName:"mb-3",min:"0",max:"10000000"})}),e.jsx(y,{md:6,children:e.jsx(k,{name:"likes",control:j,label:"Likes",type:"number",placeholder:"e.g., 1010",containerClassName:"mb-3",min:"0",max:"1000000"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{label:"Upload Story Image",labelClassName:"form-label",text:"Drop your image here or click to browse",textClassName:"h5 mb-2",helpText:"Supported formats: JPG, PNG, GIF (Max: 5MB)",showPreview:!0,onFileUpload:C,iconProps:{icon:"bx:cloud-upload",className:"text-primary",style:{fontSize:"48px"}}}),g&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-check me-1"}),"Selected: ",g.name]})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(E,{variant:"secondary",onClick:p,disabled:o,children:"Cancel"}),e.jsx(E,{variant:"primary",type:"submit",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(M,{size:"sm",className:"me-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Create Story"]})})]})]})]})]})},Ie=()=>{const[t,c]=m.useState("all"),[a,o]=m.useState(!1),[l,u]=m.useState([]),[i,f]=m.useState(!0),[n,g]=m.useState(1),[x,j]=m.useState(1),[w,v]=m.useState(0),p=async(s=1)=>{try{f(!0);const r=await K({page:s,limit:10});r.success?(u(r.data.stories),g(r.data.pagination.currentPage),j(r.data.pagination.totalPages),v(r.data.pagination.total)):(console.error("Failed to fetch stories:",r.message),u([]))}catch(r){console.error("Error fetching stories:",r),u([])}finally{f(!1)}};m.useEffect(()=>{p(1)},[]);const C=s=>s.includes("instagram.com")?"Instagram":s.includes("facebook.com")?"Facebook":s.includes("twitter.com")||s.includes("x.com")?"Twitter":s.includes("tiktok.com")?"TikTok":"Other",L=s=>{const r=new Date(s);return(new Date().getTime()-r.getTime())/(1e3*60*60)<24?"Active":"Expired"},h=l.map(s=>({...s,platform:C(s.storyLink),status:L(s.createdAt),type:Math.random()>.7?"Video":"Photo",title:s.influencer.fullName,posted:s.createdAt,id:s._id,duration:24,image:s.imageUrl})),d=h.filter(s=>t==="all"||s.status.toLowerCase()===t.toLowerCase()),b=l.reduce((s,r)=>s+r.views,0),P=l.reduce((s,r)=>s+r.likes,0),A=new Set(l.map(s=>s.influencer.id)).size,D=h.filter(s=>s.status==="Active").length;return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Stories",subName:"Manage and track your social media stories"}),e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:b.toLocaleString()}),e.jsx("p",{className:"mb-0",children:"Total Views"})]}),e.jsx("i",{className:"fas fa-eye fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-success text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:P.toLocaleString()}),e.jsx("p",{className:"mb-0",children:"Total Likes"})]}),e.jsx("i",{className:"fas fa-heart fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-warning text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:A}),e.jsx("p",{className:"mb-0",children:"Total Influencers"})]}),e.jsx("i",{className:"fas fa-users fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-info text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:D}),e.jsx("p",{className:"mb-0",children:"Active Stories"})]}),e.jsx("i",{className:"fas fa-clock fa-2x opacity-75"})]})})})})]}),e.jsxs(U,{id:"stories-management",title:"Stories Management",description:"Track and manage your social media stories performance",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("select",{className:"form-select",value:t,onChange:s=>c(s.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"expired",children:"Expired"})]})}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsxs("button",{className:"btn btn-primary",onClick:()=>o(!0),disabled:i,children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Create Story"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Influencer"}),e.jsx("th",{children:"Handle"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Views"}),e.jsx("th",{children:"Likes"}),e.jsx("th",{children:"Posted"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:d.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative me-2",children:[e.jsx("img",{src:s.influencer.profilePicUrl,alt:s.influencer.fullName,className:"rounded-circle",width:"32",height:"32",style:{objectFit:"cover"}}),e.jsx("i",{className:`fab fa-${s.platform.toLowerCase()} position-absolute text-primary`,style:{bottom:"-4px",right:"-4px",fontSize:"12px",backgroundColor:"white",borderRadius:"50%",padding:"2px",border:"1px solid #dee2e6"}})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.influencer.fullName}),e.jsxs("small",{className:"text-muted",children:[s.influencer.followerCount.toLocaleString()," followers"]})]})]})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-semibold text-primary cursor-pointer text-decoration-none",style:{cursor:"pointer",transition:"color 0.2s ease-in-out"},onClick:()=>{window.open(`https://www.instagram.com/${s.handle}/#`,"_blank","noopener,noreferrer")},onMouseOver:r=>{r.currentTarget.style.textDecoration="underline"},onMouseOut:r=>{r.currentTarget.style.textDecoration="none"},title:"Click to open Instagram profile",children:["@",s.handle]})}),e.jsx("td",{children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"Story",className:"rounded cursor-pointer",width:"60",height:"60",style:{objectFit:"cover",cursor:"pointer",transition:"transform 0.2s ease-in-out"},onClick:()=>{window.open(s.storyLink,"_blank","noopener,noreferrer")},onMouseOver:r=>{r.currentTarget.style.transform="scale(1.05)"},onMouseOut:r=>{r.currentTarget.style.transform="scale(1)"},title:"Click to open story on Instagram"}):e.jsx("div",{className:"d-flex align-items-center justify-content-center bg-light rounded cursor-pointer",style:{width:"60px",height:"60px",cursor:"pointer",transition:"background-color 0.2s ease-in-out"},onClick:()=>{window.open(s.storyLink,"_blank","noopener,noreferrer")},onMouseOver:r=>{r.currentTarget.style.backgroundColor="#e9ecef"},onMouseOut:r=>{r.currentTarget.style.backgroundColor="#f8f9fa"},title:"Click to open story on Instagram",children:e.jsx("i",{className:"fas fa-image text-muted"})})}),e.jsx("td",{children:s.views.toLocaleString()}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-success",children:s.likes.toLocaleString()})}),e.jsx("td",{children:new Date(s.posted).toLocaleDateString()}),e.jsx("td",{children:e.jsx("span",{className:`badge ${s.status==="Active"?"bg-success":"bg-secondary"}`,children:s.status})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",title:"Share Story",onClick:()=>{navigator.clipboard.writeText(s.storyLink).then(()=>{alert("Story link copied to clipboard!")})},children:e.jsx("i",{className:"fas fa-share"})})})]},s.id))})]})}),i&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2",children:"Loading stories..."})]}),!i&&d.length===0&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-inbox fa-3x text-muted mb-3"}),e.jsx("p",{className:"text-muted",children:l.length===0?"No stories available. Create your first story!":"No stories found matching your criteria."})]}),!i&&x>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(n-1)*10+1," to ",Math.min(n*10,w)," of ",w," stories"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${n===1?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>p(n-1),disabled:n===1,children:[e.jsx("i",{className:"fas fa-chevron-left"})," Previous"]})}),[...Array(Math.min(5,x))].map((s,r)=>{const N=Math.max(1,n-2)+r;return N>x?null:e.jsx("li",{className:`page-item ${n===N?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>p(N),children:N})},N)}),e.jsx("li",{className:`page-item ${n===x?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>p(n+1),disabled:n===x,children:["Next ",e.jsx("i",{className:"fas fa-chevron-right"})]})})]})})]})]}),e.jsx(Y,{show:a,onHide:()=>o(!1),onStoryCreated:()=>{p(1),g(1)}})]})]})};export{Ie as default};
