import{l as N,i as w,r as g,j as e,F as k}from"./index-1uISpN7Y.js";import{C}from"./ComponentContainerCard-B7l0m1Ec.js";import{P as E}from"./PageTitle-BYtupvZW.js";import"./Card-DlCpNF8U.js";import"./IconifyIcon-B2yq3Hdd.js";const p=i=>{var a,r,s;try{const c=(a=N.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:a.toString();if(c){const h=JSON.parse(c);if(h!=null&&h.token)return h.token}const d=(r=N.getCookie("token"))==null?void 0:r.toString();return i||d||localStorage.getItem("authToken")||""}catch(c){return console.warn("Failed to get auth token from session:",c),((s=N.getCookie("token"))==null?void 0:s.toString())||localStorage.getItem("authToken")||""}},v=()=>({authorization:p(),"Content-Type":"application/json"});class S{static async getAllChallengers(a){try{if(!p())throw new Error("Authentication token not found. Please login again.");const s=new URLSearchParams;a!=null&&a.category&&s.append("category",a.category),a!=null&&a.subcategory&&s.append("subcategory",a.subcategory),a!=null&&a.type&&s.append("type",a.type),a!=null&&a.duration&&s.append("duration",a.duration),a!=null&&a.search&&s.append("search",a.search),a!=null&&a.page&&s.append("page",a.page.toString()),a!=null&&a.limit&&s.append("limit",a.limit.toString());const c=await fetch(`http://localhost:8080/api/challenger?${s.toString()}`,{method:"GET",headers:v()});if(!c.ok)throw new Error(`Failed to fetch challengers: ${c.statusText}`);return await c.json()}catch(r){throw console.error("Error fetching challengers:",r),r}}static async getChallengerById(a){try{if(!p())throw new Error("Authentication token not found. Please login again.");const s=await fetch(`http://localhost:8080/api/challenger/${a}`,{method:"GET",headers:v()});if(!s.ok)throw new Error(`Failed to fetch challenger: ${s.statusText}`);return await s.json()}catch(r){throw console.error("Error fetching challenger:",r),r}}static async deleteChallenger(a){try{if(!p())throw new Error("Authentication token not found. Please login again.");const s=await fetch(`http://localhost:8080/api/challenger/${a}`,{method:"DELETE",headers:v()});if(!s.ok)throw new Error(`Failed to delete challenger: ${s.statusText}`)}catch(r){throw console.error("Error deleting challenger:",r),r}}}const D=()=>{var y;const{showNotification:i}=w(),[a,r]=g.useState(!1),[s,c]=g.useState([]),[d,h]=g.useState(""),[l,m]=g.useState({page:1,limit:10}),[o,b]=g.useState({currentPage:1,totalPages:1,totalItems:0,itemsPerPage:10});g.useEffect(()=>{const n=setTimeout(async()=>{try{r(!0);const j={...l,search:d},u=await S.getAllChallengers(j);c(u.data||[]),b({currentPage:u.currentPage||1,totalPages:u.totalPages||1,totalItems:u.totalItems||0,itemsPerPage:l.limit||10})}catch(j){console.error("❌ Error fetching challengers:",j),i({message:"Error fetching challengers",variant:"danger"}),c([])}finally{r(!1)}},300);return()=>clearTimeout(n)},[l.page,l.limit,l.category,l.subcategory,l.type,l.duration,d,i]);const x=t=>{m(n=>({...n,page:t}))},P=t=>{try{if(console.log("Original PDF URL:",t),t.startsWith("http://")||t.startsWith("https://")){console.log("Opening absolute URL:",t),window.open(t,"_blank","noopener,noreferrer");return}let n=t;t.startsWith("/")?n=`http://localhost:8080/${t}`:n=`http://localhost:8080/${t}`,console.log("Opening constructed URL:",n),window.open(n,"_blank","noopener,noreferrer")}catch(n){console.error("Error opening PDF:",n),alert(`Error opening PDF: ${n instanceof Error?n.message:"Unknown error"}`)}};return e.jsxs(e.Fragment,{children:[e.jsx(E,{subName:"Daawat",title:"Challengers"}),e.jsxs(C,{id:"challengers-list",title:"All Challengers",description:"Manage and view all registered challengers",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"fas fa-search"})}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Search challengers...",value:d,onChange:t=>h(t.target.value)})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:l.category||"",onChange:t=>m(n=>({...n,category:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Categories"}),e.jsx("option",{value:"Vegetarian",children:"Vegetarian"}),e.jsx("option",{value:"Keto",children:"Keto"}),e.jsx("option",{value:"High Protein",children:"High Protein"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:l.duration||"",onChange:t=>m(n=>({...n,duration:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Durations"}),e.jsx("option",{value:"7 days",children:"7 days"}),e.jsx("option",{value:"1 month",children:"1 month"}),e.jsx("option",{value:"3 months",children:"3 months"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:l.type||"",onChange:t=>m(n=>({...n,type:t.target.value||void 0})),children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"Weight Loss",children:"Weight Loss"}),e.jsx("option",{value:"Muscle Building",children:"Muscle Building"}),e.jsx("option",{value:"General Health",children:"General Health"})]})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("select",{className:"form-select",value:((y=l.limit)==null?void 0:y.toString())||"10",onChange:t=>m(n=>({...n,limit:parseInt(t.target.value),page:1})),children:[e.jsx("option",{value:"5",children:"5 per page"}),e.jsx("option",{value:"10",children:"10 per page"}),e.jsx("option",{value:"25",children:"25 per page"}),e.jsx("option",{value:"50",children:"50 per page"})]})})]}),a?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2",children:"Loading challengers..."})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name & Contact"}),e.jsx("th",{children:"Category & Type"}),e.jsx("th",{children:"Duration"}),e.jsx("th",{children:"Subcategory"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"PDF"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-users fa-3x text-muted mb-3"}),e.jsx("h5",{className:"text-muted",children:"No challengers found"}),e.jsx("p",{className:"text-muted",children:"Try adjusting your search or filter criteria."})]})}):s.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"avatar-md me-2",children:e.jsx("div",{className:"avatar-title bg-primary-subtle text-primary rounded-circle",children:t.name.charAt(0).toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0",children:t.name}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-phone me-1"}),e.jsx("a",{href:`tel:${t.mobile}`,className:"text-decoration-none",children:t.mobile})]})]})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("span",{className:`badge ${t.category==="Vegetarian"?"bg-success":t.category==="Keto"?"bg-warning":"bg-info"} mb-1`,children:t.category}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:t.type})]})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:t.duration})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:t.subcategory||"N/A"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${t.isActive?"bg-success":"bg-secondary"}`,children:t.isActive?"Active":"Inactive"})}),e.jsx("td",{children:e.jsx("span",{className:"text-muted",children:t.createdAt?new Date(t.createdAt).toLocaleDateString():"N/A"})}),e.jsx("td",{children:t.pdf?e.jsxs("button",{className:"btn btn-sm btn-outline-success",onClick:()=>P(t.pdf),title:"View PDF",children:[e.jsx("i",{className:"fas fa-file-pdf me-1"}),"View"]}):e.jsx("span",{className:"text-muted",children:"No PDF"})})]},t._id))})]})}),o.totalPages>1&&e.jsx("nav",{"aria-label":"Challengers pagination",children:e.jsxs("ul",{className:"pagination justify-content-center",children:[e.jsx("li",{className:`page-item ${o.currentPage===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(o.currentPage-1),disabled:o.currentPage===1,children:"Previous"})}),Array.from({length:o.totalPages},(t,n)=>n+1).map(t=>e.jsx("li",{className:`page-item ${o.currentPage===t?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(t),children:t})},t)),e.jsx("li",{className:`page-item ${o.currentPage===o.totalPages?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>x(o.currentPage+1),disabled:o.currentPage===o.totalPages,children:"Next"})})]})}),!a&&s.length>0&&e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-md-6",children:e.jsxs("small",{className:"text-muted",children:["Showing ",(o.currentPage-1)*o.itemsPerPage+1," to"," ",Math.min(o.currentPage*o.itemsPerPage,o.totalItems)," of"," ",o.totalItems," challengers"]})})})]}),e.jsx(k,{})]})};export{D as default};
