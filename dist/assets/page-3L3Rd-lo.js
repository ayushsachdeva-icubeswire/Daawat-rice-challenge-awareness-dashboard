import{l as O,r as m,j as e,R as E,d as C}from"./index-BjOyW0qq.js";import{C as R}from"./ComponentContainerCard-P6bdBbIR.js";import{P as q}from"./PageTitle-BAvUUtym.js";import{u as G,T}from"./TextFormInput-COnouXh0.js";import{c as B,a as P,o as J}from"./index.esm-Bza7MfKq.js";import{D as K}from"./DropzoneFormInput-Bc43uXgx.js";import{A as $}from"./api-ClkYFUjX.js";import{M as I}from"./Modal-gSych59J.js";import{A}from"./Alert-COlypfhh.js";import{F as W}from"./Form-C_P5xAgj.js";import{B as D}from"./Button-DAGZgDWX.js";import{S as Y}from"./Spinner-CKSq3EN_.js";import{f as v}from"./numberFormat-yIx-nKgv.js";import"./Card-ochixP97.js";import"./IconifyIcon-ChMbXNU0.js";import"./FormControl-dcMRqerm.js";import"./warning-Bx7x67cA.js";import"./FormLabel-oYvFViwE.js";import"./FormGroup-6kNqsfwi.js";import"./FormText-DvPyUFa3.js";import"./AbstractModalHeader-CTaDAQp1.js";import"./useWindow-m-gnSXSX.js";import"./usePrevious-RwYfRs0Q.js";import"./useEventCallback-DCxOrWr_.js";import"./hasClass-DeSU8YS2.js";import"./useMergedRefs-eReaX_vA.js";import"./NoopTransition-DcQ3lbnf.js";import"./DataKey-COGXBUcQ.js";import"./hook-DYb1o3jn.js";import"./extends-CF3RwP-h.js";import"./Anchor-ChsEU4_X.js";import"./Button-DrK4oo4I.js";import"./FormCheck-pnc9aUew.js";import"./ElementChildren-BXzhGfag.js";import"./FormSelect-BaZsWFCp.js";const U=a=>{var c;try{const t=(c=O.getCookie("_DARKONE_AUTH_KEY_"))==null?void 0:c.toString();if(t){const n=JSON.parse(t);if(n!=null&&n.token)return n.token}return a||localStorage.getItem("authToken")||""}catch(t){return console.warn("Failed to get auth token from session:",t),localStorage.getItem("authToken")||""}},Z=async(a,c)=>{try{const t=new FormData;t.append("handle",a.handle),t.append("image",a.image),t.append("storyLink",a.storyLink),t.append("views",a.views),t.append("likes",a.likes);const n=U(c);if(!n)throw new Error("Authentication token not found. Please login again.");const d=await fetch(`${$.API_URL}/stories`,{method:"POST",headers:{authorization:n},body:t});if(!d.ok){const r=await d.json().catch(()=>({message:"Failed to create story"}));throw new Error(r.message||`HTTP ${d.status}: ${d.statusText}`)}return{success:!0,data:await d.json(),message:"Story created successfully"}}catch(t){return console.error("Error creating story:",t),{success:!1,message:t instanceof Error?t.message:"Failed to create story"}}},Q=async(a={},c)=>{try{const t=U(c);if(!t)throw new Error("Authentication token not found. Please login again.");const{page:n=1,limit:d=10}=a,x=new URLSearchParams({page:n.toString(),limit:d.toString()}),r=await fetch(`${$.API_URL}/stories?${x}`,{method:"GET",headers:{authorization:t}});if(!r.ok){const u=await r.json().catch(()=>({message:"Failed to fetch stories"}));throw new Error(u.message||`HTTP ${r.status}: ${r.statusText}`)}return{success:!0,data:await r.json(),message:"Stories fetched successfully"}}catch(t){return console.error("Error fetching stories:",t),{success:!1,data:{stories:[],pagination:{total:0,currentPage:1,totalPages:0,perPage:10},stats:{totalViews:0,totalLikes:0}},message:t instanceof Error?t.message:"Failed to fetch stories"}}},X=B({handle:P().required("Handle is required").min(3,"Handle must be at least 3 characters").max(50,"Handle cannot exceed 50 characters").matches(/^[a-zA-Z0-9_.]+$/,"Handle can only contain letters, numbers, underscores, and periods"),storyLink:P().required("Story link is required").url("Must be a valid URL").matches(/^https?:\/\/(www\.)?(instagram|facebook|twitter|tiktok)\.com\/.+/,"Must be a valid social media URL (Instagram, Facebook, Twitter, or TikTok)"),views:P().required("Views is required").matches(/^\d+$/,"Views must be a positive number").test("min-value","Views must be at least 0",a=>a?parseInt(a)>=0:!1).test("max-value","Views cannot exceed 10 million",a=>a?parseInt(a)<=1e7:!1),likes:P().required("Likes is required").matches(/^\d+$/,"Likes must be a positive number").test("min-value","Likes must be at least 0",a=>a?parseInt(a)>=0:!1).test("max-value","Likes cannot exceed 1 million",a=>a?parseInt(a)<=1e6:!1).test("logical-validation","Likes cannot be more than views",function(a){const{views:c}=this.parent;return c&&a?parseInt(a)<=parseInt(c):!0})}),ee=({show:a,onHide:c,onStoryCreated:t})=>{const[n,d]=m.useState(!1),[x,r]=m.useState(null),[y,u]=m.useState(!1),[f,p]=m.useState(null),{control:g,handleSubmit:j,reset:b}=G({resolver:J(X),defaultValues:{handle:"",storyLink:"",views:"",likes:""}}),k=()=>{b(),p(null),r(null),u(!1),c()},N=h=>{if(h.length>0){const l=h[0];if(!["image/jpeg","image/png","image/gif","image/webp"].includes(l.type)){r("Please select a valid image file (JPEG, PNG, GIF, or WebP)");return}const L=5*1024*1024;if(l.size>L){r("Image file size must be less than 5MB");return}r(null),p(l)}},S=async h=>{if(!f){r("Please select an image");return}d(!0),r(null),u(!1);try{const l=await Z({handle:h.handle,image:f,storyLink:h.storyLink,views:h.views,likes:h.likes});if(!l.success)throw new Error(l.message||"Failed to create story");u(!0),setTimeout(()=>{b(),p(null),u(!1),t==null||t(),c()},2e3)}catch(l){console.error("Error creating story:",l);const w=l instanceof Error?l.message:"Failed to create story";w.includes("Authentication token not found")||w.includes("login")?r("Authentication required. Please log in again and try."):r(w)}finally{d(!1)}};return e.jsxs(I,{show:a,onHide:k,size:"lg",centered:!0,children:[e.jsx(I.Header,{closeButton:!0,children:e.jsxs(I.Title,{children:[e.jsx("i",{className:"fas fa-plus-circle me-2 text-primary"}),"Create New Story"]})}),e.jsxs(I.Body,{children:[x&&e.jsxs(A,{variant:"danger",className:"mb-3",children:[e.jsx("i",{className:"fas fa-exclamation-triangle me-2"}),x]}),y&&e.jsxs(A,{variant:"success",className:"mb-3",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Story created successfully! The modal will close automatically."]}),e.jsxs(W,{onSubmit:j(S),children:[e.jsxs(E,{children:[e.jsx(C,{md:6,children:e.jsx(T,{name:"handle",control:g,label:"Handle",placeholder:"e.g., smriti_mandhana_cute_girl",containerClassName:"mb-3"})}),e.jsx(C,{md:6,children:e.jsx(T,{name:"storyLink",control:g,label:"Story Link",placeholder:"https://www.instagram.com/p/...",containerClassName:"mb-3"})})]}),e.jsxs(E,{children:[e.jsx(C,{md:6,children:e.jsx(T,{name:"views",control:g,label:"Views",type:"number",placeholder:"e.g., 1000",containerClassName:"mb-3",min:"0",max:"10000000"})}),e.jsx(C,{md:6,children:e.jsx(T,{name:"likes",control:g,label:"Likes",type:"number",placeholder:"e.g., 1010",containerClassName:"mb-3",min:"0",max:"1000000"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx(K,{label:"Upload Story Image",labelClassName:"form-label",text:"Drop your image here or click to browse",textClassName:"h5 mb-2",helpText:"Supported formats: JPG, PNG, GIF (Max: 5MB)",showPreview:!0,onFileUpload:N,iconProps:{icon:"bx:cloud-upload",className:"text-primary",style:{fontSize:"48px"}}}),f&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-success",children:[e.jsx("i",{className:"fas fa-check me-1"}),"Selected: ",f.name]})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx(D,{variant:"secondary",onClick:k,disabled:n,children:"Cancel"}),e.jsx(D,{variant:"primary",type:"submit",disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx(Y,{size:"sm",className:"me-2"}),"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Create Story"]})})]})]})]})]})},Ue=()=>{const[a,c]=m.useState(!1),[t,n]=m.useState([]),[d,x]=m.useState(!0),[r,y]=m.useState(1),[u,f]=m.useState(1),[p,g]=m.useState(0),[j,b]=m.useState(null),[k,N]=m.useState(!1),[S,h]=m.useState(null),l=async s=>{try{x(!0);const o=await Q({page:s,limit:10});o.success?(n(o.data.stories),y(o.data.pagination.currentPage),f(o.data.pagination.totalPages),g(o.data.pagination.total),o.data.stats?b({totalViews:o.data.stats.totalViews,totalLikes:o.data.stats.totalLikes}):b(null)):(console.error("Failed to fetch stories:",o.message),n([]),b(null))}catch(i){console.error("Error fetching stories:",i),n([])}finally{x(!1)}};m.useEffect(()=>{l(1)},[]);const w=s=>s.includes("instagram.com")?"Instagram":s.includes("facebook.com")?"Facebook":s.includes("twitter.com")||s.includes("x.com")?"Twitter":s.includes("tiktok.com")?"TikTok":"Other",L=s=>{const i=new Date(s);return(new Date().getTime()-i.getTime())/(1e3*60*60)<24?"Active":"Expired"},F=t.map(s=>({...s,platform:w(s.storyLink),status:L(s.createdAt),type:Math.random()>.7?"Video":"Photo",title:s.influencer.fullName,posted:s.createdAt,id:s._id,duration:24,image:s.imageUrl})),M=F,_=j?j.totalViews:0,V=j?j.totalLikes:0,z=new Set(t.map(s=>s.influencer.id)).size,H=F.filter(s=>s.status==="Active").length;return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Stories",subName:"Manage and track your social media stories"}),e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:v(_)}),e.jsx("p",{className:"mb-0",children:"Total Views"})]}),e.jsx("i",{className:"fas fa-eye fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-success text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:v(V)}),e.jsx("p",{className:"mb-0",children:"Total Likes"})]}),e.jsx("i",{className:"fas fa-heart fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-warning text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:z}),e.jsx("p",{className:"mb-0",children:"Total Influencers"})]}),e.jsx("i",{className:"fas fa-users fa-2x opacity-75"})]})})})}),e.jsx("div",{className:"col-xl-3 col-md-6",children:e.jsx("div",{className:"card bg-info text-white",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"mb-0",children:H}),e.jsx("p",{className:"mb-0",children:"Active Stories"})]}),e.jsx("i",{className:"fas fa-clock fa-2x opacity-75"})]})})})})]}),e.jsxs(R,{id:"stories-management",title:"Stories Management",description:"Track and manage your social media stories performance",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsx("div",{className:"col-md-6"}),e.jsx("div",{className:"col-md-6 text-end",children:e.jsxs("button",{className:"btn btn-primary",onClick:()=>c(!0),disabled:d,children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Create Story"]})})]}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-striped table-hover",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Influencer"}),e.jsx("th",{children:"Handle"}),e.jsx("th",{children:"Image"}),e.jsx("th",{children:"Views"}),e.jsx("th",{children:"Likes"}),e.jsx("th",{children:"Posted"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:M.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"position-relative me-2",children:[e.jsx("img",{src:s.influencer.profilePicUrl,alt:s.influencer.fullName,className:"rounded-circle",width:"32",height:"32",style:{objectFit:"cover"}}),e.jsx("i",{className:`fab fa-${s.platform.toLowerCase()} position-absolute text-primary`,style:{bottom:"-4px",right:"-4px",fontSize:"12px",backgroundColor:"white",borderRadius:"50%",padding:"2px",border:"1px solid #dee2e6"}})]}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",children:s.influencer.fullName}),e.jsxs("small",{className:"text-muted",children:[v(s.influencer.followerCount)," followers"]})]})]})}),e.jsx("td",{children:e.jsxs("span",{className:"fw-semibold text-primary cursor-pointer text-decoration-none",style:{cursor:"pointer",transition:"color 0.2s ease-in-out"},onClick:()=>{window.open(`https://www.instagram.com/${s.handle}/#`,"_blank","noopener,noreferrer")},onMouseOver:i=>{i.currentTarget.style.textDecoration="underline"},onMouseOut:i=>{i.currentTarget.style.textDecoration="none"},title:"Click to open Instagram profile",children:["@",s.handle]})}),e.jsx("td",{children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"Story",className:"rounded cursor-pointer",width:"60",height:"60",style:{objectFit:"cover",cursor:"pointer",transition:"transform 0.2s ease-in-out"},onClick:()=>{h(s.imageUrl),N(!0)},onMouseOver:i=>{i.currentTarget.style.transform="scale(1.05)"},onMouseOut:i=>{i.currentTarget.style.transform="scale(1)"},title:"Click to view story image"}):e.jsx("div",{className:"d-flex align-items-center justify-content-center bg-light rounded cursor-pointer",style:{width:"60px",height:"60px",cursor:"pointer",transition:"background-color 0.2s ease-in-out"},onClick:()=>{h(null),N(!0)},onMouseOver:i=>{i.currentTarget.style.backgroundColor="#e9ecef"},onMouseOut:i=>{i.currentTarget.style.backgroundColor="#f8f9fa"},title:"Click to view story image",children:e.jsx("i",{className:"fas fa-image text-muted"})})}),e.jsx("td",{children:v(s.views)}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-success",children:v(s.likes)})}),e.jsx("td",{children:new Date(s.posted).toLocaleDateString()}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",title:"Share Story",onClick:()=>{window.open(s.storyLink,"_blank","noopener,noreferrer")},children:e.jsx("i",{className:"fas fa-share"})})})]},s.id))})]})}),d&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2",children:"Loading stories..."})]}),!d&&M.length===0&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"fas fa-inbox fa-3x text-muted mb-3"}),e.jsx("p",{className:"text-muted",children:t.length===0?"No stories available. Create your first story!":"No stories found matching your criteria."})]}),!d&&u>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(r-1)*10+1," to ",Math.min(r*10,p)," of ",p," stories"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${r===1?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>l(r-1),disabled:r===1,children:[e.jsx("i",{className:"fas fa-chevron-left"})," Previous"]})}),[...Array(Math.min(5,u))].map((s,i)=>{const o=Math.max(1,r-2)+i;return o>u?null:e.jsx("li",{className:`page-item ${r===o?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>l(o),children:o})},o)}),e.jsx("li",{className:`page-item ${r===u?"disabled":""}`,children:e.jsxs("button",{className:"page-link",onClick:()=>l(r+1),disabled:r===u,children:["Next ",e.jsx("i",{className:"fas fa-chevron-right"})]})})]})})]})]}),e.jsx(ee,{show:a,onHide:()=>c(!1),onStoryCreated:()=>{l(1),y(1)}}),k&&e.jsx("div",{className:"modal fade show",style:{display:"block",background:"rgba(0,0,0,0.5)"},tabIndex:-1,role:"dialog",onClick:()=>N(!1),children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",role:"document",onClick:s=>s.stopPropagation(),children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Story Image"}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>N(!1)})]}),e.jsx("div",{className:"modal-body text-center",children:S?e.jsx("img",{src:S,alt:"Story",style:{minWidth:"50%",maxHeight:"60vh",borderRadius:"8px"}}):e.jsx("div",{className:"text-muted",children:"No image available for this story."})})]})})})]})]})};export{Ue as default};
